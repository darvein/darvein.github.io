<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=color-scheme content="light dark"><meta http-equiv=Content-Security-Policy content="upgrade-insecure-requests; block-all-mixed-content; default-src 'self' https://www.dropbox.com https://*.dl.dropboxusercontent.com https://photos.app.goo.gl https://drive.google.com https://photos.google.com https://video-downloads.googleusercontent.com https://*.googleusercontent.com https://*.googlevideo.com https://youtube.googleapis.com; child-src 'self'; font-src 'self' https://fonts.gstatic.com https://cdn.jsdelivr.net/; form-action 'self'; frame-src 'self' https://w.soundcloud.com https://www.youtube.com https://www.youtube-nocookie.com https://www.dropbox.com http://localhost https://www.dropbox.com http://darvein.local https://disqus.com; img-src 'self' https://photos.google.com https://lh3.googleusercontent.com https://www.dropbox.com https://*.dl.dropboxusercontent.com https://*.disqus.com https://c.disquscdn.com; object-src https://lh3.googleusercontent.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com/ https://cdn.jsdelivr.net/ https://c.disquscdn.com; script-src 'self' 'unsafe-inline' https://www.google-analytics.com https://cdnjs.cloudflare.com https://www.googletagmanager.com https://www.dropbox.com http://localhost http://darvein.local https://drv21.disqus.com https://c.disquscdn.com; prefetch-src 'self' https://youtube.googleapis.com; connect-src 'self' https://www.google-analytics.com https://links.services.disqus.com;"><meta name=author content="Dennis Ruiz"><meta name=description content="Network, Ingress, Services, etc Content Network, Ingress, Services, etc Content Pods Networking Network policies for Pods: DNS Services Ingress Gateway API Pods Networking We can bootstrap kuberentes via minikube with these configs:
minikube start \ --memory=8192 --cpus=4 \ --nodes=3 \ --driver=virtualbox \ --network-plugin=cni --cni=calico \ --feature-gates=JobPodFailurePolicy=true,PodDisruptionConditions=true \ --insecure-registry &#34;registry.local:5000&#34; \ --container-runtime=docker \ --service-cluster-ip-range=10.96.0.0/12 \ --extra-config=controller-manager.cluster-cidr=10.244.0.0/16 \ --extra-config=controller-manager.node-cidr-mask-size-ipv4=24 Highlights:
cluster-cidr: CIDR where pods will be deployed service-cluster-ip-range: ClusterIP for services Kube-proxy on each node receives traffic from the service-cluster-ip-range and forwards to the backend pods."><meta name=keywords content="blog,developer,personal"><meta name=twitter:card content="summary"><meta name=twitter:title content><meta name=twitter:description content="Network, Ingress, Services, etc Content Network, Ingress, Services, etc Content Pods Networking Network policies for Pods: DNS Services Ingress Gateway API Pods Networking We can bootstrap kuberentes via minikube with these configs:
minikube start \ --memory=8192 --cpus=4 \ --nodes=3 \ --driver=virtualbox \ --network-plugin=cni --cni=calico \ --feature-gates=JobPodFailurePolicy=true,PodDisruptionConditions=true \ --insecure-registry &#34;registry.local:5000&#34; \ --container-runtime=docker \ --service-cluster-ip-range=10.96.0.0/12 \ --extra-config=controller-manager.cluster-cidr=10.244.0.0/16 \ --extra-config=controller-manager.node-cidr-mask-size-ipv4=24 Highlights:
cluster-cidr: CIDR where pods will be deployed service-cluster-ip-range: ClusterIP for services Kube-proxy on each node receives traffic from the service-cluster-ip-range and forwards to the backend pods."><meta property="og:title" content><meta property="og:description" content="Network, Ingress, Services, etc Content Network, Ingress, Services, etc Content Pods Networking Network policies for Pods: DNS Services Ingress Gateway API Pods Networking We can bootstrap kuberentes via minikube with these configs:
minikube start \ --memory=8192 --cpus=4 \ --nodes=3 \ --driver=virtualbox \ --network-plugin=cni --cni=calico \ --feature-gates=JobPodFailurePolicy=true,PodDisruptionConditions=true \ --insecure-registry &#34;registry.local:5000&#34; \ --container-runtime=docker \ --service-cluster-ip-range=10.96.0.0/12 \ --extra-config=controller-manager.cluster-cidr=10.244.0.0/16 \ --extra-config=controller-manager.node-cidr-mask-size-ipv4=24 Highlights:
cluster-cidr: CIDR where pods will be deployed service-cluster-ip-range: ClusterIP for services Kube-proxy on each node receives traffic from the service-cluster-ip-range and forwards to the backend pods."><meta property="og:type" content="article"><meta property="og:url" content="https://www.darvein.net/devops/k8s/network/"><meta property="article:section" content="devops"><title>Network, Ingress, Services, etc </title><link rel=canonical href=https://www.darvein.net/devops/k8s/network/><link rel=preload href="/fonts/forkawesome-webfont.woff2?v=1.2.0" as=font type=font/woff2 crossorigin><link rel=stylesheet href=/css/coder.min.a1a7e7e7bd8b6629931805334fd6cf056ee6f154702847e6d597bbfe80446a0d.css integrity="sha256-oafn572LZimTGAUzT9bPBW7m8VRwKEfm1Ze7/oBEag0=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/coder-dark.min.39e41a7f16bdf8cb16e43cae7d714fa1016f1d2d2898a5b3f27f42c9979204e2.css integrity="sha256-OeQafxa9+MsW5DyufXFPoQFvHS0omKWz8n9CyZeSBOI=" crossorigin=anonymous media=screen><link rel=stylesheet href=/css/custom.min.7cf8a329bb485491ed5be45bd286916c655bf66e11e3fe4d82649437eae8b51b.css integrity="sha256-fPijKbtIVJHtW+Rb0oaRbGVb9m4R4/5NgmSUN+rotRs=" crossorigin=anonymous media=screen><link rel=icon type=image/png href=/images/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/images/favicon-16x16.png sizes=16x16><link rel=apple-touch-icon href=/images/apple-touch-icon.png><link rel=apple-touch-icon sizes=180x180 href=/images/apple-touch-icon.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/images/safari-pinned-tab.svg color=#5bbad5><meta name=generator content="Hugo 0.120.4"></head><body class="preload-transitions colorscheme-dark"><main class=wrapper><nav class=navigation><section class=container><a class=navigation-title href=/>Darvein
</a><input type=checkbox id=menu-toggle>
<label class="menu-button float-right" for=menu-toggle><i class="fa fa-bars fa-fw" aria-hidden=true></i></label><ul class=navigation-list><li class=navigation-item><a class=navigation-link href=/infosec/>Infosec</a></li><li class=navigation-item><a class=navigation-link href=/coding/>Coding</a></li><li class=navigation-item><a class=navigation-link href=/devops/>Devops</a></li></ul></section></nav><div class=content><section class="container page"><article><h1 id=network-ingress-services-etc>Network, Ingress, Services, etc
<a class=heading-link href=#network-ingress-services-etc><i class="fa fa-link" aria-hidden=true></i></a></h1><h1 id=content>Content
<a class=heading-link href=#content><i class="fa fa-link" aria-hidden=true></i></a></h1><ul><li><a href=../#network-ingress-services-etc>Network, Ingress, Services, etc</a></li><li><a href=../#content>Content</a><ul><li><a href=../#pods-networking>Pods Networking</a><ul><li><a href=../#network-policies-for-pods>Network policies for Pods:</a></li></ul></li><li><a href=../#dns>DNS</a></li><li><a href=../#services>Services</a></li><li><a href=../#ingress>Ingress</a></li><li><a href=../#gateway-api>Gateway API</a></li></ul></li></ul><h2 id=pods-networking>Pods Networking
<a class=heading-link href=#pods-networking><i class="fa fa-link" aria-hidden=true></i></a></h2><p>We can bootstrap kuberentes via minikube with these configs:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>minikube start <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>   --memory=<span style=color:#0086f7;font-weight:700>8192</span> --cpus=<span style=color:#0086f7;font-weight:700>4</span> <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>   --nodes=<span style=color:#0086f7;font-weight:700>3</span> <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>   --driver=virtualbox <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>   --network-plugin=cni --cni=calico <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>   --feature-gates=<span style=color:#fb660a>JobPodFailurePolicy</span>=true,PodDisruptionConditions=true <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>   --insecure-registry <span style=color:#0086d2>&#34;registry.local:5000&#34;</span> <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>   --container-runtime=docker <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>   --service-cluster-ip-range=10.96.0.0/12 <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>   --extra-config=controller-manager.cluster-cidr=10.244.0.0/16 <span style=color:#0086d2>\
</span></span></span><span style=display:flex><span><span style=color:#0086d2></span>   --extra-config=controller-manager.node-cidr-mask-size-ipv4=<span style=color:#0086f7;font-weight:700>24</span>
</span></span></code></pre></div><p>Highlights:</p><ul><li><code>cluster-cidr</code>: CIDR where pods will be deployed</li><li><code>service-cluster-ip-range</code>: ClusterIP for services</li></ul><p>Kube-proxy on each node receives traffic from the service-cluster-ip-range and forwards to the backend pods.</p><p>You can verify the network setup:</p><ul><li>Check the cluster service ip range: <code>kubectl cluster-info dump | grep -m 1 service-cluster-ip-range</code></li><li>Check pods ip range: <code>kubectl cluster-info dump | grep -m 1 cluster-cidr</code></li><li>Verify each node cidr: <code>kubectl get nodes -o jsonpath='{.items[*].spec.podCIDR}'</code></li></ul><h3 id=network-policies-for-pods>Network policies for Pods:
<a class=heading-link href=#network-policies-for-pods><i class="fa fa-link" aria-hidden=true></i></a></h3><p>By default pods have no restrictions:</p><p>What can be filtered in a network policy:</p><ul><li>Entites:<ul><li>Pod</li><li>Namespace</li><li>ipBlock</li></ul></li><li>Isolation modes:<ul><li>Ingress</li><li>Egress</li></ul></li></ul><h2 id=dns>DNS
<a class=heading-link href=#dns><i class="fa fa-link" aria-hidden=true></i></a></h2><p>Pods and services get an entry en DNS Service
pod-ip-address.my-namespace.pod.cluster-domain.example.
A pod can have a hostname and subdomain</p><p>Once pods are behind a service, both the service and pods have are registered into coredns service:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>kubectl exec -it busybox1 -- nslookup busybox-2.busybox-subdomain.default.svc.cluster.local
</span></span><span style=display:flex><span>Server:    10.96.0.10
</span></span><span style=display:flex><span>Address 1: 10.96.0.10 kube-dns.kube-system.svc.cluster.local
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Name:      busybox-2.busybox-subdomain.default.svc.cluster.local
</span></span><span style=display:flex><span>Address 1: 10.244.205.199 busybox-2.busybox-subdomain.default.svc.cluster.local
</span></span></code></pre></div><p>Pods can have custom DNS config:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#888>  </span><span style=color:#fb660a;font-weight:700>dnsPolicy</span>:<span style=color:#888> </span>ClusterFirstWithHostNet<span style=color:#888>
</span></span></span></code></pre></div><p>Where the policy can be:</p><ul><li>Default: host node dns resolver to pods</li><li>ClusterFirst: upstream dns resolver</li><li>ClusterFirstWithHostNet: first cluster, then host of the pod</li></ul><p>Or you can manually specify the DNS config:</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#fb660a;font-weight:700>apiVersion</span>:<span style=color:#888> </span>v1<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888></span><span style=color:#fb660a;font-weight:700>kind</span>:<span style=color:#888> </span>Pod<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888></span><span style=color:#fb660a;font-weight:700>metadata</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>  </span><span style=color:#fb660a;font-weight:700>namespace</span>:<span style=color:#888> </span>default<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>  </span><span style=color:#fb660a;font-weight:700>name</span>:<span style=color:#888> </span>dns-example<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888></span><span style=color:#fb660a;font-weight:700>spec</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>  </span><span style=color:#fb660a;font-weight:700>containers</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>    </span>- <span style=color:#fb660a;font-weight:700>name</span>:<span style=color:#888> </span>test<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>      </span><span style=color:#fb660a;font-weight:700>image</span>:<span style=color:#888> </span>nginx<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>  </span><span style=color:#fb660a;font-weight:700>dnsPolicy</span>:<span style=color:#888> </span><span style=color:#0086d2>&#34;None&#34;</span><span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>  </span><span style=color:#fb660a;font-weight:700>dnsConfig</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>    </span><span style=color:#fb660a;font-weight:700>nameservers</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>      </span>- <span style=color:#0086f7;font-weight:700>192.0.2.1</span><span style=color:#888> </span><span style=color:#080;background-color:#0f140f;font-style:italic># this is an example</span><span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>    </span><span style=color:#fb660a;font-weight:700>searches</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>      </span>- ns1.svc.cluster-domain.example<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>      </span>- my.dns.search.suffix<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>    </span><span style=color:#fb660a;font-weight:700>options</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>      </span>- <span style=color:#fb660a;font-weight:700>name</span>:<span style=color:#888> </span>ndots<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>        </span><span style=color:#fb660a;font-weight:700>value</span>:<span style=color:#888> </span><span style=color:#0086d2>&#34;2&#34;</span><span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>      </span>- <span style=color:#fb660a;font-weight:700>name</span>:<span style=color:#888> </span>edns0<span style=color:#888>
</span></span></span></code></pre></div><h2 id=services>Services
<a class=heading-link href=#services><i class="fa fa-link" aria-hidden=true></i></a></h2><p>A service can expose a set of Pods via Endpoints which are the entitities where the traffic is going to be forwareded.</p><p>Each pod have a unique cluster-wide IP.</p><p>Via services we can expose a set of pods via Endpoints.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>~z➤ k get svc
</span></span><span style=display:flex><span>NAME                TYPE        CLUSTER-IP   EXTERNAL-IP   PORT(S)    AGE
</span></span><span style=display:flex><span>busybox-subdomain   ClusterIP   None         &lt;none&gt;        1234/TCP   44m
</span></span><span style=display:flex><span>kubernetes          ClusterIP   10.96.0.1    &lt;none&gt;        443/TCP    75m
</span></span></code></pre></div><p>Endpoints</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-bash data-lang=bash><span style=display:flex><span>~z➤ k get endpointslices.discovery.k8s.io
</span></span><span style=display:flex><span>busybox-subdomain-mngmj   IPv4          <span style=color:#0086f7;font-weight:700>1234</span>    10.244.205.199,10.244.151.3   44m
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>~z➤ k get endpoints
</span></span><span style=display:flex><span>busybox-subdomain   10.244.151.3:1234,10.244.205.199:1234   44m
</span></span></code></pre></div><p>If the service doesn’t have any label then the EndpointSlice is not created nor Endpoints.
The service allows you to create multiport configuration</p><p>In case we need a Service with no labels and point the service to an external service outside the cluster maybe. Then create an EndpointSlice.</p><p><em><strong>How we expose a Service</strong></em></p><ul><li>ClusterIP (default): it allocates a cluster-wide IP Addr for internal access. If we want to expose it outside the cluster we have to use Ingress or Gateway API. If we put ClusterIP to None, it becomes headless, no access. Ip comes from —service-cluster-ip-range value.</li><li>NodePort: It opens a port on every node and it forward the traffic to the right ports. Ports are picked from range 30000-32767, you can also manually specify a port on that range.</li><li>LoadBalancer: Kubernetes can communicate with an external LB and configure it. A LB can also work internally, balance traffic just internally.</li><li>ExternalName: We use a Service and the backend will be an external service, the name fqdn is needed so k8s can configure its internal DNS Service. For example service my-service.prod.svc.cluster.local will be redirected to
<a href=https://www.example.com>www.example.com</a>
it works at DNS level.</li></ul><p>A service can have an specific ip address to receive traffic via prop: externalIPs</p><p>Service can also route traffic internally ,meaning route the traffic to the pod’s host where the initial traffic originated.</p><h2 id=ingress>Ingress
<a class=heading-link href=#ingress><i class="fa fa-link" aria-hidden=true></i></a></h2><p>It can expose a service outside the cluster and also manage the SSL/TLS Terminations. It has a managed-lb.
The ingress needs to be installed in k8s, and it will come with an Ingress Controller.
An ingress can route traffic based on hosts and paths.
Hostnames can be wildcards. Paths can have regex “exact” or “prefix”.</p><p>An ingressClass is needed so it can manage the external LB and routing via ingressClass. This ingressClass can be cluster-wide or namespaces during installation via YAML.</p><p>Same as storageClass default, we can specify an ingresClass as default:<br>annotations: <code>ingressclass.kubernetes.io/is-default-class: "true"</code></p><p>Resource Backend, so Ingress can expose a static content bucket.</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#fb660a;font-weight:700>apiVersion</span>:<span style=color:#888> </span>networking.k8s.io/v1<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888></span><span style=color:#fb660a;font-weight:700>kind</span>:<span style=color:#888> </span>Ingress<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888></span><span style=color:#fb660a;font-weight:700>metadata</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>  </span><span style=color:#fb660a;font-weight:700>name</span>:<span style=color:#888> </span>ingress-resource-backend<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888></span><span style=color:#fb660a;font-weight:700>spec</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>  </span><span style=color:#fb660a;font-weight:700>defaultBackend</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>    </span><span style=color:#fb660a;font-weight:700>resource</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>      </span><span style=color:#fb660a;font-weight:700>apiGroup</span>:<span style=color:#888> </span>k8s.example.com<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>      </span><span style=color:#fb660a;font-weight:700>kind</span>:<span style=color:#888> </span>StorageBucket<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>      </span><span style=color:#fb660a;font-weight:700>name</span>:<span style=color:#888> </span>static-assets<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>  </span><span style=color:#fb660a;font-weight:700>rules</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>    </span>- <span style=color:#fb660a;font-weight:700>http</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>        </span><span style=color:#fb660a;font-weight:700>paths</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>          </span>- <span style=color:#fb660a;font-weight:700>path</span>:<span style=color:#888> </span>/icons<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>            </span><span style=color:#fb660a;font-weight:700>pathType</span>:<span style=color:#888> </span>ImplementationSpecific<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>            </span><span style=color:#fb660a;font-weight:700>backend</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>              </span><span style=color:#fb660a;font-weight:700>resource</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>                </span><span style=color:#fb660a;font-weight:700>apiGroup</span>:<span style=color:#888> </span>k8s.example.com<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>                </span><span style=color:#fb660a;font-weight:700>kind</span>:<span style=color:#888> </span>StorageBucket<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>                </span><span style=color:#fb660a;font-weight:700>name</span>:<span style=color:#888> </span>icon-assets<span style=color:#888>
</span></span></span></code></pre></div><p>Sample ingress TLS</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#fb660a;font-weight:700>apiVersion</span>:<span style=color:#888> </span>v1<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888></span><span style=color:#fb660a;font-weight:700>kind</span>:<span style=color:#888> </span>Secret<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888></span><span style=color:#fb660a;font-weight:700>metadata</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>  </span><span style=color:#fb660a;font-weight:700>name</span>:<span style=color:#888> </span>testsecret-tls<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>  </span><span style=color:#fb660a;font-weight:700>namespace</span>:<span style=color:#888> </span>default<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888></span><span style=color:#fb660a;font-weight:700>data</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>  </span><span style=color:#fb660a;font-weight:700>tls.crt</span>:<span style=color:#888> </span>base64 encoded cert<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>  </span><span style=color:#fb660a;font-weight:700>tls.key</span>:<span style=color:#888> </span>base64 encoded key<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888></span><span style=color:#fb660a;font-weight:700>type</span>:<span style=color:#888> </span>kubernetes.io/tls<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888> 
</span></span></span><span style=display:flex><span><span style=color:#888></span>---<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888></span><span style=color:#fb660a;font-weight:700>apiVersion</span>:<span style=color:#888> </span>networking.k8s.io/v1<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888></span><span style=color:#fb660a;font-weight:700>kind</span>:<span style=color:#888> </span>Ingress<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888></span><span style=color:#fb660a;font-weight:700>metadata</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>  </span><span style=color:#fb660a;font-weight:700>name</span>:<span style=color:#888> </span>tls-example-ingress<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888></span><span style=color:#fb660a;font-weight:700>spec</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>  </span><span style=color:#fb660a;font-weight:700>tls</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>  </span>- <span style=color:#fb660a;font-weight:700>hosts</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>      </span>- https-example.foo.com<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>    </span><span style=color:#fb660a;font-weight:700>secretName</span>:<span style=color:#888> </span>testsecret-tls<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>  </span><span style=color:#fb660a;font-weight:700>rules</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>  </span>- <span style=color:#fb660a;font-weight:700>host</span>:<span style=color:#888> </span>https-example.foo.com<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>    </span><span style=color:#fb660a;font-weight:700>http</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>      </span><span style=color:#fb660a;font-weight:700>paths</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>      </span>- <span style=color:#fb660a;font-weight:700>path</span>:<span style=color:#888> </span>/<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>        </span><span style=color:#fb660a;font-weight:700>pathType</span>:<span style=color:#888> </span>Prefix<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>        </span><span style=color:#fb660a;font-weight:700>backend</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>          </span><span style=color:#fb660a;font-weight:700>service</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>            </span><span style=color:#fb660a;font-weight:700>name</span>:<span style=color:#888> </span>service1<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>            </span><span style=color:#fb660a;font-weight:700>port</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>              </span><span style=color:#fb660a;font-weight:700>number</span>:<span style=color:#888> </span><span style=color:#0086f7;font-weight:700>80</span><span style=color:#888>
</span></span></span></code></pre></div><h2 id=gateway-api>Gateway API
<a class=heading-link href=#gateway-api><i class="fa fa-link" aria-hidden=true></i></a></h2><p>Similar to Ingress.</p><p>It requires a class first</p><div class=highlight><pre tabindex=0 style=color:#fff;background-color:#111;-moz-tab-size:2;-o-tab-size:2;tab-size:2><code class=language-yaml data-lang=yaml><span style=display:flex><span>---<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888></span>-- Gateway Class<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888></span><span style=color:#fb660a;font-weight:700>apiVersion</span>:<span style=color:#888> </span>gateway.networking.k8s.io/v1<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888></span><span style=color:#fb660a;font-weight:700>kind</span>:<span style=color:#888> </span>GatewayClass<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888></span><span style=color:#fb660a;font-weight:700>metadata</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>  </span><span style=color:#fb660a;font-weight:700>name</span>:<span style=color:#888> </span>example-class<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888></span><span style=color:#fb660a;font-weight:700>spec</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>  </span><span style=color:#fb660a;font-weight:700>controllerName</span>:<span style=color:#888> </span>example.com/gateway-controller<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888></span>---<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888></span>-- Then we define the gateway<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888></span><span style=color:#fb660a;font-weight:700>apiVersion</span>:<span style=color:#888> </span>gateway.networking.k8s.io/v1<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888></span><span style=color:#fb660a;font-weight:700>kind</span>:<span style=color:#888> </span>Gateway<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888></span><span style=color:#fb660a;font-weight:700>metadata</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>  </span><span style=color:#fb660a;font-weight:700>name</span>:<span style=color:#888> </span>example-gateway<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888></span><span style=color:#fb660a;font-weight:700>spec</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>  </span><span style=color:#fb660a;font-weight:700>gatewayClassName</span>:<span style=color:#888> </span>example-class<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>  </span><span style=color:#fb660a;font-weight:700>listeners</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>  </span>- <span style=color:#fb660a;font-weight:700>name</span>:<span style=color:#888> </span>http<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>    </span><span style=color:#fb660a;font-weight:700>protocol</span>:<span style=color:#888> </span>HTTP<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>    </span><span style=color:#fb660a;font-weight:700>port</span>:<span style=color:#888> </span><span style=color:#0086f7;font-weight:700>80</span><span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888></span>---<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888></span><span style=color:#080;background-color:#0f140f;font-style:italic>#Then we specify the rules http</span><span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888></span><span style=color:#fb660a;font-weight:700>apiVersion</span>:<span style=color:#888> </span>gateway.networking.k8s.io/v1<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888></span><span style=color:#fb660a;font-weight:700>kind</span>:<span style=color:#888> </span>HTTPRoute<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888></span><span style=color:#fb660a;font-weight:700>metadata</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>  </span><span style=color:#fb660a;font-weight:700>name</span>:<span style=color:#888> </span>example-httproute<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888></span><span style=color:#fb660a;font-weight:700>spec</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>  </span><span style=color:#fb660a;font-weight:700>parentRefs</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>  </span>- <span style=color:#fb660a;font-weight:700>name</span>:<span style=color:#888> </span>example-gateway<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>  </span><span style=color:#fb660a;font-weight:700>hostnames</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>  </span>- www.example.com<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>  </span><span style=color:#fb660a;font-weight:700>rules</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>  </span>- <span style=color:#fb660a;font-weight:700>matches</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>    </span>- <span style=color:#fb660a;font-weight:700>path</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>        </span><span style=color:#fb660a;font-weight:700>type</span>:<span style=color:#888> </span>PathPrefix<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>        </span><span style=color:#fb660a;font-weight:700>value</span>:<span style=color:#888> </span>/login<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>    </span><span style=color:#fb660a;font-weight:700>backendRefs</span>:<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>    </span>- <span style=color:#fb660a;font-weight:700>name</span>:<span style=color:#888> </span>example-svc<span style=color:#888>
</span></span></span><span style=display:flex><span><span style=color:#888>      </span><span style=color:#fb660a;font-weight:700>port</span>:<span style=color:#888> </span><span style=color:#0086f7;font-weight:700>8080</span><span style=color:#888>
</span></span></span></code></pre></div></article></section></div><footer class=footer><section class=container>©
2021 -
2024
Dennis Ruiz
·
Powered by <a href=https://gohugo.io/>Hugo</a> & <a href=https://github.com/luizdepra/hugo-coder/>Coder</a>.</section></footer></main><script src=/js/coder.min.236049395dc3682fb2719640872958e12f1f24067bb09c327b233e6290c7edac.js integrity="sha256-I2BJOV3DaC+ycZZAhylY4S8fJAZ7sJwyeyM+YpDH7aw="></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-6CQZY8W0WD"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-6CQZY8W0WD")</script><script>$(document).on("input propertychange paste change",".FilterSearch",function(){var n=$(this).val().toLowerCase(),s=$(this).closest("ul"),t=s.find("li:gt(0)");t.hide(),t.filter(function(){var e=$(this).text().toLowerCase();return e.indexOf(n)>=0}).show()})</script></body></html>